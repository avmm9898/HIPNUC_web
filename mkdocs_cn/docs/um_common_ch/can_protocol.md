



## CAN通讯协议

CAN通讯协议遵循CANopen协议。基本配置如下：

* 只使用PTO1, PTO2, PTO3, PTO4 传输姿态数据,节点不接收或发送远程帧，所有传输均采用标准数据帧。

* PTO采用异步定时触发模式, 默认输出速率为100Hz

* 节点上电处于预操作状态(pre-operational) 需要主机发送NMT协议将节点设置为operation状态才会开始发送数据

  
  
### CAN默认设置

| 默认配置   | 值                                                           |
| ---------- | ------------------------------------------------------------ |
| CAN 波特率 | 500KHz                                                       |
| 节点ID     | 8                                                            |
| 初始化状态 | 预操作(Pre-operational),需要发送Start Remote Node命令模块才能开始输出 |
| 心跳包     | 无                                                           |

  


### PTO传输细节

| PTO通道 | PTO 帧ID | 长度 | PTO 传输方式    | 发送数据 | 说明                                                         |
| ------- | -------- | ---- | --------------- | -------- | ------------------------------------------------------------ |
| TPDO1   | 0x180+ID | 6    | 循环同步(0x01)  | 加速度   | 每轴数据类型为(INT16)，分别为X,Y,Z轴加速度，单位为mG(0.001重力加速度) |
| TPDO2   | 0x280+ID | 6    | 循环同步(0x01)  | 角速度   | 每轴数据类型为(INT16)，分别为X,Y,Z轴角速度，单位为0.1DPS(°/s) |
| TPDO3   | 0x380+ID | 6    | 异步定时(0xFE)  | 欧拉角   | 每轴数据类型为(INT16)，顺序分别为横滚角(Roll,绕X轴旋转),俯仰角(Pitch,绕Y轴旋转),航向角(Yaw绕Z轴旋转)。欧拉角单位为0.01° 旋转顺序为ZYX(先转Z然后Y最后X) |
| TPDO4   | 0x380+ID | 8    | 循环同步(0x01)) | 四元数   | 每轴数据类型为(INT16)，分别为$$ q_{w} \ q_{x}\ q_{y}\ q_{z}$$ 。单位四元数扩大10000倍后结果。如四元数为1,0,0,0 时, 输出10000,0,0,0. |





使用USB-CAN工具抓取默认CAN输出包截图如下：


![](common_figures/can_interface_pto.png)



  ### 修改配置

数据字典以下位置存放厂商参数配置数据, 可通过CANopen主站修改，掉电保存，重启生效

| 地址   | 名称     | 值类型    | 默认值 | 说明          |
| ------ | -------- | --------- | ------ | ------------- |
| 0x2100 | CAN_BAUD | INTEGER32 | 500000 | CAN总线波特率 |
| 0x2101 | NodeID   | INTEGER32 | 8      | 节点ID        |

