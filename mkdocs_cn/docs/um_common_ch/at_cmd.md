


## 通用AT指令

模块采用AT 指令集配置/查看模块参数。AT 指令总以ASCII 码`AT` 开头，后面跟控制字符，最
后以回车换行`\r\n`结束。可使用串口调试助手进行测试：

![](common_figures/at_cmd.png)

通用模块 AT指令如下

| 指令      | 功能                     | 掉电保存(Y) | 备注            | 支持该指令的产品          |
| --------- | ------------------------ | ----------- | --------------- | ------------------------- |
| AT+ID     | 设置模块用户ID           | Y           | 复位/重启后生效 | HI22X                     |
| AT+URFR   | 旋转模块传感器坐标系     | Y           | 复位/重启后生效 | HI22X                     |
| AT+INFO   | 打印模块信息             | N           | 立即生效        | HI22X                     |
| AT+ODR    | 设置模块串口输出帧频率   | Y           | 复位/重启后生效 | HI22X                     |
| AT+BAUD   | 设置串口波特率           | Y           | 复位/重启后生效 | HI22X                     |
| AT+EOUT   | 数据输出开关             | N           | 立即生效        | HI22X                     |
| AT+RST    | 复位模块                 | N           | 立即生效        | HI22X                     |
| AT+TRG    | 单次输出触发             | N           | 立即生效        | HI226/HI229               |
| AT+SETPEL | 设置输出数据包           | Y           | 复位/重启后生效 | HI22X                     |
| AT+MODE   | 设置模块工作模式         | Y           | 复位/重启后生效 | HI229/HI221               |
| AT+GYRCTL | 设置陀螺仪限幅滤波器参数 | Y           | 复位/重启后生效 | HI22X                     |
| AT+GWID   | 设置无线网关ID           | Y           | 复位/重启后生效 | HI221GW(接收机)/HI221节点 |
| AT+GWCFG  | 设置接收机无线网络属性   | Y           | 复位/重启后生效 | HI221GW(接收机)           |

##### AT+ID

设置模块用户ID

**例** `AT+ID=1`



##### AT+URFR

某些情况下传感器需要倾斜垂直安装，这时候需要旋转传感器坐标系，这条指令提供了旋转传感器坐标系的接口：

`AT+URFR=C00,C01,C02,C10,C11,C12,C20,C21,C22` 

其中  $C_{nn}$  支持浮点数 

$$
\left\{\begin{array}{l}{X} \\ {Y} \\ {Z}\end{array}\right\}_{U}=\left[\begin{array}{lll}{C 00} & {C 01} & {C 02} \\ {C 10} & {C 11} & {C 12} \\ {C 20} & {C 21} & {C 22}\end{array}\right] \cdot\left\{\begin{array}{l}{X} \\ {Y} \\ {Z}\end{array}\right\}_{B}
$$


其中$\left\{\begin{array}{l}{X} \\ {Y} \\ {Z}\end{array}\right\}_{U}$为旋转后的 传感器坐标系下 传感器数据，$\left\{\begin{array}{l}{X} \\ {Y} \\ {Z}\end{array}\right\}_{B}$为旋转前 传感器坐标系下 传感器数据


下面是几种常用旋转举例：

- 新传感器坐标系为 绕原坐标系X轴 旋转 90°， 输入命令：`AT+URFR=1,0,0,0,0,1,0,-1,0`

- 新传感器坐标系为 绕原坐标系X轴 旋转-90°， 输入命令：`AT+URFR=1,0,0,0,0,-1,0,1,0`

- 新传感器坐标系为 绕原坐标系X轴 旋转180°， 输入命令：`AT+URFR=1,0,0,0,-1,0,0,0,-1`

- 新传感器坐标系为 绕原坐标系Y轴 旋转 90°， 输入命令：`AT+URFR= 0,0,-1,0,1,0,1,0,0`

- 新传感器坐标系为 绕原坐标系Y轴 旋转-90°， 输入命令：`AT+URFR= 0,0,1,0,1,0,-1,0,0`

- 新传感器坐标系为 绕原坐标系Y轴 旋转180°， 输入命令：`AT+URFR= -1,0,0,0,1,0,0,0,-1`

- 恢复默认值：`AT+URFR=1,0,0,0,1,0,0,0,1`

  

##### AT+INFO

打印模块信息，包括产品型号，版本，固件发布日期等。AT+INFO可以拓展二级指令实现更多信息的查询

| INFO二级拓展指令 | 功能                 | 示例        |
| ---------------- | -------------------- | ----------- |
| CAL              | 显示模块内部校准参数 | AT+INFO=CAL |
| RF               | 显示无线设备参数     | AT+INFO=RF  |
| VER              | 显示详细版本信息     | AT+INFO=VER |


##### AT+ODR

设置模块串口输出速率。 掉电保存，复位模块生效

**例** 设置串口输出速率为100Hz:  `AT+ODR=100` 

##### AT+BAUD

设置串口波特率，可选值：4800/9600/115200/256000/460800`

**例**  `AT+BAUD=115200`

!!! note "注意"

- 使用此指令需要特别注意，输入错误波特率后可能会导致无法和模块通讯
- 波特率参数设置好后掉电保存，复位模块生效。上位机的波特率也要做相应修改。
- 升级固件时，需要切换回115200 波特率。

##### AT+EOUT

串口输出开关

**例** 打开串口输出 `AT+EOUT=1`   关闭串口输出 `AT+EOUT=0`

##### AT+RST

复位模块

**例** `AT+RST`

##### AT+TRG

触发模块输出一帧数据，可以配合AT+ODR=0来实现单次触发输出。

**例** `AT+TRG`

##### AT+SETPEL

设置输出协议:

模块数据帧中的数据包组成可使用AT指令配置，格式为`AT+SETPTL=<ITEM_ID>,<ITEM_ID>...`
一帧输出可包含最多8个数据包。

**例** 配置模块输出加速度，角速度, 整形格式欧拉角和四元数的指令为：`AT+SETPTL=A0,B1,D0,D1`

![](common_figures/at_setptl.png)

##### AT+MODE

设置模块工作模式

**例** 

* 设置模块工作在6轴模式(无磁校准)  `AT+MODE=0`
* 设置模块工作在9轴模式(地磁场传感器参与航向角校正)  `AT+MODE=1`

##### AT+GYRCTL

设置陀螺限幅滤波器阈值(出厂默认值1.0)

**例**

* 设置陀螺限幅滤波器限幅阈值为1.5°/s:   `AT+GYRCTL=LMF,1.5` 

  陀螺限幅滤波主要为解决陀螺零偏问题，当模块静止经受机械振动时(比如安装在机器上，机器人上电待机但不移动时会有电机空载振动)，陀螺航向角会因为Z轴振动而缓慢飘移。当陀螺Z轴小于设定阈值时，模块则会强制把Z轴数值归0.  

  限幅滤波可以解决由于陀螺零偏或小范围振动时带来的航向角飘移问题，但缺点是小于设定阈值的转动会无法检测。一般情况下，阈值设定范围应在0.1 - 3.5之间。

  限幅阈值过高会导致小于阈值的转动角速度无法检测

  限幅阈值过低会导致陀螺零偏无法校准，航向角随时间缓慢飘移。
  
  

##### AT+GWID

可通过AT+GWID指令配置，GWID属性决定了接收器和节点的RF频率，只有节点的GWID 和接收器的 GWID相同时，模块和接收器直接才能通讯。GWID相当于无线网段，当在同一地点使用多个接收机组成多个星形网络时，必须保证每个接收器的GWID(网段)不同。



**例** 将一个接收器设置为GWID=3， 并将3个模块的自身ID设置为 0,1,2 并连接到这个接收器上：

接收机配置：`AT+GWID=3`

节点0配置： `AT+GWID=3`  `AT+ID=0`

节点1配置： `AT+GWID=3`  `AT+ID=1`

节点2配置： `AT+GWID=3`  `AT+ID=2`

##### AT+GWCFG

配置接收机支持的节点数和无线通讯频率。接收机默认支持8个节点，每个节点100Hz通讯频率。通讯频率*节点数收到RF带宽的限制，错误的配置将会导致无法输出数据。推荐的配置如下：

| 配置选项    | 通讯频率(Hz,每个节点) | 支持的节点数 |
| ----------- | --------------------- | ------------ |
| 1(出厂默认) | 100                   | 8            |
| 2           | 200                   | 4            |
| 3           | 30                    | 16           |

**例** 配置接收机支持的最大节点数为16，每个节点接收频率为30Hz，依次输入:

`AT+GWCFG=FRQ,30`

`AT+GWCFG=CNT,16`

