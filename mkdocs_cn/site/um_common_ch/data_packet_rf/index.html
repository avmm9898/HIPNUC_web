<!doctype html><html lang=en class=no-js> <head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta http-equiv=x-ua-compatible content="ie=edge"><link href=http://www.hipnuc.com/index_cn.html/um_common_ch/data_packet_rf/ rel=canonical><meta name=lang:clipboard.copy content="Copy to clipboard"><meta name=lang:clipboard.copied content="Copied to clipboard"><meta name=lang:search.language content=en><meta name=lang:search.pipeline.stopwords content=True><meta name=lang:search.pipeline.trimmer content=True><meta name=lang:search.result.none content="No matching documents"><meta name=lang:search.result.one content="1 matching document"><meta name=lang:search.result.other content="# matching documents"><meta name=lang:search.tokenizer content=[\s\-]+><link rel="shortcut icon" href=../../assets/images/favicon.png><meta name=generator content="mkdocs-1.0.4, mkdocs-material-4.6.2"><title>Data packet rf - HiPNUC 文件中心</title><link rel=stylesheet href=../../assets/stylesheets/application.adb8469c.css><link rel=stylesheet href=../../assets/stylesheets/application-palette.a8b3c06d.css><meta name=theme-color content><script src=../../assets/javascripts/modernizr.86422ebf.js></script><link href=https://fonts.gstatic.com rel=preconnect crossorigin><link rel=stylesheet href="https://fonts.googleapis.com/css?family=Roboto:300,400,400i,700%7CRoboto+Mono&display=fallback"><style>body,input{font-family:"Roboto","Helvetica Neue",Helvetica,Arial,sans-serif}code,kbd,pre{font-family:"Roboto Mono","Courier New",Courier,monospace}</style><link rel=stylesheet href=../../assets/fonts/material-icons.css></head> <body dir=ltr data-md-color-primary=black data-md-color-accent=black> <svg class=md-svg> <defs> </defs> </svg> <input class=md-toggle data-md-toggle=drawer type=checkbox id=__drawer autocomplete=off> <input class=md-toggle data-md-toggle=search type=checkbox id=__search autocomplete=off> <label class=md-overlay data-md-component=overlay for=__drawer></label> <a href=#_1 tabindex=0 class=md-skip> Skip to content </a> <header class=md-header data-md-component=header> <nav class="md-header-nav md-grid"> <div class=md-flex> <div class="md-flex__cell md-flex__cell--shrink"> <a href=http://www.hipnuc.com/index_cn.html title="HiPNUC 文件中心" aria-label="HiPNUC 文件中心" class="md-header-nav__button md-logo"> <i class=md-icon>home</i> </a> </div> <div class="md-flex__cell md-flex__cell--shrink"> <label class="md-icon md-icon--menu md-header-nav__button" for=__drawer></label> </div> <div class="md-flex__cell md-flex__cell--stretch"> <div class="md-flex__ellipsis md-header-nav__title" data-md-component=title> <span class=md-header-nav__topic> HiPNUC 文件中心 </span> <span class=md-header-nav__topic> Data packet rf </span> </div> </div> <div class="md-flex__cell md-flex__cell--shrink"> <label class="md-icon md-icon--search md-header-nav__button" for=__search></label> <div class=md-search data-md-component=search role=dialog> <label class=md-search__overlay for=__search></label> <div class=md-search__inner role=search> <form class=md-search__form name=search> <input type=text class=md-search__input aria-label=search name=query placeholder=Search autocapitalize=off autocorrect=off autocomplete=off spellcheck=false data-md-component=query data-md-state=active> <label class="md-icon md-search__icon" for=__search></label> <button type=reset class="md-icon md-search__icon" data-md-component=reset tabindex=-1> &#xE5CD; </button> </form> <div class=md-search__output> <div class=md-search__scrollwrap data-md-scrollfix> <div class=md-search-result data-md-component=result> <div class=md-search-result__meta> Type to start searching </div> <ol class=md-search-result__list></ol> </div> </div> </div> </div> </div> </div> </div> </nav> </header> <div class=md-container> <main class=md-main role=main> <div class="md-main__inner md-grid" data-md-component=container> <div class="md-sidebar md-sidebar--primary" data-md-component=navigation> <div class=md-sidebar__scrollwrap> <div class=md-sidebar__inner> <nav class="md-nav md-nav--primary" data-md-level=0> <label class="md-nav__title md-nav__title--site" for=__drawer> <a href=http://www.hipnuc.com/index_cn.html title="HiPNUC 文件中心" class="md-nav__button md-logo"> <i class=md-icon>home</i> </a> HiPNUC 文件中心 </label> <ul class=md-nav__list data-md-scrollfix> <li class="md-nav__item md-nav__item--nested"> <input class="md-toggle md-nav__toggle" data-md-toggle=nav-1 type=checkbox id=nav-1> <label class=md-nav__link for=nav-1> 文档中心 </label> <nav class=md-nav data-md-component=collapsible data-md-level=1> <label class=md-nav__title for=nav-1> 文档中心 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../.. title=下载中心 class=md-nav__link> 下载中心 </a> </li> </ul> </nav> </li> </ul> </nav> </div> </div> </div> <div class="md-sidebar md-sidebar--secondary" data-md-component=toc> <div class=md-sidebar__scrollwrap> <div class=md-sidebar__inner> <nav class="md-nav md-nav--secondary"> <label class=md-nav__title for=__toc>Table of contents</label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=#_1 class=md-nav__link> 数据包 </a> <nav class=md-nav> <ul class=md-nav__list> <li class=md-nav__item> <a href=#_2 class=md-nav__link> 数据包总览 </a> </li> <li class=md-nav__item> <a href=#_3 class=md-nav__link> 产品支持数据包列表 </a> </li> <li class=md-nav__item> <a href=#0x90id class=md-nav__link> 0x90(用户ID) </a> </li> <li class=md-nav__item> <a href=#0xa0 class=md-nav__link> 0xA0(加速度) </a> </li> <li class=md-nav__item> <a href=#0xb0 class=md-nav__link> 0xB0(角速度) </a> </li> <li class=md-nav__item> <a href=#0xc0 class=md-nav__link> 0xC0(磁场强度) </a> </li> <li class=md-nav__item> <a href=#0xd0 class=md-nav__link> 0xD0(欧拉角) </a> </li> <li class=md-nav__item> <a href=#0xd1 class=md-nav__link> 0XD1(四元数) </a> </li> <li class=md-nav__item> <a href=#0xf0 class=md-nav__link> 0XF0(气压) </a> </li> <li class=md-nav__item> <a href=#0x91-imusol class=md-nav__link> 0X91( IMUSOL) </a> </li> <li class=md-nav__item> <a href=#0x62gwsol class=md-nav__link> 0x62(GWSOL) </a> </li> <li class=md-nav__item> <a href=#_4 class=md-nav__link> 出厂默认数据包 </a> </li> <li class=md-nav__item> <a href=#_5 class=md-nav__link> 数据帧结构示例 </a> <nav class=md-nav> <ul class=md-nav__list> <li class=md-nav__item> <a href=#0x900xa00xb00xc00xd00xf0 class=md-nav__link> 数据帧配置为 0x90,0xA0,0xB0,0xC0,0xD0,0xF0 数据包 </a> </li> <li class=md-nav__item> <a href=#0x91 class=md-nav__link> 数据帧配置为 0x91 数据包 </a> </li> </ul> </nav> </li> </ul> </nav> </li> </ul> </nav> </div> </div> </div> <div class=md-content> <article class="md-content__inner md-typeset"> <h1>Data packet rf</h1> <h2 id=_1>数据包</h2> <h4 id=_2>数据包总览</h4> <table> <thead> <tr> <th>数据包标签(DATA_ID)</th> <th>数据包长度(包含标签1字节)</th> <th>名称</th> <th>备注</th> </tr> </thead> <tbody> <tr> <td>0x90</td> <td>2</td> <td>用户ID</td> <td></td> </tr> <tr> <td>0xA0</td> <td>7</td> <td>加速度</td> <td></td> </tr> <tr> <td>0xB0</td> <td>7</td> <td>角速度</td> <td></td> </tr> <tr> <td>0xC0</td> <td>7</td> <td>磁场强度</td> <td></td> </tr> <tr> <td>0xD0</td> <td>7</td> <td>欧拉角</td> <td></td> </tr> <tr> <td>0xD1</td> <td>17</td> <td>四元数</td> <td></td> </tr> <tr> <td>0xF0</td> <td>5</td> <td>气压</td> <td>输出0</td> </tr> <tr> <td>0x91</td> <td>76</td> <td>IMUSOL(IMU数据集合)</td> <td>推荐使用</td> </tr> <tr> <td>0x62</td> <td>变长</td> <td>GWSOL(无线节点数据集合)</td> <td></td> </tr> </tbody> </table> <h4 id=_3>产品支持数据包列表</h4> <p>下表列出所有产品支持的数据包, ***** 表示支持 **-**表示不支持</p> <table> <thead> <tr> <th>产品</th> <th align=left>90</th> <th align=left>A0</th> <th align=left>B0</th> <th>C0</th> <th>D0</th> <th>D1</th> <th>F0</th> <th>91</th> <th>62</th> </tr> </thead> <tbody> <tr> <td>HI221</td> <td align=left>*</td> <td align=left>*</td> <td align=left>*</td> <td>*</td> <td>*</td> <td>*</td> <td>-</td> <td>*</td> <td>-</td> </tr> <tr> <td>HI221GW</td> <td align=left>-</td> <td align=left>-</td> <td align=left>-</td> <td>-</td> <td>-</td> <td>-</td> <td>-</td> <td>-</td> <td>*</td> </tr> </tbody> </table> <h4 id=0x90id>0x90(用户ID)</h4> <p>共2字节，用户设置的ID。</p> <table> <thead> <tr> <th>字节偏移</th> <th>类型</th> <th>大小</th> <th>单位</th> <th>说明</th> </tr> </thead> <tbody> <tr> <td>0</td> <td>uint8_t</td> <td>1</td> <td>-</td> <td>数据包标签:0x90</td> </tr> <tr> <td>1</td> <td>uint8_t</td> <td>1</td> <td>-</td> <td>用户ID</td> </tr> </tbody> </table> <h4 id=0xa0>0xA0(加速度)</h4> <p>共7 个字节，LSB。输出传感器的原始加速度</p> <table> <thead> <tr> <th>字节偏移</th> <th>类型</th> <th>大小</th> <th>单位</th> <th>说明</th> </tr> </thead> <tbody> <tr> <td>0</td> <td>uint8_t</td> <td>1</td> <td>-</td> <td>数据包标签:0xA0</td> </tr> <tr> <td>1</td> <td>int16_t</td> <td>2</td> <td>0.001G(1G = 1重力加速度)</td> <td>X轴加速度</td> </tr> <tr> <td>3</td> <td>int16_t</td> <td>2</td> <td>0.001G</td> <td>Y轴加速度</td> </tr> <tr> <td>5</td> <td>int16_t</td> <td>2</td> <td>0.001G</td> <td>Z轴加速度</td> </tr> </tbody> </table> <h4 id=0xb0>0xB0(角速度)</h4> <p>共7字节，LSB。输出传感器的原始角速度</p> <table> <thead> <tr> <th>字节偏移</th> <th>类型</th> <th>大小</th> <th>单位</th> <th>说明</th> </tr> </thead> <tbody> <tr> <td>0</td> <td>uint8_t</td> <td>1</td> <td>-</td> <td>数据包标签：0xB0</td> </tr> <tr> <td>1</td> <td>int16_t</td> <td>2</td> <td>0.1°/s</td> <td>X轴角速度</td> </tr> <tr> <td>3</td> <td>int16_t</td> <td>2</td> <td>0.1°/s</td> <td>Y轴角速度</td> </tr> <tr> <td>5</td> <td>int16_t</td> <td>2</td> <td>0.1°/s</td> <td>Z轴角速度</td> </tr> </tbody> </table> <h4 id=0xc0>0xC0(磁场强度)</h4> <p>共7字节，LSB。输出传感器的原始磁场强度</p> <table> <thead> <tr> <th>字节偏移</th> <th>类型</th> <th>大小</th> <th>单位</th> <th>说明</th> </tr> </thead> <tbody> <tr> <td>0</td> <td>uint8_t</td> <td>1</td> <td>-</td> <td>数据包标签:0xC0</td> </tr> <tr> <td>1</td> <td>int16_t</td> <td>2</td> <td>0.001Gauss</td> <td>X轴磁场强度</td> </tr> <tr> <td>3</td> <td>int16_t</td> <td>2</td> <td>0.001Gauss</td> <td>Y轴磁场强度</td> </tr> <tr> <td>5</td> <td>int16_t</td> <td>2</td> <td>0.001Gauss</td> <td>Z轴磁场强度</td> </tr> </tbody> </table> <h4 id=0xd0>0xD0(欧拉角)</h4> <p>共7字节，LSB。格式为int16，共三个轴，每个轴占2 个字节，顺序为Pitch/Roll/Yaw。接收到Roll, Pitch 为物理值乘以100 后得到的数值，Yaw 为乘以10 得到的数值。</p> <p>例：当接收到的Yaw = 100 时，表示航向角为10°</p> <table> <thead> <tr> <th>字节偏移</th> <th>类型</th> <th>大小</th> <th>单位</th> <th>说明</th> </tr> </thead> <tbody> <tr> <td>0</td> <td>uint8_t</td> <td>1</td> <td>-</td> <td>数据包标签:0xD0</td> </tr> <tr> <td>1</td> <td>int16_t</td> <td>2</td> <td>0.01°</td> <td>Pitch(俯仰角)</td> </tr> <tr> <td>3</td> <td>int16_t</td> <td>2</td> <td>0.01°</td> <td>Roll(横滚角)</td> </tr> <tr> <td>5</td> <td>int16_t</td> <td>2</td> <td>0.1°</td> <td>Yaw(航向角)</td> </tr> </tbody> </table> <h4 id=0xd1>0XD1(四元数)</h4> <p>共17字节，格式为float，共4个值，顺序为:W X Y Z.。每个值占4 字节(float)，整个四元数为4个float，LSB。</p> <table> <thead> <tr> <th>字节偏移</th> <th>类型</th> <th>大小</th> <th>单位</th> <th>说明</th> </tr> </thead> <tbody> <tr> <td>0</td> <td>uint8_t</td> <td>1</td> <td>-</td> <td>数据包标签:0xD1</td> </tr> <tr> <td>1</td> <td>float</td> <td>4</td> <td>-</td> <td>W</td> </tr> <tr> <td>5</td> <td>float</td> <td>4</td> <td>-</td> <td>X</td> </tr> <tr> <td>9</td> <td>float</td> <td>4</td> <td>-</td> <td>Y</td> </tr> <tr> <td>13</td> <td>float</td> <td>4</td> <td>-</td> <td>Z</td> </tr> </tbody> </table> <h4 id=0xf0>0XF0(气压)</h4> <p>共5字节，格式为float。(只针对有气压传感器的产品)</p> <table> <thead> <tr> <th>字节偏移</th> <th>类型</th> <th>大小</th> <th>单位</th> <th>说明</th> </tr> </thead> <tbody> <tr> <td>0</td> <td>uint8_t</td> <td>1</td> <td>-</td> <td>数据包标签:0xF0</td> </tr> <tr> <td>1</td> <td>float</td> <td>4</td> <td>Pa</td> <td>大气压</td> </tr> </tbody> </table> <h4 id=0x91-imusol>0X91( IMUSOL)</h4> <p>共76字节，新加入的数据包，用于替代A0,B0,C0,D0,D1等数据包。集成了IMU的传感器原始输出和姿态解算数据。</p> <table> <thead> <tr> <th>字节偏移</th> <th>类型</th> <th>大小</th> <th>单位</th> <th>说明</th> </tr> </thead> <tbody> <tr> <td>0</td> <td>uint8_t</td> <td>1</td> <td>-</td> <td>数据包标签:0x91</td> </tr> <tr> <td>1</td> <td>uint8_t</td> <td>1</td> <td>-</td> <td>ID</td> </tr> <tr> <td>2</td> <td>-</td> <td>6</td> <td>-</td> <td>保留</td> </tr> <tr> <td>8</td> <td>uint32_t</td> <td>4</td> <td>ms</td> <td>时间戳信息，从系统开机开始累加，每毫秒增加1</td> </tr> <tr> <td>12</td> <td>float</td> <td>12</td> <td>1G(1G = 1重力加速度)</td> <td>X,Y,Z轴的加速度，注意单位和0xA0不同</td> </tr> <tr> <td>24</td> <td>float</td> <td>12</td> <td>deg/s</td> <td>X,Y,Z轴的角速度，注意单位和0xB0不同</td> </tr> <tr> <td>36</td> <td>float</td> <td>12</td> <td>uT</td> <td>X,Y,Z轴的磁场强度</td> </tr> <tr> <td>48</td> <td>float</td> <td>12</td> <td>deg</td> <td>节点欧拉角集合, 顺序为：横滚角(Roll)，俯仰角(Pitch)，航向角(Yaw)(注意顺序和单位与0xD0数据包不同)</td> </tr> <tr> <td>60</td> <td>float</td> <td>16</td> <td>-</td> <td>节点四元数集合,顺序为WXYZ</td> </tr> </tbody> </table> <h4 id=0x62gwsol>0x62(GWSOL)</h4> <p>新版本无线接收机支持此数据包。数据包前8个字节为接收机信息。后面分为N个数据块。每个数据块描述一个节点的姿态数据(最大支持16个节点)。每个数据块大小为76字节，数据结构同0x91。</p> <p>此协议包数据量较大，建议将波特率调整至921600以获得最高的帧率输出。格式如下：</p> <table> <thead> <tr> <th>字节偏移</th> <th>大小</th> <th>类型</th> <th>单位</th> <th>说明</th> </tr> </thead> <tbody> <tr> <td>0</td> <td>1</td> <td>uint8_t</td> <td>-</td> <td>数据包标签:0x62</td> </tr> <tr> <td>1</td> <td>1</td> <td>uint8_t</td> <td>-</td> <td>GWID, 接收机网络ID</td> </tr> <tr> <td>2</td> <td>1</td> <td>uint8_t</td> <td>-</td> <td>N, 此帧包含节点数据块个数</td> </tr> <tr> <td>3</td> <td>5</td> <td>-</td> <td>-</td> <td>保留</td> </tr> <tr> <td><em>----节点数据块开始----</em></td> <td>-</td> <td>-</td> <td>-</td> <td><em>数据结构同0x91</em></td> </tr> <tr> <td>8+76*N(N=0-15)</td> <td>1</td> <td>uint8_t</td> <td>-</td> <td>数据包标签:0x91</td> </tr> <tr> <td>9+76*N(N=0-15)</td> <td>1</td> <td>uint8_t</td> <td>-</td> <td>节点N的ID</td> </tr> <tr> <td>10+76*N</td> <td>10</td> <td>-</td> <td>-</td> <td>保留</td> </tr> <tr> <td>20+76*N</td> <td>12</td> <td>float</td> <td>-</td> <td>节点N三轴加速度</td> </tr> <tr> <td>32+76*N</td> <td>12</td> <td>float</td> <td>-</td> <td>节点N三轴角速度</td> </tr> <tr> <td>44+76*N</td> <td>12</td> <td>float</td> <td>-</td> <td>节点N轴磁场强度</td> </tr> <tr> <td>56+76*N</td> <td>12</td> <td>float</td> <td>-</td> <td>节点N欧拉角</td> </tr> <tr> <td>68+76*N</td> <td>16</td> <td>float</td> <td>-</td> <td>节点N四元数</td> </tr> <tr> <td><em>----节点数据块结束----</em></td> <td>-</td> <td>-</td> <td>-</td> <td>-----------</td> </tr> </tbody> </table> <h3 id=_4>出厂默认数据包</h3> <p>出厂默认一帧中携带数据包数据定义如下：</p> <table> <thead> <tr> <th>产品</th> <th>默认输出数据包</th> </tr> </thead> <tbody> <tr> <td>HI221</td> <td>91</td> </tr> <tr> <td>HI221GW</td> <td>62</td> </tr> </tbody> </table> <h3 id=_5>数据帧结构示例</h3> <h4 id=0x900xa00xb00xc00xd00xf0>数据帧配置为 <code>0x90,0xA0,0xB0,0xC0,0xD0,0xF0</code> 数据包</h4> <p>使用串口助手采样一帧数据,共41字节, 前6字节为帧头, 长度和CRC校验值。剩余35字节为数据域。假设数据接收到C语言数组<code>buf</code>中。如下所示:</p> <p>5A A5 23 00 FD 61 <strong>90</strong> 00 <strong>A0</strong> 55 02 3D 01 E2 02 <strong>B0</strong> FE FF 17 00 44 00 <strong>C0</strong> 80 FF 60 FF 32 FF <strong>D0</strong> 64 F2 6C 0E BB 01 <strong>F0</strong> 00 00 00 00</p> <ul> <li>第一步：判断帧头，得到数据域长度和帧CRC：</li> </ul> <p>帧头:<code>5A</code> <code>A5</code></p> <p>帧数据域长度:<code>23</code> <code>00</code>: (0x00&lt;&lt;8) + 0x23 = 35</p> <p>帧CRC校验值:<code>FD</code> <code>61</code>:(0x61&lt;&lt;8) + 0xFD = 0x61FD</p> <ul> <li>第二步： 校验CRC</li> </ul> <div class=highlight><pre><span></span><code>    uint16_t payload_len;
    uint16_t crc;

    crc = 0;
    payload_len = buf[2] + (buf[3] &lt;&lt; 8);

    /* calulate 5A A5 and LEN filed crc */
    crc16_update(&amp;crc, buf, 4);

    /* calulate payload crc */
    crc16_update(&amp;crc, buf + 6, payload_len);
</code></pre></div> <p>得到CRC值为0x61FD, 与帧携带的CRC值相同, 帧CRC校验通过。</p> <ul> <li>第三步：接收数据</li> </ul> <p><code>90 00</code>：ID 数据包, 0x90为数据包标签, ID = 0x00.</p> <p><code>A0 55 02 3D 01 E2 02</code>:加速度数据包,0xA0为数据包标签，三轴加速度为：</p> <p>X轴加速度= (int16_t)((0x02&lt;&lt;8)+ 0x55) = 597(单位为mG)</p> <p>Y轴加速度 = (int16_t)((0x01&lt;&lt;8)+ 0x3D) = 317</p> <p>Z轴加速度= (int16_t)((0x02&lt;&lt;8)+ 0xE2) = 738</p> <p><code>B0 FE FF 17 00 44 00</code> :角速度数据包,0xB0为数据包标签，三轴角速度为：</p> <p>X轴角速度= (int16_t)((0xFF&lt;&lt;8)+ 0xFE) = -2(单位为0.1°/s)</p> <p>Y轴角速度 = (int16_t)((0x00&lt;&lt;8)+ 0x17) = 23</p> <p>Z轴角速度= (int16_t)((0x00&lt;&lt;8)+ 0x44) = 68</p> <p><code>C0 80 FF 60 FF 32 FF</code> :磁场数据包,0xC0为数据包标签，三轴磁场为：</p> <p>X轴角速度= (int16_t)((0xFF&lt;&lt;8)+ 0x80) = -128 (单位为0.001Gauss)</p> <p>Y轴角速度 = (int16_t)((0xFF&lt;&lt;8)+ 0x60) = -160</p> <p>Z轴角速度= (int16_t)((0xFF&lt;&lt;8)+ 0x32) = -206</p> <p><code>D0 64 F2 6C 0E BB 01</code> 欧拉角数据包, 0xD0为数据包标签</p> <p>Pitch= (int16_t)((0xF2&lt;&lt;8)+ 0x64) / 100 = -3484 / 100 = -34.84 ° </p> <p>Roll= (int16_t)((0x0E&lt;&lt;8)+ 0x6C) / 100 = 3692 / 100 = 36.92°</p> <p>Yaw = (int16_t)((0x01&lt;&lt;8)+ 0xBB) / 10 = 443 /10 = 44.3°</p> <p><code>F0 00 00 00 00</code>气压数据包，0xF0为数据包标签</p> <div class=highlight><pre><span></span><code>float prs;
prs = memcpy(&amp;prs, &amp;buf[37], 4);
</code></pre></div> <p>最后得到结果：</p> <div class=highlight><pre><span></span><code>id              : 0
acc(G)          :    0.597    0.317    0.738
gyr(deg/s)      :   -0.200    2.300    6.800
mag(uT)         :  -12.800  -16.000  -20.600
eul(R/P/Y)      :   36.920  -34.840   44.300
</code></pre></div> <h4 id=0x91>数据帧配置为 <code>0x91</code> 数据包</h4> <p>使用串口助手采样一帧数据,共82字节, 前6字节为帧头, 长度和CRC校验值。剩余76字节为数据域。假设数据接收到C语言数组<code>buf</code>中。如下所示:</p> <p>5A A5 4C 00 6C 51 <strong>91</strong> 00 A0 3B 01 A8 02 97 BD BB 04 00 9C A0 65 3E A2 26 45 3F 5C E7 30 3F E2 D4 5A C2 E5 9D A0 C1 EB 23 EE C2 78 77 99 41 AB AA D1 C1 AB 2A 0A C2 8D E1 42 42 8F 1D A8 C1 1E 0C 36 C2 E6 E5 5A 3F C1 94 9E 3E B8 C0 9E BE BE DF 8D BE</p> <ul> <li>第一步：判断帧头，得到数据域长度和帧CRC：</li> </ul> <p>帧头:<code>5A</code> <code>A5</code></p> <p>帧数据域长度:<code>4C</code> <code>00</code>: (0x00&lt;&lt;8) + 0x4C = 76</p> <p>帧CRC校验值:<code>6C</code> <code>51</code>:(0x51&lt;&lt;8) + 0x6C = 0x516C</p> <ul> <li>第二步： 校验CRC</li> </ul> <div class=highlight><pre><span></span><code>    uint16_t payload_len;
    uint16_t crc;

    crc = 0;
    payload_len = buf[2] + (buf[3] &lt;&lt; 8);

    /* calulate 5A A5 and LEN filed crc */
    crc16_update(&amp;crc, buf, 4);

    /* calulate payload crc */
    crc16_update(&amp;crc, buf + 6, payload_len);
</code></pre></div> <p>得到CRC值为0x516C. 帧CRC校验通过。</p> <ul> <li>第三步：接收数据</li> </ul> <p>从<code>0x91</code>开始为数据包的数据域。在C语言中可以定义结构体来方便的读取数据：</p> <p>定义0x91数据包结构体如下：</p> <div class=highlight><pre><span></span><code>__packed typedef struct
{
    uint8_t     tag;                /* data packet tag */
    uint8_t     id;
    uint8_t     rev[6];             /* reserved */
    uint32_t    ts;                 /* timestamp */
    float       acc[3];
    float       gyr[3];
    float       mag[3];
    float       eul[3];             /* eular angles: Roll,Pitch,Yaw */
    float       quat[4];            /* quaternion */
}id0x91_t;
</code></pre></div> <p><code>__packed</code> 为编译器关键字(Keil下)，表示结构体按字节紧对齐，结构体每一个元素一一对应0x91数据包的结构定义。接收数据时将接收到的数组直接memcpy到结构体即可：(注意定义结构体时必须4字节对齐), 其中<code>buf</code>指向帧头, <code>buf[6]</code>指向帧中数据域 。</p> <div class=highlight><pre><span></span><code>    /* 接收数据并使用0x91数据包结构定义来解释数据 */
    __align(4) id0x91_t dat;    /* struct must be 4 byte aligned */
    memcpy(&amp;dat, &amp;buf[6], sizeof(id0x91_t));
</code></pre></div> <p>最后得到dat数据结果：</p> <div class=highlight><pre><span></span><code>id              : 0
timestamp       : 310205
acc             :    0.224    0.770    0.691
gyr             :  -54.708  -20.077 -119.070
mag             :   19.183  -26.208  -34.542
eul(R/P/Y)      :   48.720  -21.014  -45.512
quat            :    0.855    0.310   -0.310   -0.277
</code></pre></div> </article> </div> </div> </main> <footer class=md-footer> <div class="md-footer-meta md-typeset"> <div class="md-footer-meta__inner md-grid"> <div class=md-footer-copyright> <div class=md-footer-copyright__highlight> Copyright &copy; 2016 - 2020 HiPNUC </div> powered by <a href=https://www.mkdocs.org target=_blank rel=noopener>MkDocs</a> and <a href=https://squidfunk.github.io/mkdocs-material/ target=_blank rel=noopener> Material for MkDocs</a> </div> </div> </div> </footer> </div> <script src=../../assets/javascripts/application.c33a9706.js></script> <script>app.initialize({version:"1.0.4",url:{base:"../.."}})</script> <script src=../../extra.js></script> <script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.0/MathJax.js?config=TeX-MML-AM_CHTML"></script> </body> </html>