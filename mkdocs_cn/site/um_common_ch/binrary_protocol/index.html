<!doctype html><html lang=en class=no-js> <head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta http-equiv=x-ua-compatible content="ie=edge"><link href=http://www.hipnuc.com/index_cn.html/um_common_ch/binrary_protocol/ rel=canonical><meta name=lang:clipboard.copy content="Copy to clipboard"><meta name=lang:clipboard.copied content="Copied to clipboard"><meta name=lang:search.language content=en><meta name=lang:search.pipeline.stopwords content=True><meta name=lang:search.pipeline.trimmer content=True><meta name=lang:search.result.none content="No matching documents"><meta name=lang:search.result.one content="1 matching document"><meta name=lang:search.result.other content="# matching documents"><meta name=lang:search.tokenizer content=[\s\-]+><link rel="shortcut icon" href=../../assets/images/favicon.png><meta name=generator content="mkdocs-1.0.4, mkdocs-material-4.6.2"><title>Binrary protocol - HiPNUC 文件中心</title><link rel=stylesheet href=../../assets/stylesheets/application.adb8469c.css><link rel=stylesheet href=../../assets/stylesheets/application-palette.a8b3c06d.css><meta name=theme-color content><script src=../../assets/javascripts/modernizr.86422ebf.js></script><link href=https://fonts.gstatic.com rel=preconnect crossorigin><link rel=stylesheet href="https://fonts.googleapis.com/css?family=Roboto:300,400,400i,700%7CRoboto+Mono&display=fallback"><style>body,input{font-family:"Roboto","Helvetica Neue",Helvetica,Arial,sans-serif}code,kbd,pre{font-family:"Roboto Mono","Courier New",Courier,monospace}</style><link rel=stylesheet href=../../assets/fonts/material-icons.css></head> <body dir=ltr data-md-color-primary=black data-md-color-accent=black> <svg class=md-svg> <defs> </defs> </svg> <input class=md-toggle data-md-toggle=drawer type=checkbox id=__drawer autocomplete=off> <input class=md-toggle data-md-toggle=search type=checkbox id=__search autocomplete=off> <label class=md-overlay data-md-component=overlay for=__drawer></label> <a href=#_1 tabindex=0 class=md-skip> Skip to content </a> <header class=md-header data-md-component=header> <nav class="md-header-nav md-grid"> <div class=md-flex> <div class="md-flex__cell md-flex__cell--shrink"> <a href=http://www.hipnuc.com/index_cn.html title="HiPNUC 文件中心" aria-label="HiPNUC 文件中心" class="md-header-nav__button md-logo"> <i class=md-icon>home</i> </a> </div> <div class="md-flex__cell md-flex__cell--shrink"> <label class="md-icon md-icon--menu md-header-nav__button" for=__drawer></label> </div> <div class="md-flex__cell md-flex__cell--stretch"> <div class="md-flex__ellipsis md-header-nav__title" data-md-component=title> <span class=md-header-nav__topic> HiPNUC 文件中心 </span> <span class=md-header-nav__topic> Binrary protocol </span> </div> </div> <div class="md-flex__cell md-flex__cell--shrink"> <label class="md-icon md-icon--search md-header-nav__button" for=__search></label> <div class=md-search data-md-component=search role=dialog> <label class=md-search__overlay for=__search></label> <div class=md-search__inner role=search> <form class=md-search__form name=search> <input type=text class=md-search__input aria-label=search name=query placeholder=Search autocapitalize=off autocorrect=off autocomplete=off spellcheck=false data-md-component=query data-md-state=active> <label class="md-icon md-search__icon" for=__search></label> <button type=reset class="md-icon md-search__icon" data-md-component=reset tabindex=-1> &#xE5CD; </button> </form> <div class=md-search__output> <div class=md-search__scrollwrap data-md-scrollfix> <div class=md-search-result data-md-component=result> <div class=md-search-result__meta> Type to start searching </div> <ol class=md-search-result__list></ol> </div> </div> </div> </div> </div> </div> </div> </nav> </header> <div class=md-container> <main class=md-main role=main> <div class="md-main__inner md-grid" data-md-component=container> <div class="md-sidebar md-sidebar--primary" data-md-component=navigation> <div class=md-sidebar__scrollwrap> <div class=md-sidebar__inner> <nav class="md-nav md-nav--primary" data-md-level=0> <label class="md-nav__title md-nav__title--site" for=__drawer> <a href=http://www.hipnuc.com/index_cn.html title="HiPNUC 文件中心" class="md-nav__button md-logo"> <i class=md-icon>home</i> </a> HiPNUC 文件中心 </label> <ul class=md-nav__list data-md-scrollfix> <li class="md-nav__item md-nav__item--nested"> <input class="md-toggle md-nav__toggle" data-md-toggle=nav-1 type=checkbox id=nav-1> <label class=md-nav__link for=nav-1> 文档中心 </label> <nav class=md-nav data-md-component=collapsible data-md-level=1> <label class=md-nav__title for=nav-1> 文档中心 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../.. title=下载中心 class=md-nav__link> 下载中心 </a> </li> </ul> </nav> </li> </ul> </nav> </div> </div> </div> <div class="md-sidebar md-sidebar--secondary" data-md-component=toc> <div class=md-sidebar__scrollwrap> <div class=md-sidebar__inner> <nav class="md-nav md-nav--secondary"> <label class=md-nav__title for=__toc>Table of contents</label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=#_1 class=md-nav__link> 寄存器 </a> <nav class=md-nav> <ul class=md-nav__list> <li class=md-nav__item> <a href=#_2 class=md-nav__link> 寄存器总览 </a> </li> <li class=md-nav__item> <a href=#_3 class=md-nav__link> 设备信息寄存器组 </a> <nav class=md-nav> <ul class=md-nav__list> <li class=md-nav__item> <a href=#0x0000info_dev class=md-nav__link> 0x0000(INFO_DEV) </a> </li> <li class=md-nav__item> <a href=#0x0004info_ver class=md-nav__link> 0x0004(INFO_VER) </a> </li> <li class=md-nav__item> <a href=#0x0008info_uuid class=md-nav__link> 0x0008(INFO_UUID) </a> </li> <li class=md-nav__item> <a href=#0x0010-info_id class=md-nav__link> 0x0010( INFO_ID) </a> </li> <li class=md-nav__item> <a href=#0x0014-info_cpu class=md-nav__link> 0x0014( INFO_CPU) </a> </li> <li class=md-nav__item> <a href=#0x0018-info_misc class=md-nav__link> 0x0018( INFO_MISC) </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#_4 class=md-nav__link> 通讯控制寄存器组 </a> <nav class=md-nav> <ul class=md-nav__list> <li class=md-nav__item> <a href=#0x0020comm_uart_ctl class=md-nav__link> 0x0020(COMM_UART_CTL) </a> </li> <li class=md-nav__item> <a href=#0x0024comm_uart_baud class=md-nav__link> 0x0024(COMM_UART_BAUD) </a> </li> <li class=md-nav__item> <a href=#0x0028comm_uart_cfg class=md-nav__link> 0x0028(COMM_UART_CFG) </a> </li> <li class=md-nav__item> <a href=#0x0030comm_can_ctl class=md-nav__link> 0x0030(COMM_CAN_CTL) </a> </li> <li class=md-nav__item> <a href=#0x0034comm_can_id class=md-nav__link> 0x0034(COMM_CAN_ID) </a> </li> <li class=md-nav__item> <a href=#0x0038comm_can_baud class=md-nav__link> 0x0038(COMM_CAN_BAUD) </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#_5 class=md-nav__link> 系统控制寄存器组 </a> <nav class=md-nav> <ul class=md-nav__list> <li class=md-nav__item> <a href=#0x0040sysctl_ctl class=md-nav__link> 0x0040(SYSCTL_CTL) </a> </li> <li class=md-nav__item> <a href=#0x0044sysctl_fus_cfg class=md-nav__link> 0x0044(SYSCTL_FUS_CFG) </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#imu class=md-nav__link> IMU控制寄存器组 </a> <nav class=md-nav> <ul class=md-nav__list> <li class=md-nav__item> <a href=#0x0064imuctl_gyr_lmf_thr class=md-nav__link> 0x0064(IMUCTL_GYR_LMF_THR) </a> </li> <li class=md-nav__item> <a href=#0x0068imuctl_gyr_bias_thr class=md-nav__link> 0x0068(IMUCTL_GYR_BIAS_THR) </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#_6 class=md-nav__link> 地磁校准控制寄存器组 </a> <nav class=md-nav> <ul class=md-nav__list> <li class=md-nav__item> <a href=#0x0080magcal_ctl class=md-nav__link> 0x0080(MAGCAL_CTL) </a> </li> <li class=md-nav__item> <a href=#0x0084magcal_stat class=md-nav__link> 0x0084(MAGCAL_STAT) </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#_7 class=md-nav__link> 无线节点配置寄存器组 </a> <nav class=md-nav> <ul class=md-nav__list> <li class=md-nav__item> <a href=#0x00b0rf_gwctl class=md-nav__link> 0x00B0(RF_GWCTL) </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#_8 class=md-nav__link> 校准参数寄存器组 </a> <nav class=md-nav> <ul class=md-nav__list> <li class=md-nav__item> <a href=#0x0120cal_urfr class=md-nav__link> 0x0120(CAL_URFR) </a> </li> <li class=md-nav__item> <a href=#0x0150cal_acc class=md-nav__link> 0x0150(CAL_ACC) </a> </li> <li class=md-nav__item> <a href=#0x0180cal_gyr class=md-nav__link> 0x0180(CAL_GYR) </a> </li> <li class=md-nav__item> <a href=#0x01b0cal_mag class=md-nav__link> 0x01B0(CAL_MAG) </a> </li> </ul> </nav> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#chx class=md-nav__link> CHX二进制协议 </a> <nav class=md-nav> <ul class=md-nav__list> <li class=md-nav__item> <a href=#_9 class=md-nav__link> 数据帧和命令帧格式 </a> <nav class=md-nav> <ul class=md-nav__list> <li class=md-nav__item> <a href=#_10 class=md-nav__link> 数据帧 </a> </li> <li class=md-nav__item> <a href=#_11 class=md-nav__link> 应答帧 </a> </li> <li class=md-nav__item> <a href=#_12 class=md-nav__link> 读寄存器命令帧 </a> </li> <li class=md-nav__item> <a href=#_13 class=md-nav__link> 写寄存器命令帧 </a> </li> </ul> </nav> </li> </ul> </nav> </li> </ul> </nav> </div> </div> </div> <div class=md-content> <article class="md-content__inner md-typeset"> <h1>Binrary protocol</h1> <h2 id=_1>寄存器</h2> <h3 id=_2>寄存器总览</h3> <p>寄存器采用16位宽编址，所有寄存器长度均为4字节或4字节整倍数。</p> <table> <thead> <tr> <th>寄存器地址</th> <th>寄存器名称</th> <th>长度</th> <th>只读(RO),读写(RW),只写(WO)</th> <th>备注</th> </tr> </thead> <tbody> <tr> <td><strong>设备信息寄存器组</strong></td> <td>-</td> <td>-</td> <td>-</td> <td>-</td> </tr> <tr> <td>0x0000</td> <td>INFO_DEV</td> <td>4</td> <td>RO</td> <td>产品信息</td> </tr> <tr> <td>0x0004</td> <td>INFO_VER</td> <td>4</td> <td>RO</td> <td>版本信息</td> </tr> <tr> <td>0x0008</td> <td>INFO_UUID</td> <td>8</td> <td>RO</td> <td>产品唯一识别码</td> </tr> <tr> <td>0x0010</td> <td>INFO_ID</td> <td>4</td> <td>RW</td> <td>用户ID</td> </tr> <tr> <td>0x0014</td> <td>INFO_CPU</td> <td>4</td> <td>RO</td> <td>CPU信息</td> </tr> <tr> <td>0x0018</td> <td>INFO_MISC</td> <td>4</td> <td>RO</td> <td>保留</td> </tr> <tr> <td><strong>通讯控制寄存器组</strong></td> <td>-</td> <td>-</td> <td>-</td> <td>-</td> </tr> <tr> <td>0x0020</td> <td>COMM_UART_CTL</td> <td>4</td> <td>RW</td> <td>串口控制</td> </tr> <tr> <td>0x0024</td> <td>COMM_UART_BAUD</td> <td>4</td> <td>RW</td> <td>波特率配置</td> </tr> <tr> <td>0x0028</td> <td>COMM_UART_CFG</td> <td>4</td> <td>RW</td> <td>串口输出协议包及帧率配置</td> </tr> <tr> <td>0x0030</td> <td>COMM_CAN_CTL</td> <td>4</td> <td>RW</td> <td>CAN控制</td> </tr> <tr> <td>0x0034</td> <td>COMM_CAN_ID</td> <td>4</td> <td>RW</td> <td>CAN节点ID</td> </tr> <tr> <td>0x0038</td> <td>COMM_CAN_BAUD</td> <td>4</td> <td>RW</td> <td>CAN波特率</td> </tr> <tr> <td><strong>系统控制寄存器组</strong></td> <td>-</td> <td>-</td> <td>-</td> <td>-</td> </tr> <tr> <td>0x0040</td> <td>SYSCTL_CTL</td> <td>4</td> <td>RW</td> <td>系统控制</td> </tr> <tr> <td>0x0044</td> <td>SYSCTL_FUS_CFG</td> <td>4</td> <td>RW</td> <td>融合引擎控制</td> </tr> <tr> <td>0x0048</td> <td>SYSCTL_APP_MODE</td> <td>4</td> <td>RW</td> <td>legcy support。 不要修改</td> </tr> <tr> <td><strong>IMU控制寄存器组</strong></td> <td>-</td> <td>-</td> <td>-</td> <td>-</td> </tr> <tr> <td>0x0060</td> <td>IMUCTL_CTL</td> <td>4</td> <td>RW</td> <td>IMU控制寄存器</td> </tr> <tr> <td>0x0064</td> <td>IMUCTL_GYR_LMF_THR</td> <td>4</td> <td>RW</td> <td>陀螺仪限幅滤波阈值</td> </tr> <tr> <td>0x0068</td> <td>IMUCTL_GYR_BIAS_THR</td> <td>4</td> <td>RW</td> <td>静态零偏计算阈值</td> </tr> <tr> <td><strong>地磁校准控制寄存器组</strong></td> <td>-</td> <td>-</td> <td>-</td> <td>-</td> </tr> <tr> <td>0x0080</td> <td>MAGCAL_CTL</td> <td>4</td> <td>RW</td> <td>地磁校准控制寄存器</td> </tr> <tr> <td>0x0084</td> <td>MAGCAL_STAT</td> <td>4</td> <td>RO</td> <td>地磁校准状态寄存器</td> </tr> <tr> <td>0x0088</td> <td>MAGCAL_FITERR</td> <td>4</td> <td>RO</td> <td>校准拟合残差</td> </tr> <tr> <td>0x008C</td> <td>MAGCAL_MAGB</td> <td>4</td> <td>RO</td> <td>估计出的当地磁场大小</td> </tr> <tr> <td>0x0090</td> <td>MAGCAL_THETA</td> <td>4</td> <td>RO</td> <td>估计出的当地磁场磁倾角</td> </tr> <tr> <td><strong>无线节点控制寄存器组</strong></td> <td>-</td> <td>-</td> <td>-</td> <td>-</td> </tr> <tr> <td>0x00B0</td> <td>RF_GWCTL</td> <td>4</td> <td>RW</td> <td>无线节点控制</td> </tr> <tr> <td><strong>校准参数寄存器组</strong></td> <td>-</td> <td>-</td> <td>-</td> <td>-</td> </tr> <tr> <td>0x0120</td> <td>CAL_URFR</td> <td>48</td> <td>RW</td> <td>用户坐标系旋转</td> </tr> <tr> <td>0x0150</td> <td>CAL_ACC</td> <td>48</td> <td>RO</td> <td>加速度传感器校准参数</td> </tr> <tr> <td>0x0180</td> <td>CAL_GYR</td> <td>48</td> <td>RO</td> <td>陀螺仪传感器校准参数</td> </tr> <tr> <td>0x01B0</td> <td>CAL_MAG</td> <td>48</td> <td>RO</td> <td>磁传感器校准参数</td> </tr> </tbody> </table> <h3 id=_3>设备信息寄存器组</h3> <h4 id=0x0000info_dev>0x0000(INFO_DEV)</h4> <table> <thead> <tr> <th>名称</th> <th>大小</th> <th>类型</th> <th>说明</th> <th>默认值</th> </tr> </thead> <tbody> <tr> <td>PROD_ID</td> <td>2</td> <td>uint16_t</td> <td>产品识别码</td> <td>-</td> </tr> <tr> <td>VEND_ID</td> <td>2</td> <td>uint16_t</td> <td>厂商识别码</td> <td>0x4843</td> </tr> </tbody> </table> <h4 id=0x0004info_ver>0x0004(INFO_VER)</h4> <table> <thead> <tr> <th>名称</th> <th>大小</th> <th>类型</th> <th>说明</th> <th>默认值</th> </tr> </thead> <tbody> <tr> <td>HW_VER</td> <td>2</td> <td>uint16_t</td> <td>硬件版本</td> <td>-</td> </tr> <tr> <td>SW_VER</td> <td>2</td> <td>uint16_t</td> <td>软件版本</td> <td>-</td> </tr> </tbody> </table> <h4 id=0x0008info_uuid>0x0008(INFO_UUID)</h4> <table> <thead> <tr> <th>名称</th> <th>大小</th> <th>类型</th> <th>说明</th> <th>默认值</th> </tr> </thead> <tbody> <tr> <td>UUID</td> <td>8</td> <td>byte array</td> <td>硬件唯一ID</td> <td>-</td> </tr> </tbody> </table> <h4 id=0x0010-info_id>0x0010( INFO_ID)</h4> <table> <thead> <tr> <th>名称</th> <th>大小</th> <th>类型</th> <th>说明</th> <th>默认值</th> </tr> </thead> <tbody> <tr> <td>ID</td> <td>4</td> <td>uint32_t</td> <td>用户ID</td> <td>0</td> </tr> </tbody> </table> <h4 id=0x0014-info_cpu>0x0014( INFO_CPU)</h4> <table> <thead> <tr> <th>名称</th> <th>大小</th> <th>类型</th> <th>说明</th> <th>默认值</th> </tr> </thead> <tbody> <tr> <td>CPU_FRQ</td> <td>2</td> <td>uint16_t</td> <td>CPU 主频，单位MHZ</td> <td>120</td> </tr> <tr> <td>CPU_INF_BM</td> <td>2</td> <td>bitmap</td> <td>状态位，见下表</td> <td>0x0001</td> </tr> </tbody> </table> <table> <thead> <tr> <th>CPU_INF_BM</th> <th>说明</th> </tr> </thead> <tbody> <tr> <td>0-3</td> <td>时钟状态 0:内部时钟, 1:外部时钟</td> </tr> <tr> <td>4</td> <td>复位状态:0:上电复位, 1:软件/看门狗复位</td> </tr> <tr> <td>5-31</td> <td>保留</td> </tr> </tbody> </table> <h4 id=0x0018-info_misc>0x0018( INFO_MISC)</h4> <table> <thead> <tr> <th>名称</th> <th>大小</th> <th>类型</th> <th>说明</th> <th>默认值</th> </tr> </thead> <tbody> <tr> <td>REG_LAYOUT_VER</td> <td>4</td> <td>uint32_t</td> <td>寄存器layout版本</td> <td>0</td> </tr> </tbody> </table> <h3 id=_4>通讯控制寄存器组</h3> <h4 id=0x0020comm_uart_ctl>0x0020(COMM_UART_CTL)</h4> <table> <thead> <tr> <th>名称</th> <th>大小</th> <th>类型</th> <th>说明</th> <th>默认值</th> </tr> </thead> <tbody> <tr> <td>UART_CTL</td> <td>4</td> <td>uint32_t</td> <td>1：使能串口输出 0：关闭串口输出</td> <td>1</td> </tr> </tbody> </table> <h4 id=0x0024comm_uart_baud>0x0024(COMM_UART_BAUD)</h4> <table> <thead> <tr> <th>名称</th> <th>大小</th> <th>类型</th> <th>说明</th> <th>默认值</th> </tr> </thead> <tbody> <tr> <td>UART_BAUD</td> <td>4</td> <td>uint32_t</td> <td>波特率，可选值为4800,9600,115200,256000,460800,921600</td> <td>115200</td> </tr> </tbody> </table> <h4 id=0x0028comm_uart_cfg>0x0028(COMM_UART_CFG)</h4> <table> <thead> <tr> <th>名称</th> <th>大小</th> <th>类型</th> <th>说明</th> <th>默认值</th> </tr> </thead> <tbody> <tr> <td>OUT_MASK_BM</td> <td>2</td> <td>bitmap</td> <td>数据包输出位选项，见下表。对应位1：使能对应数据包输出 0：关闭对应数据包输出</td> <td>-</td> </tr> <tr> <td>ODR</td> <td>2</td> <td>uint16_t</td> <td>串口周期输出数据包速率。可选值为 0/10/50/100/200Hz</td> <td>50</td> </tr> </tbody> </table> <table> <thead> <tr> <th>OUT_MASK_BM</th> <th>数据包</th> <th>说明</th> </tr> </thead> <tbody> <tr> <td>0</td> <td>0x91</td> <td>IMU_SOL</td> </tr> <tr> <td>1</td> <td>0x90</td> <td>用户ID</td> </tr> <tr> <td>2</td> <td>0xA0</td> <td>加速度</td> </tr> <tr> <td>3</td> <td>0xB0</td> <td>角速度</td> </tr> <tr> <td>4</td> <td>0xC0</td> <td>磁场</td> </tr> <tr> <td>5</td> <td>0xD0</td> <td>欧拉角</td> </tr> <tr> <td>6</td> <td>0xD1</td> <td>四元数</td> </tr> <tr> <td>7</td> <td>0xF0</td> <td>气压</td> </tr> <tr> <td>8</td> <td>0x62</td> <td>GW_SOL</td> </tr> <tr> <td>13</td> <td>0xD9</td> <td>浮点数欧拉角</td> </tr> <tr> <td>14</td> <td>0x60</td> <td>test8f(内部使用)</td> </tr> <tr> <td>15</td> <td>-</td> <td>保留</td> </tr> <tr> <td>16</td> <td>-</td> <td>保留</td> </tr> </tbody> </table> <h4 id=0x0030comm_can_ctl>0x0030(COMM_CAN_CTL)</h4> <table> <thead> <tr> <th>名称</th> <th>大小</th> <th>类型</th> <th>说明</th> <th>默认值</th> </tr> </thead> <tbody> <tr> <td>CAN_CTL</td> <td>4</td> <td>bitmap</td> <td>保留</td> <td>0</td> </tr> </tbody> </table> <h4 id=0x0034comm_can_id>0x0034(COMM_CAN_ID)</h4> <table> <thead> <tr> <th>名称</th> <th>大小</th> <th>类型</th> <th>说明</th> <th>默认值</th> </tr> </thead> <tbody> <tr> <td>CAN_ID</td> <td>4</td> <td>uint32_t</td> <td>CANOpen 节点ID</td> <td>8</td> </tr> </tbody> </table> <h4 id=0x0038comm_can_baud>0x0038(COMM_CAN_BAUD)</h4> <table> <thead> <tr> <th>名称</th> <th>大小</th> <th>类型</th> <th>说明</th> <th>默认值</th> </tr> </thead> <tbody> <tr> <td>CAN_BAUD</td> <td>4</td> <td>uint32_t</td> <td>CAN波特率(Hz)</td> <td>500000</td> </tr> </tbody> </table> <h3 id=_5>系统控制寄存器组</h3> <h4 id=0x0040sysctl_ctl>0x0040(SYSCTL_CTL)</h4> <table> <thead> <tr> <th>名称</th> <th>大小</th> <th>类型</th> <th>说明</th> <th>默认值</th> </tr> </thead> <tbody> <tr> <td>SYSCTL_CTL</td> <td>4</td> <td>bitmap</td> <td>保留</td> <td>-</td> </tr> </tbody> </table> <h4 id=0x0044sysctl_fus_cfg>0x0044(SYSCTL_FUS_CFG)</h4> <table> <thead> <tr> <th>名称</th> <th>大小</th> <th>类型</th> <th>说明</th> <th>默认值</th> </tr> </thead> <tbody> <tr> <td>SYSCTL_FUS_CFG_BM</td> <td>4</td> <td>bitmap</td> <td>融合使能开关: 1:开启融合该数据 0:关闭融合该数据</td> <td>0x00000001</td> </tr> </tbody> </table> <table> <thead> <tr> <th>FUSION_BM</th> <th>名称</th> <th>说明</th> </tr> </thead> <tbody> <tr> <td>0</td> <td>重力融合</td> <td>固定为1</td> </tr> <tr> <td>1</td> <td>地磁航向融合</td> <td>姿态解算器配置: 1:开启地磁融合, 可以获得基于磁北极的绝对航向角(9轴模式)</td> </tr> </tbody> </table> <h3 id=imu>IMU控制寄存器组</h3> <h4 id=0x0064imuctl_gyr_lmf_thr>0x0064(IMUCTL_GYR_LMF_THR)</h4> <table> <thead> <tr> <th>名称</th> <th>大小</th> <th>类型</th> <th>说明</th> <th>默认值</th> </tr> </thead> <tbody> <tr> <td>LMF_THR</td> <td>4</td> <td>float</td> <td>陀螺限幅滤波阈值,单位为DPS.</td> <td>0.6</td> </tr> </tbody> </table> <h4 id=0x0068imuctl_gyr_bias_thr>0x0068(IMUCTL_GYR_BIAS_THR)</h4> <table> <thead> <tr> <th>名称</th> <th>大小</th> <th>类型</th> <th>说明</th> <th>默认值</th> </tr> </thead> <tbody> <tr> <td>BIAS_THR</td> <td>4</td> <td>float</td> <td>陀螺零偏阈值，单位为DPS</td> <td>1.0</td> </tr> </tbody> </table> <h3 id=_6>地磁校准控制寄存器组</h3> <h4 id=0x0080magcal_ctl>0x0080(MAGCAL_CTL)</h4> <table> <thead> <tr> <th>名称</th> <th>大小</th> <th>类型</th> <th>说明</th> <th>默认值</th> </tr> </thead> <tbody> <tr> <td>MAGCAL_CTL</td> <td>4</td> <td>uint32_t</td> <td>保留</td> <td>-</td> </tr> </tbody> </table> <h4 id=0x0084magcal_stat>0x0084(MAGCAL_STAT)</h4> <table> <thead> <tr> <th>名称</th> <th>大小</th> <th>类型</th> <th>说明</th> <th>默认值</th> </tr> </thead> <tbody> <tr> <td>BIN_STAT</td> <td>1</td> <td>uint8_t</td> <td>当前搜集的地磁数据 0-100 0:表示没有数据， 100表示已经手机满数据。通常用作地磁校准进度指示</td> <td>0</td> </tr> <tr> <td>RES</td> <td>1</td> <td>uint8_t</td> <td>地磁校准标识0:未校准 非0:校准成功</td> <td>0</td> </tr> <tr> <td>-</td> <td>2</td> <td>uint16_t</td> <td>保留</td> <td>0</td> </tr> </tbody> </table> <h3 id=_7>无线节点配置寄存器组</h3> <h4 id=0x00b0rf_gwctl>0x00B0(RF_GWCTL)</h4> <table> <thead> <tr> <th>名称</th> <th>大小</th> <th>类型</th> <th>说明</th> <th>默认值</th> </tr> </thead> <tbody> <tr> <td>GWID</td> <td>1</td> <td>uint8_t</td> <td>网络号，相同网络号的节点和接收机才能互相通讯并组网</td> <td>0</td> </tr> <tr> <td>MAX_NODE_SIZE</td> <td>1</td> <td>uint8_t</td> <td>最大支持的节点数, 固定为8</td> <td>8</td> </tr> <tr> <td>GW_FRQ</td> <td>1</td> <td>uint8_t</td> <td>空中帧率，单位为Hz. 通常设置为50 或100</td> <td>50</td> </tr> <tr> <td>-</td> <td>1</td> <td>uint8_t</td> <td>保留</td> <td>-</td> </tr> </tbody> </table> <h3 id=_8>校准参数寄存器组</h3> <h4 id=0x0120cal_urfr>0x0120(CAL_URFR)</h4> <table> <thead> <tr> <th>名称</th> <th>大小</th> <th>类型</th> <th>说明</th> <th>默认值</th> </tr> </thead> <tbody> <tr> <td>CAL_URFR</td> <td>48</td> <td>float array</td> <td>共12个float, 前9个参数为用户设置的坐标旋转矩阵，后3个参数为用户设置的bias</td> <td>单位阵</td> </tr> </tbody> </table> <h4 id=0x0150cal_acc>0x0150(CAL_ACC)</h4> <table> <thead> <tr> <th>名称</th> <th>大小</th> <th>类型</th> <th>说明</th> </tr> </thead> <tbody> <tr> <td>CAL_ACC</td> <td>48</td> <td>float array</td> <td>共12个float, 前9个参数为加速度计校准矩阵，后3个参数为加速度计零偏</td> </tr> </tbody> </table> <h4 id=0x0180cal_gyr>0x0180(CAL_GYR)</h4> <table> <thead> <tr> <th>名称</th> <th>大小</th> <th>类型</th> <th>说明</th> </tr> </thead> <tbody> <tr> <td>CAL_GYR</td> <td>48</td> <td>float array</td> <td>共12个float, 前9个参数为陀螺仪校准矩阵，后3个参数为陀螺仪计零偏</td> </tr> </tbody> </table> <h4 id=0x01b0cal_mag>0x01B0(CAL_MAG)</h4> <table> <thead> <tr> <th>名称</th> <th>大小</th> <th>类型</th> <th>说明</th> </tr> </thead> <tbody> <tr> <td>CAL_MAG</td> <td>48</td> <td>float array</td> <td>共12个float, 前9个参数为磁场传感器校准矩阵，后3个参数为磁场传感器零偏</td> </tr> </tbody> </table> <h2 id=chx>CHX二进制协议</h2> <h3 id=_9>数据帧和命令帧格式</h3> <p>模块上电后，模块默认按100Hz (出厂默认输出速率) 输出帧数据，帧格式如下：</p> <p><img alt src=../common_figures/seral_protocol.png></p> <p>CRC实现函数：</p> <div class=highlight><pre><span></span><code>/*
    currectCrc: previous crc value, set 0 if it&#39;s first section
    src: source stream data
    lengthInBytes: length
*/
static void crc16_update(uint16_t *currectCrc, const uint8_t *src, uint32_t lengthInBytes)
{
    uint32_t crc = *currectCrc;
    uint32_t j;
    for (j=0; j &lt; lengthInBytes; ++j)
    {
        uint32_t i;
        uint32_t byte = src[j];
        crc ^= byte &lt;&lt; 8;
        for (i = 0; i &lt; 8; ++i)
        {
            uint32_t temp = crc &lt;&lt; 1;
            if (crc &amp; 0x8000)
            {
                temp ^= 0x1021;
            }
            crc = temp;
        }
    } 
    *currectCrc = crc;
}
</code></pre></div> <h4 id=_10>数据帧</h4> <table> <thead> <tr> <th>域</th> <th>值</th> <th>长度(字节)</th> <th>说明</th> </tr> </thead> <tbody> <tr> <td>PRE</td> <td>0x5A</td> <td>1</td> <td>固定为0x5A</td> </tr> <tr> <td>TYPE</td> <td>0xA5</td> <td>1</td> <td>固定为0xA5</td> </tr> <tr> <td>LEN</td> <td>1-512</td> <td>2</td> <td>帧中数据域的长度。LSB(低字节在前)，长度表示数据域的长度，不包含<code>PRE</code>,<code>TYPE</code>,<code>LEN</code>,<code>CRC</code> 字段。</td> </tr> <tr> <td>CRC</td> <td>-</td> <td>2</td> <td>除CRC 本身外其余所有帧数据的16 位CRC 校验和。LSB(低字节在前)</td> </tr> <tr> <td>PAYLOAD</td> <td>-</td> <td>1-256</td> <td>数据帧携带数据</td> </tr> </tbody> </table> <h4 id=_11>应答帧</h4> <p>应答帧分为ACK或NAK帧. 长度为2字节。当从机成功响应命令后，返回数据帧或ACK帧, 若发生错误返回NAK帧.</p> <ul> <li>ACK帧：5A A1</li> <li>NAK帧：5A A2</li> </ul> <h4 id=_12>读寄存器命令帧</h4> <p>读寄存器指令共7字节，描述如下表。从机接收到正确的读寄存器指令后，会返回数据帧。</p> <table> <thead> <tr> <th>域</th> <th>值</th> <th>长度(字节)</th> <th>说明</th> </tr> </thead> <tbody> <tr> <td>PRE</td> <td>0x5A</td> <td>1</td> <td>固定为0x5A</td> </tr> <tr> <td>TYPE</td> <td>0xA4</td> <td>1</td> <td>固定为0xA4</td> </tr> <tr> <td>LEN</td> <td>0x04</td> <td>2</td> <td>帧中数据域的长度</td> </tr> <tr> <td>CRC</td> <td>-</td> <td>2</td> <td>除CRC 本身外其余所有帧数据的16 位CRC 校验和(低字节在前)</td> </tr> <tr> <td>CMD</td> <td>0x80</td> <td>1</td> <td>写寄存器命令</td> </tr> <tr> <td>ADDR</td> <td>-</td> <td>2</td> <td>寄存器地址(低字节在前, 必须4字节对齐)</td> </tr> <tr> <td>CNT</td> <td>-</td> <td>1</td> <td>需要读取的寄存器个数</td> </tr> </tbody> </table> <p><img alt src=../common_figures/serial_protocol_read_reg.png></p> <p>例:单寄存器读取</p> <ul> <li>主机(PC)发送命令帧 读寄存器0: </li> </ul> <p>5A A4 04 00 69 95 80 00 00 01 </p> <ul> <li>从机(模块)返回数据帧 寄存器0内容: </li> </ul> <p>5A A5 04 00 61 E2 64 00 43 48 </p> <p>解析得到寄存器0内容：</p> <div class=highlight><pre><span></span><code>dev_info        : 0x48430064
</code></pre></div> <p>例:多寄存器读取</p> <ul> <li>主机(PC)发送命令帧,从寄存器0开始，连续读取5个寄存器:</li> </ul> <p>5A A4 04 00 ED D5 <strong>80 00 00 05</strong> * 从机(模块)返回数据帧 寄存器0-4内容: </p> <p>5A A5 14 00 51 43 <strong>64 00 43 48 01 00 66 00 68 F5 98 51 04 D7 79 2B 00 00 00 00</strong> </p> <p>解析得到寄存器0-4内容：</p> <div class=highlight><pre><span></span><code>dev_info        : 0x48430064
ver_info        : 0x660001
uuid_l          : 0x5198F568
uuid_h          : 0x2B79D704
id              : 0x0
</code></pre></div> <h4 id=_13>写寄存器命令帧</h4> <table> <thead> <tr> <th>域</th> <th>值</th> <th>长度(字节)</th> <th>说明</th> </tr> </thead> <tbody> <tr> <td>PRE</td> <td>0x5A</td> <td>1</td> <td>固定为0x5A</td> </tr> <tr> <td>TYPE</td> <td>0xA4</td> <td>1</td> <td>固定为0xA4</td> </tr> <tr> <td>LEN</td> <td>-</td> <td>2</td> <td>帧中数据域的长度</td> </tr> <tr> <td>CRC</td> <td>-</td> <td>2</td> <td>除CRC 本身外其余所有帧数据的16 位CRC 校验和(低字节在前)</td> </tr> <tr> <td>CMD</td> <td>0x00</td> <td>1</td> <td>读寄存器命令</td> </tr> <tr> <td>ADDR</td> <td>-</td> <td>2</td> <td>寄存器地址(低字节在前)</td> </tr> <tr> <td>CNT</td> <td>-</td> <td>1</td> <td>需要读取的寄存器个数</td> </tr> <tr> <td>DATA</td> <td>-</td> <td>4*CNT</td> <td>写入寄存器的数据</td> </tr> </tbody> </table> <p><img alt src=../common_figures/serial_protocol_write_reg.png></p> <p>例</p> <ul> <li>主机发送写寄存器0x10命令，将用户ID改为50:</li> </ul> <p>5A A4 08 00 25 93 00 10 00 01 32 00 00 00 </p> <ul> <li>从机收到命令并返回ACK帧</li> </ul> <p>5A A1</p> </article> </div> </div> </main> <footer class=md-footer> <div class="md-footer-meta md-typeset"> <div class="md-footer-meta__inner md-grid"> <div class=md-footer-copyright> <div class=md-footer-copyright__highlight> Copyright &copy; 2016 - 2020 HiPNUC </div> powered by <a href=https://www.mkdocs.org target=_blank rel=noopener>MkDocs</a> and <a href=https://squidfunk.github.io/mkdocs-material/ target=_blank rel=noopener> Material for MkDocs</a> </div> </div> </div> </footer> </div> <script src=../../assets/javascripts/application.c33a9706.js></script> <script>app.initialize({version:"1.0.4",url:{base:"../.."}})</script> <script src=../../extra.js></script> <script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.0/MathJax.js?config=TeX-MML-AM_CHTML"></script> </body> </html>