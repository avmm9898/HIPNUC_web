<!doctype html><html lang=en class=no-js> <head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta http-equiv=x-ua-compatible content="ie=edge"><link href=http://www.hipnuc.com/index_cn.html/hi221/hi221um_cn/ rel=canonical><meta name=lang:clipboard.copy content="Copy to clipboard"><meta name=lang:clipboard.copied content="Copied to clipboard"><meta name=lang:search.language content=en><meta name=lang:search.pipeline.stopwords content=True><meta name=lang:search.pipeline.trimmer content=True><meta name=lang:search.result.none content="No matching documents"><meta name=lang:search.result.one content="1 matching document"><meta name=lang:search.result.other content="# matching documents"><meta name=lang:search.tokenizer content=[\s\-]+><link rel="shortcut icon" href=../../assets/images/favicon.png><meta name=generator content="mkdocs-1.0.4, mkdocs-material-4.6.2"><title>HI221/HI221GW 用户手册 - HiPNUC 文件中心</title><link rel=stylesheet href=../../assets/stylesheets/application.adb8469c.css><link rel=stylesheet href=../../assets/stylesheets/application-palette.a8b3c06d.css><meta name=theme-color content><script src=../../assets/javascripts/modernizr.86422ebf.js></script><link href=https://fonts.gstatic.com rel=preconnect crossorigin><link rel=stylesheet href="https://fonts.googleapis.com/css?family=Roboto:300,400,400i,700%7CRoboto+Mono&display=fallback"><style>body,input{font-family:"Roboto","Helvetica Neue",Helvetica,Arial,sans-serif}code,kbd,pre{font-family:"Roboto Mono","Courier New",Courier,monospace}</style><link rel=stylesheet href=../../assets/fonts/material-icons.css></head> <body dir=ltr data-md-color-primary=black data-md-color-accent=black> <svg class=md-svg> <defs> </defs> </svg> <input class=md-toggle data-md-toggle=drawer type=checkbox id=__drawer autocomplete=off> <input class=md-toggle data-md-toggle=search type=checkbox id=__search autocomplete=off> <label class=md-overlay data-md-component=overlay for=__drawer></label> <a href=#hi221hi221gw tabindex=0 class=md-skip> Skip to content </a> <header class=md-header data-md-component=header> <nav class="md-header-nav md-grid"> <div class=md-flex> <div class="md-flex__cell md-flex__cell--shrink"> <a href=http://www.hipnuc.com/index_cn.html title="HiPNUC 文件中心" aria-label="HiPNUC 文件中心" class="md-header-nav__button md-logo"> <i class=md-icon>home</i> </a> </div> <div class="md-flex__cell md-flex__cell--shrink"> <label class="md-icon md-icon--menu md-header-nav__button" for=__drawer></label> </div> <div class="md-flex__cell md-flex__cell--stretch"> <div class="md-flex__ellipsis md-header-nav__title" data-md-component=title> <span class=md-header-nav__topic> HiPNUC 文件中心 </span> <span class=md-header-nav__topic> HI221/HI221GW 用户手册 </span> </div> </div> <div class="md-flex__cell md-flex__cell--shrink"> <label class="md-icon md-icon--search md-header-nav__button" for=__search></label> <div class=md-search data-md-component=search role=dialog> <label class=md-search__overlay for=__search></label> <div class=md-search__inner role=search> <form class=md-search__form name=search> <input type=text class=md-search__input aria-label=search name=query placeholder=Search autocapitalize=off autocorrect=off autocomplete=off spellcheck=false data-md-component=query data-md-state=active> <label class="md-icon md-search__icon" for=__search></label> <button type=reset class="md-icon md-search__icon" data-md-component=reset tabindex=-1> &#xE5CD; </button> </form> <div class=md-search__output> <div class=md-search__scrollwrap data-md-scrollfix> <div class=md-search-result data-md-component=result> <div class=md-search-result__meta> Type to start searching </div> <ol class=md-search-result__list></ol> </div> </div> </div> </div> </div> </div> </div> </nav> </header> <div class=md-container> <main class=md-main role=main> <div class="md-main__inner md-grid" data-md-component=container> <div class="md-sidebar md-sidebar--primary" data-md-component=navigation> <div class=md-sidebar__scrollwrap> <div class=md-sidebar__inner> <nav class="md-nav md-nav--primary" data-md-level=0> <label class="md-nav__title md-nav__title--site" for=__drawer> <a href=http://www.hipnuc.com/index_cn.html title="HiPNUC 文件中心" class="md-nav__button md-logo"> <i class=md-icon>home</i> </a> HiPNUC 文件中心 </label> <ul class=md-nav__list data-md-scrollfix> <li class="md-nav__item md-nav__item--nested"> <input class="md-toggle md-nav__toggle" data-md-toggle=nav-1 type=checkbox id=nav-1> <label class=md-nav__link for=nav-1> 文档中心 </label> <nav class=md-nav data-md-component=collapsible data-md-level=1> <label class=md-nav__title for=nav-1> 文档中心 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../.. title=下载中心 class=md-nav__link> 下载中心 </a> </li> </ul> </nav> </li> </ul> </nav> </div> </div> </div> <div class="md-sidebar md-sidebar--secondary" data-md-component=toc> <div class=md-sidebar__scrollwrap> <div class=md-sidebar__inner> <nav class="md-nav md-nav--secondary"> <label class=md-nav__title for=__toc>Table of contents</label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=#_1 class=md-nav__link> 简介 </a> </li> <li class=md-nav__item> <a href=#_2 class=md-nav__link> 特性 </a> <nav class=md-nav> <ul class=md-nav__list> <li class=md-nav__item> <a href=#_3 class=md-nav__link> 板载传感器 </a> </li> <li class=md-nav__item> <a href=#_4 class=md-nav__link> 数据处理 </a> </li> <li class=md-nav__item> <a href=#_5 class=md-nav__link> 通讯接口及供电 </a> </li> <li class=md-nav__item> <a href=#_6 class=md-nav__link> 其他 </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#_7 class=md-nav__link> 硬件及尺寸(节点) </a> <nav class=md-nav> <ul class=md-nav__list> <li class=md-nav__item> <a href=#_8 class=md-nav__link> 硬件参数 </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#_9 class=md-nav__link> 性能指标 </a> <nav class=md-nav> <ul class=md-nav__list> <li class=md-nav__item> <a href=#_10 class=md-nav__link> 姿态角输出精度 </a> </li> <li class=md-nav__item> <a href=#_11 class=md-nav__link> 陀螺仪 </a> </li> <li class=md-nav__item> <a href=#_12 class=md-nav__link> 加速度计 </a> </li> <li class=md-nav__item> <a href=#_13 class=md-nav__link> 磁传感器参数 </a> </li> <li class=md-nav__item> <a href=#uart class=md-nav__link> 模块数据接口参数(UART) </a> </li> <li class=md-nav__item> <a href=#24g-rf class=md-nav__link> 模块数据接口参数(2.4G RF) </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#_14 class=md-nav__link> 参考系定义 </a> </li> <li class=md-nav__item> <a href=#_15 class=md-nav__link> 串口通讯协议 </a> </li> <li class=md-nav__item> <a href=#_16 class=md-nav__link> 数据包 </a> <nav class=md-nav> <ul class=md-nav__list> <li class=md-nav__item> <a href=#_17 class=md-nav__link> 数据包总览 </a> </li> <li class=md-nav__item> <a href=#_18 class=md-nav__link> 产品支持数据包列表 </a> </li> <li class=md-nav__item> <a href=#0x90id class=md-nav__link> 0x90(用户ID) </a> </li> <li class=md-nav__item> <a href=#0xa0 class=md-nav__link> 0xA0(加速度) </a> </li> <li class=md-nav__item> <a href=#0xb0 class=md-nav__link> 0xB0(角速度) </a> </li> <li class=md-nav__item> <a href=#0xc0 class=md-nav__link> 0xC0(磁场强度) </a> </li> <li class=md-nav__item> <a href=#0xd0 class=md-nav__link> 0xD0(欧拉角) </a> </li> <li class=md-nav__item> <a href=#0xd1 class=md-nav__link> 0XD1(四元数) </a> </li> <li class=md-nav__item> <a href=#0xf0 class=md-nav__link> 0XF0(气压) </a> </li> <li class=md-nav__item> <a href=#0x91-imusol class=md-nav__link> 0X91( IMUSOL) </a> </li> <li class=md-nav__item> <a href=#0x62gwsol class=md-nav__link> 0x62(GWSOL) </a> </li> <li class=md-nav__item> <a href=#_19 class=md-nav__link> 出厂默认数据包 </a> </li> <li class=md-nav__item> <a href=#_20 class=md-nav__link> 数据帧结构示例 </a> <nav class=md-nav> <ul class=md-nav__list> <li class=md-nav__item> <a href=#0x900xa00xb00xc00xd00xf0 class=md-nav__link> 数据帧配置为 0x90,0xA0,0xB0,0xC0,0xD0,0xF0 数据包 </a> </li> <li class=md-nav__item> <a href=#0x91 class=md-nav__link> 数据帧配置为 0x91 数据包 </a> </li> </ul> </nav> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#at class=md-nav__link> AT指令 </a> <nav class=md-nav> <ul class=md-nav__list> <li class=md-nav__item> <a href=#_21 class=md-nav__link> 产品支持数据包列表 </a> <nav class=md-nav> <ul class=md-nav__list> <li class=md-nav__item> <a href=#atid class=md-nav__link> AT+ID </a> </li> <li class=md-nav__item> <a href=#aturfr class=md-nav__link> AT+URFR </a> </li> <li class=md-nav__item> <a href=#atinfo class=md-nav__link> AT+INFO </a> </li> <li class=md-nav__item> <a href=#atodr class=md-nav__link> AT+ODR </a> </li> <li class=md-nav__item> <a href=#atbaud class=md-nav__link> AT+BAUD </a> </li> <li class=md-nav__item> <a href=#ateout class=md-nav__link> AT+EOUT </a> </li> <li class=md-nav__item> <a href=#atrst class=md-nav__link> AT+RST </a> </li> <li class=md-nav__item> <a href=#attrg class=md-nav__link> AT+TRG </a> </li> <li class=md-nav__item> <a href=#atsetpel class=md-nav__link> AT+SETPEL </a> </li> <li class=md-nav__item> <a href=#atmode class=md-nav__link> AT+MODE </a> </li> <li class=md-nav__item> <a href=#atgwid class=md-nav__link> AT+GWID </a> </li> <li class=md-nav__item> <a href=#atgwcfg class=md-nav__link> AT+GWCFG </a> </li> </ul> </nav> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#c- class=md-nav__link> 附录C - 固件升级与恢复出厂设置 </a> </li> </ul> </nav> </div> </div> </div> <div class=md-content> <article class="md-content__inner md-typeset"> <h1 id=hi221hi221gw>HI221/HI221GW 用户手册</h1> <p><p style="text-align: right;">HI221 无线传输模块及接收器, Rev 1.0</p> <p><img alt src=../figures/front_image.png></p> <div style="page-break-after: always;"></div> <div class=toc> <ul> <li><a href=#hi221hi221gw>HI221/HI221GW 用户手册</a><ul> <li><a href=#_1>简介</a></li> <li><a href=#_2>特性</a><ul> <li><a href=#_3>板载传感器</a></li> <li><a href=#_4>数据处理</a></li> <li><a href=#_5>通讯接口及供电</a></li> <li><a href=#_6>其他</a></li> </ul> </li> <li><a href=#_7>硬件及尺寸(节点)</a><ul> <li><a href=#_8>硬件参数</a></li> </ul> </li> <li><a href=#_9>性能指标</a><ul> <li><a href=#_10>姿态角输出精度</a></li> <li><a href=#_11>陀螺仪</a></li> <li><a href=#_12>加速度计</a></li> <li><a href=#_13>磁传感器参数</a></li> <li><a href=#uart>模块数据接口参数(UART)</a></li> <li><a href=#24g-rf>模块数据接口参数(2.4G RF)</a></li> </ul> </li> <li><a href=#_14>参考系定义</a></li> <li><a href=#_15>串口通讯协议</a></li> <li><a href=#_16>数据包</a><ul> <li><a href=#_17>数据包总览</a></li> <li><a href=#_18>产品支持数据包列表</a></li> <li><a href=#0x90id>0x90(用户ID)</a></li> <li><a href=#0xa0>0xA0(加速度)</a></li> <li><a href=#0xb0>0xB0(角速度)</a></li> <li><a href=#0xc0>0xC0(磁场强度)</a></li> <li><a href=#0xd0>0xD0(欧拉角)</a></li> <li><a href=#0xd1>0XD1(四元数)</a></li> <li><a href=#0xf0>0XF0(气压)</a></li> <li><a href=#0x91-imusol>0X91( IMUSOL)</a></li> <li><a href=#0x62gwsol>0x62(GWSOL)</a></li> <li><a href=#_19>出厂默认数据包</a></li> <li><a href=#_20>数据帧结构示例</a><ul> <li><a href=#0x900xa00xb00xc00xd00xf0>数据帧配置为 0x90,0xA0,0xB0,0xC0,0xD0,0xF0 数据包</a></li> <li><a href=#0x91>数据帧配置为 0x91 数据包</a></li> </ul> </li> </ul> </li> <li><a href=#at>AT指令</a><ul> <li><a href=#_21>产品支持数据包列表</a><ul> <li><a href=#atid>AT+ID</a></li> <li><a href=#aturfr>AT+URFR</a></li> <li><a href=#atinfo>AT+INFO</a></li> <li><a href=#atodr>AT+ODR</a></li> <li><a href=#atbaud>AT+BAUD</a></li> <li><a href=#ateout>AT+EOUT</a></li> <li><a href=#atrst>AT+RST</a></li> <li><a href=#attrg>AT+TRG</a></li> <li><a href=#atsetpel>AT+SETPEL</a></li> <li><a href=#atmode>AT+MODE</a></li> <li><a href=#atgwid>AT+GWID</a></li> <li><a href=#atgwcfg>AT+GWCFG</a></li> </ul> </li> </ul> </li> <li><a href=#c->附录C - 固件升级与恢复出厂设置</a></li> </ul> </li> </ul> </div> <div style="page-break-after: always;"></div> <h2 id=_1>简介</h2> <p>H221/HI221GW是超核电子推出的一款低成本、高性能、小体积、低延时的惯性测量单元（IMU），本产品集成了三轴加速度计、三轴陀螺仪以及一款低功耗微处理器。可输出经过传感器融合算法计算得到的基于当地地理坐标的三维方位数据，包含横滚角、俯仰角以及以相对的航向角。同时也可以输出原始的传感器数据。HI221 由**HI221GW(接收机)** 和 **HI221(姿态模块)**组成。一个HI221GW和最多8个HI221模块组成星形网络结构。每个HI221可输出最高达100Hz的实时姿态数据。</p> <p><img alt src=../figures/star_network_1.jpg></p> <h2 id=_2>特性</h2> <h3 id=_3>板载传感器</h3> <ul> <li>三轴陀螺仪, 最大量程: ±2000°/s 输出速率 2000Hz</li> <li>三轴加速度计, 最大量程:±8g 输出速率 125Hz</li> <li>三轴地磁场传感器，最大量程: 800mG 内部采样率 100Hz</li> </ul> <h3 id=_4>数据处理</h3> <ul> <li>加速度出厂前经过校准</li> <li>数据融合算法计算并输出地理坐标系下的旋转四元数及欧拉角</li> </ul> <h3 id=_5>通讯接口及供电</h3> <ul> <li>串口(兼容TTL 可直接与5V 或3.3V 串口设备连接)</li> <li>供电电压：3.3 (&plusmn; 100 mV)</li> <li>最大峰值功耗：120mA(RF Tx发射)</li> </ul> <h3 id=_6>其他</h3> <ul> <li>PC端上位机程序，提供实时数据显示，波形，校准及excel 数据记录功能</li> <li>多项模块参数用户可配置</li> </ul> <h2 id=_7>硬件及尺寸(节点)</h2> <h3 id=_8>硬件参数</h3> <table> <thead> <tr> <th>参数</th> <th>值</th> </tr> </thead> <tbody> <tr> <td>输出数据接口</td> <td>UART(TTL 1.8V - 3.3V) 或者 2.4RF Radio</td> </tr> <tr> <td>工作电压</td> <td>3.3V (± 100mV)</td> </tr> <tr> <td>工作电流</td> <td>30mA</td> </tr> <tr> <td>待机电流</td> <td>20uA</td> </tr> <tr> <td>充电后平均工作时长</td> <td>8h</td> </tr> <tr> <td>温度范围</td> <td>-20℃ - 85 ℃</td> </tr> <tr> <td>最大线性加速度</td> <td>0 - 115 <span><span class=MathJax_Preview>m/s^2</span><script type=math/tex>m/s^2</script></span></td> </tr> <tr> <td>尺寸</td> <td>20 x 38 x 8.5mm (W x L x H)</td> </tr> <tr> <td>板载传感器</td> <td>三轴加速度计 三轴陀螺仪 三轴地磁场传感器</td> </tr> </tbody> </table> <h2 id=_9>性能指标</h2> <h3 id=_10>姿态角输出精度</h3> <table> <thead> <tr> <th>姿态角</th> <th>典型值</th> <th>最大值</th> </tr> </thead> <tbody> <tr> <td>横滚角\俯仰角 - 静态</td> <td>0.2°</td> <td>0.4°</td> </tr> <tr> <td>横滚角\俯仰角 - 动态</td> <td>0.5°</td> <td>2.0°</td> </tr> <tr> <td>航向角</td> <td>-</td> <td>-</td> </tr> </tbody> </table> <h3 id=_11>陀螺仪</h3> <table> <thead> <tr> <th>参数</th> <th>值</th> </tr> </thead> <tbody> <tr> <td>测量范围</td> <td>±2000°/s</td> </tr> <tr> <td>非线性度</td> <td>±0.1% (25°最佳)</td> </tr> <tr> <td>噪声密度</td> <td>0.08°/s/<span><span class=MathJax_Preview>\sqrt{Hz}</span><script type=math/tex>\sqrt{Hz}</script></span></td> </tr> <tr> <td>采样率</td> <td>2000Hz</td> </tr> </tbody> </table> <h3 id=_12>加速度计</h3> <table> <thead> <tr> <th>参数</th> <th>值</th> </tr> </thead> <tbody> <tr> <td>测量范围</td> <td>±8G</td> </tr> <tr> <td>非线性度</td> <td>±0.5% (25°最佳)</td> </tr> <tr> <td>最大零点偏移</td> <td>30mG</td> </tr> <tr> <td>噪声密度</td> <td>250 <span><span class=MathJax_Preview>uG\sqrt{Hz}</span><script type=math/tex>uG\sqrt{Hz}</script></span></td> </tr> <tr> <td>采样率</td> <td>400Hz</td> </tr> </tbody> </table> <h3 id=_13>磁传感器参数</h3> <table> <thead> <tr> <th>参数</th> <th>值</th> </tr> </thead> <tbody> <tr> <td>测量范围</td> <td>±8Gauss</td> </tr> <tr> <td>非线性度</td> <td>±0.1%</td> </tr> <tr> <td>采样率</td> <td>100Hz</td> </tr> </tbody> </table> <h3 id=uart>模块数据接口参数(UART)</h3> <table> <thead> <tr> <th>参数</th> <th>值</th> </tr> </thead> <tbody> <tr> <td>串口输出波特率</td> <td>4800/9600/115200/460800/921600可选</td> </tr> <tr> <td>帧输出速率</td> <td>1/25/50/100/200Hz 可选</td> </tr> </tbody> </table> <h3 id=24g-rf>模块数据接口参数(2.4G RF)</h3> <table> <thead> <tr> <th>参数</th> <th>值</th> </tr> </thead> <tbody> <tr> <td>空中波特率</td> <td>2Mbps</td> </tr> <tr> <td>帧输出速率</td> <td>1- 50Hz</td> </tr> <tr> <td>接收器最大连接节点数</td> <td>8</td> </tr> </tbody> </table> <h2 id=_14>参考系定义</h2> <p>本产品采用右手(RH, Right-Hand)坐标系。输出的四元数及欧拉角为 传感器坐标系 到 惯性坐标系(世界坐标系) 的旋转。其中欧拉角旋转顺序为 ZYX(先转Z轴，再转Y轴，最后转X轴)旋转顺序，欧拉角具体定义如下：</p> <ul> <li>绕 Z 轴方向旋转: 航向角\Yaw\phi(<span><span class=MathJax_Preview>\psi</span><script type=math/tex>\psi</script></span>) 范围: -180° - 180°</li> <li>绕 Y 轴方向旋转: 俯仰角\Pitch\theta(<span><span class=MathJax_Preview>\theta</span><script type=math/tex>\theta</script></span>) 范围: -90°-90°</li> <li>绕 X 轴方向旋转:横滚角\Roll\psi( <span><span class=MathJax_Preview>\phi</span><script type=math/tex>\phi</script></span>)范围: -180°-180°</li> </ul> <p>本产品使用北西天(North-West-Up NWU) 坐标系统，即视为模块的地理坐标系(世界坐标系)定义如下：</p> <ul> <li>X 轴正方向指向北</li> <li>Y 轴正方向指向西</li> <li>Z 轴正方向指向天</li> </ul> <p>当采用 NWU 系时，如果将模块视为飞行器的话。X 轴应视为机头方向。当传感器系与惯性系重合时，欧拉角的理想输出为:Pitch = 0°, Roll = 0°, Yaw = 0°</p> <h2 id=_15>串口通讯协议</h2> <p>模块上电后，模块默认按100Hz (出厂默认输出速率) 输出帧数据，帧格式如下：</p> <p><img alt src=../common_figures/seral_protocol.png></p> <p>其中：</p> <table> <thead> <tr> <th>域</th> <th>值</th> <th>长度(字节)</th> <th>说明</th> </tr> </thead> <tbody> <tr> <td>PRE</td> <td>0x5A</td> <td>1</td> <td>固定为0x5A</td> </tr> <tr> <td>TYPE</td> <td>0xA5</td> <td>1</td> <td>固定为0xA5</td> </tr> <tr> <td>LEN</td> <td>1-512</td> <td>2</td> <td>帧中数据域的长度。LSB(低字节在前)，长度表示数据域的长度，不包含<code>PRE</code>,<code>TYPE</code>,<code>LEN</code>,<code>CRC</code> 字段。</td> </tr> <tr> <td>CRC</td> <td>-</td> <td>2</td> <td>除CRC 本身外其余所有帧数据的16 位CRC 校验和。LSB(低字节在前)</td> </tr> <tr> <td>PAYLOAD</td> <td>-</td> <td>1-512</td> <td>一帧携带的数据。PAYLOAD 由若干个**子数据包**组成。每个数据包 包含：数据包标签(DATA_ID)和数据(DATA) 两部分。DATA_ID决定了数据的类型及长度，DATA 为数据包内容。</td> </tr> </tbody> </table> <p>CRC实现函数：</p> <div class=highlight><pre><span></span><code>/*
    currectCrc: previous crc value, set 0 if it&#39;s first section
    src: source stream data
    lengthInBytes: length
*/
static void crc16_update(uint16_t *currectCrc, const uint8_t *src, uint32_t lengthInBytes)
{
    uint32_t crc = *currectCrc;
    uint32_t j;
    for (j=0; j &lt; lengthInBytes; ++j)
    {
        uint32_t i;
        uint32_t byte = src[j];
        crc ^= byte &lt;&lt; 8;
        for (i = 0; i &lt; 8; ++i)
        {
            uint32_t temp = crc &lt;&lt; 1;
            if (crc &amp; 0x8000)
            {
                temp ^= 0x1021;
            }
            crc = temp;
        }
    } 
    *currectCrc = crc;
}
</code></pre></div> <h2 id=_16>数据包</h2> <h4 id=_17>数据包总览</h4> <table> <thead> <tr> <th>数据包标签(DATA_ID)</th> <th>数据包长度(包含标签1字节)</th> <th>名称</th> <th>备注</th> </tr> </thead> <tbody> <tr> <td>0x90</td> <td>2</td> <td>用户ID</td> <td></td> </tr> <tr> <td>0xA0</td> <td>7</td> <td>加速度</td> <td></td> </tr> <tr> <td>0xB0</td> <td>7</td> <td>角速度</td> <td></td> </tr> <tr> <td>0xC0</td> <td>7</td> <td>磁场强度</td> <td></td> </tr> <tr> <td>0xD0</td> <td>7</td> <td>欧拉角</td> <td></td> </tr> <tr> <td>0xD1</td> <td>17</td> <td>四元数</td> <td></td> </tr> <tr> <td>0xF0</td> <td>5</td> <td>气压</td> <td>输出0</td> </tr> <tr> <td>0x91</td> <td>76</td> <td>IMUSOL(IMU数据集合)</td> <td>推荐使用</td> </tr> <tr> <td>0x62</td> <td>变长</td> <td>GWSOL(无线节点数据集合)</td> <td></td> </tr> </tbody> </table> <h4 id=_18>产品支持数据包列表</h4> <p>下表列出所有产品支持的数据包, ***** 表示支持 **-**表示不支持</p> <table> <thead> <tr> <th>产品</th> <th align=left>90</th> <th align=left>A0</th> <th align=left>B0</th> <th>C0</th> <th>D0</th> <th>D1</th> <th>F0</th> <th>91</th> <th>62</th> </tr> </thead> <tbody> <tr> <td>HI221</td> <td align=left>*</td> <td align=left>*</td> <td align=left>*</td> <td>*</td> <td>*</td> <td>*</td> <td>-</td> <td>*</td> <td>-</td> </tr> <tr> <td>HI221GW</td> <td align=left>-</td> <td align=left>-</td> <td align=left>-</td> <td>-</td> <td>-</td> <td>-</td> <td>-</td> <td>-</td> <td>*</td> </tr> </tbody> </table> <h4 id=0x90id>0x90(用户ID)</h4> <p>共2字节，用户设置的ID。</p> <table> <thead> <tr> <th>字节偏移</th> <th>类型</th> <th>大小</th> <th>单位</th> <th>说明</th> </tr> </thead> <tbody> <tr> <td>0</td> <td>uint8_t</td> <td>1</td> <td>-</td> <td>数据包标签:0x90</td> </tr> <tr> <td>1</td> <td>uint8_t</td> <td>1</td> <td>-</td> <td>用户ID</td> </tr> </tbody> </table> <h4 id=0xa0>0xA0(加速度)</h4> <p>共7 个字节，LSB。输出传感器的原始加速度</p> <table> <thead> <tr> <th>字节偏移</th> <th>类型</th> <th>大小</th> <th>单位</th> <th>说明</th> </tr> </thead> <tbody> <tr> <td>0</td> <td>uint8_t</td> <td>1</td> <td>-</td> <td>数据包标签:0xA0</td> </tr> <tr> <td>1</td> <td>int16_t</td> <td>2</td> <td>0.001G(1G = 1重力加速度)</td> <td>X轴加速度</td> </tr> <tr> <td>3</td> <td>int16_t</td> <td>2</td> <td>0.001G</td> <td>Y轴加速度</td> </tr> <tr> <td>5</td> <td>int16_t</td> <td>2</td> <td>0.001G</td> <td>Z轴加速度</td> </tr> </tbody> </table> <h4 id=0xb0>0xB0(角速度)</h4> <p>共7字节，LSB。输出传感器的原始角速度</p> <table> <thead> <tr> <th>字节偏移</th> <th>类型</th> <th>大小</th> <th>单位</th> <th>说明</th> </tr> </thead> <tbody> <tr> <td>0</td> <td>uint8_t</td> <td>1</td> <td>-</td> <td>数据包标签：0xB0</td> </tr> <tr> <td>1</td> <td>int16_t</td> <td>2</td> <td>0.1°/s</td> <td>X轴角速度</td> </tr> <tr> <td>3</td> <td>int16_t</td> <td>2</td> <td>0.1°/s</td> <td>Y轴角速度</td> </tr> <tr> <td>5</td> <td>int16_t</td> <td>2</td> <td>0.1°/s</td> <td>Z轴角速度</td> </tr> </tbody> </table> <h4 id=0xc0>0xC0(磁场强度)</h4> <p>共7字节，LSB。输出传感器的原始磁场强度</p> <table> <thead> <tr> <th>字节偏移</th> <th>类型</th> <th>大小</th> <th>单位</th> <th>说明</th> </tr> </thead> <tbody> <tr> <td>0</td> <td>uint8_t</td> <td>1</td> <td>-</td> <td>数据包标签:0xC0</td> </tr> <tr> <td>1</td> <td>int16_t</td> <td>2</td> <td>0.001Gauss</td> <td>X轴磁场强度</td> </tr> <tr> <td>3</td> <td>int16_t</td> <td>2</td> <td>0.001Gauss</td> <td>Y轴磁场强度</td> </tr> <tr> <td>5</td> <td>int16_t</td> <td>2</td> <td>0.001Gauss</td> <td>Z轴磁场强度</td> </tr> </tbody> </table> <h4 id=0xd0>0xD0(欧拉角)</h4> <p>共7字节，LSB。格式为int16，共三个轴，每个轴占2 个字节，顺序为Pitch/Roll/Yaw。接收到Roll, Pitch 为物理值乘以100 后得到的数值，Yaw 为乘以10 得到的数值。</p> <p>例：当接收到的Yaw = 100 时，表示航向角为10°</p> <table> <thead> <tr> <th>字节偏移</th> <th>类型</th> <th>大小</th> <th>单位</th> <th>说明</th> </tr> </thead> <tbody> <tr> <td>0</td> <td>uint8_t</td> <td>1</td> <td>-</td> <td>数据包标签:0xD0</td> </tr> <tr> <td>1</td> <td>int16_t</td> <td>2</td> <td>0.01°</td> <td>Pitch(俯仰角)</td> </tr> <tr> <td>3</td> <td>int16_t</td> <td>2</td> <td>0.01°</td> <td>Roll(横滚角)</td> </tr> <tr> <td>5</td> <td>int16_t</td> <td>2</td> <td>0.1°</td> <td>Yaw(航向角)</td> </tr> </tbody> </table> <h4 id=0xd1>0XD1(四元数)</h4> <p>共17字节，格式为float，共4个值，顺序为:W X Y Z.。每个值占4 字节(float)，整个四元数为4个float，LSB。</p> <table> <thead> <tr> <th>字节偏移</th> <th>类型</th> <th>大小</th> <th>单位</th> <th>说明</th> </tr> </thead> <tbody> <tr> <td>0</td> <td>uint8_t</td> <td>1</td> <td>-</td> <td>数据包标签:0xD1</td> </tr> <tr> <td>1</td> <td>float</td> <td>4</td> <td>-</td> <td>W</td> </tr> <tr> <td>5</td> <td>float</td> <td>4</td> <td>-</td> <td>X</td> </tr> <tr> <td>9</td> <td>float</td> <td>4</td> <td>-</td> <td>Y</td> </tr> <tr> <td>13</td> <td>float</td> <td>4</td> <td>-</td> <td>Z</td> </tr> </tbody> </table> <h4 id=0xf0>0XF0(气压)</h4> <p>共5字节，格式为float。(只针对有气压传感器的产品)</p> <table> <thead> <tr> <th>字节偏移</th> <th>类型</th> <th>大小</th> <th>单位</th> <th>说明</th> </tr> </thead> <tbody> <tr> <td>0</td> <td>uint8_t</td> <td>1</td> <td>-</td> <td>数据包标签:0xF0</td> </tr> <tr> <td>1</td> <td>float</td> <td>4</td> <td>Pa</td> <td>大气压</td> </tr> </tbody> </table> <h4 id=0x91-imusol>0X91( IMUSOL)</h4> <p>共76字节，新加入的数据包，用于替代A0,B0,C0,D0,D1等数据包。集成了IMU的传感器原始输出和姿态解算数据。</p> <table> <thead> <tr> <th>字节偏移</th> <th>类型</th> <th>大小</th> <th>单位</th> <th>说明</th> </tr> </thead> <tbody> <tr> <td>0</td> <td>uint8_t</td> <td>1</td> <td>-</td> <td>数据包标签:0x91</td> </tr> <tr> <td>1</td> <td>uint8_t</td> <td>1</td> <td>-</td> <td>ID</td> </tr> <tr> <td>2</td> <td>-</td> <td>6</td> <td>-</td> <td>保留</td> </tr> <tr> <td>8</td> <td>uint32_t</td> <td>4</td> <td>ms</td> <td>时间戳信息，从系统开机开始累加，每毫秒增加1</td> </tr> <tr> <td>12</td> <td>float</td> <td>12</td> <td>1G(1G = 1重力加速度)</td> <td>X,Y,Z轴的加速度，注意单位和0xA0不同</td> </tr> <tr> <td>24</td> <td>float</td> <td>12</td> <td>deg/s</td> <td>X,Y,Z轴的角速度，注意单位和0xB0不同</td> </tr> <tr> <td>36</td> <td>float</td> <td>12</td> <td>uT</td> <td>X,Y,Z轴的磁场强度</td> </tr> <tr> <td>48</td> <td>float</td> <td>12</td> <td>deg</td> <td>节点欧拉角集合, 顺序为：横滚角(Roll)，俯仰角(Pitch)，航向角(Yaw)(注意顺序和单位与0xD0数据包不同)</td> </tr> <tr> <td>60</td> <td>float</td> <td>16</td> <td>-</td> <td>节点四元数集合,顺序为WXYZ</td> </tr> </tbody> </table> <h4 id=0x62gwsol>0x62(GWSOL)</h4> <p>新版本无线接收机支持此数据包。数据包前8个字节为接收机信息。后面分为N个数据块。每个数据块描述一个节点的姿态数据(最大支持16个节点)。每个数据块大小为76字节，数据结构同0x91。</p> <p>此协议包数据量较大，建议将波特率调整至921600以获得最高的帧率输出。格式如下：</p> <table> <thead> <tr> <th>字节偏移</th> <th>大小</th> <th>类型</th> <th>单位</th> <th>说明</th> </tr> </thead> <tbody> <tr> <td>0</td> <td>1</td> <td>uint8_t</td> <td>-</td> <td>数据包标签:0x62</td> </tr> <tr> <td>1</td> <td>1</td> <td>uint8_t</td> <td>-</td> <td>GWID, 接收机网络ID</td> </tr> <tr> <td>2</td> <td>1</td> <td>uint8_t</td> <td>-</td> <td>N, 此帧包含节点数据块个数</td> </tr> <tr> <td>3</td> <td>5</td> <td>-</td> <td>-</td> <td>保留</td> </tr> <tr> <td><em>----节点数据块开始----</em></td> <td>-</td> <td>-</td> <td>-</td> <td><em>数据结构同0x91</em></td> </tr> <tr> <td>8+76*N(N=0-15)</td> <td>1</td> <td>uint8_t</td> <td>-</td> <td>数据包标签:0x91</td> </tr> <tr> <td>9+76*N(N=0-15)</td> <td>1</td> <td>uint8_t</td> <td>-</td> <td>节点N的ID</td> </tr> <tr> <td>10+76*N</td> <td>10</td> <td>-</td> <td>-</td> <td>保留</td> </tr> <tr> <td>20+76*N</td> <td>12</td> <td>float</td> <td>-</td> <td>节点N三轴加速度</td> </tr> <tr> <td>32+76*N</td> <td>12</td> <td>float</td> <td>-</td> <td>节点N三轴角速度</td> </tr> <tr> <td>44+76*N</td> <td>12</td> <td>float</td> <td>-</td> <td>节点N轴磁场强度</td> </tr> <tr> <td>56+76*N</td> <td>12</td> <td>float</td> <td>-</td> <td>节点N欧拉角</td> </tr> <tr> <td>68+76*N</td> <td>16</td> <td>float</td> <td>-</td> <td>节点N四元数</td> </tr> <tr> <td><em>----节点数据块结束----</em></td> <td>-</td> <td>-</td> <td>-</td> <td>-----------</td> </tr> </tbody> </table> <h3 id=_19>出厂默认数据包</h3> <p>出厂默认一帧中携带数据包数据定义如下：</p> <table> <thead> <tr> <th>产品</th> <th>默认输出数据包</th> </tr> </thead> <tbody> <tr> <td>HI221</td> <td>91</td> </tr> <tr> <td>HI221GW</td> <td>62</td> </tr> </tbody> </table> <h3 id=_20>数据帧结构示例</h3> <h4 id=0x900xa00xb00xc00xd00xf0>数据帧配置为 <code>0x90,0xA0,0xB0,0xC0,0xD0,0xF0</code> 数据包</h4> <p>使用串口助手采样一帧数据,共41字节, 前6字节为帧头, 长度和CRC校验值。剩余35字节为数据域。假设数据接收到C语言数组<code>buf</code>中。如下所示:</p> <p>5A A5 23 00 FD 61 <strong>90</strong> 00 <strong>A0</strong> 55 02 3D 01 E2 02 <strong>B0</strong> FE FF 17 00 44 00 <strong>C0</strong> 80 FF 60 FF 32 FF <strong>D0</strong> 64 F2 6C 0E BB 01 <strong>F0</strong> 00 00 00 00</p> <ul> <li>第一步：判断帧头，得到数据域长度和帧CRC：</li> </ul> <p>帧头:<code>5A</code> <code>A5</code></p> <p>帧数据域长度:<code>23</code> <code>00</code>: (0x00&lt;&lt;8) + 0x23 = 35</p> <p>帧CRC校验值:<code>FD</code> <code>61</code>:(0x61&lt;&lt;8) + 0xFD = 0x61FD</p> <ul> <li>第二步： 校验CRC</li> </ul> <div class=highlight><pre><span></span><code>    uint16_t payload_len;
    uint16_t crc;

    crc = 0;
    payload_len = buf[2] + (buf[3] &lt;&lt; 8);

    /* calulate 5A A5 and LEN filed crc */
    crc16_update(&amp;crc, buf, 4);

    /* calulate payload crc */
    crc16_update(&amp;crc, buf + 6, payload_len);
</code></pre></div> <p>得到CRC值为0x61FD, 与帧携带的CRC值相同, 帧CRC校验通过。</p> <ul> <li>第三步：接收数据</li> </ul> <p><code>90 00</code>：ID 数据包, 0x90为数据包标签, ID = 0x00.</p> <p><code>A0 55 02 3D 01 E2 02</code>:加速度数据包,0xA0为数据包标签，三轴加速度为：</p> <p>X轴加速度= (int16_t)((0x02&lt;&lt;8)+ 0x55) = 597(单位为mG)</p> <p>Y轴加速度 = (int16_t)((0x01&lt;&lt;8)+ 0x3D) = 317</p> <p>Z轴加速度= (int16_t)((0x02&lt;&lt;8)+ 0xE2) = 738</p> <p><code>B0 FE FF 17 00 44 00</code> :角速度数据包,0xB0为数据包标签，三轴角速度为：</p> <p>X轴角速度= (int16_t)((0xFF&lt;&lt;8)+ 0xFE) = -2(单位为0.1°/s)</p> <p>Y轴角速度 = (int16_t)((0x00&lt;&lt;8)+ 0x17) = 23</p> <p>Z轴角速度= (int16_t)((0x00&lt;&lt;8)+ 0x44) = 68</p> <p><code>C0 80 FF 60 FF 32 FF</code> :磁场数据包,0xC0为数据包标签，三轴磁场为：</p> <p>X轴角速度= (int16_t)((0xFF&lt;&lt;8)+ 0x80) = -128 (单位为0.001Gauss)</p> <p>Y轴角速度 = (int16_t)((0xFF&lt;&lt;8)+ 0x60) = -160</p> <p>Z轴角速度= (int16_t)((0xFF&lt;&lt;8)+ 0x32) = -206</p> <p><code>D0 64 F2 6C 0E BB 01</code> 欧拉角数据包, 0xD0为数据包标签</p> <p>Pitch= (int16_t)((0xF2&lt;&lt;8)+ 0x64) / 100 = -3484 / 100 = -34.84 ° </p> <p>Roll= (int16_t)((0x0E&lt;&lt;8)+ 0x6C) / 100 = 3692 / 100 = 36.92°</p> <p>Yaw = (int16_t)((0x01&lt;&lt;8)+ 0xBB) / 10 = 443 /10 = 44.3°</p> <p><code>F0 00 00 00 00</code>气压数据包，0xF0为数据包标签</p> <div class=highlight><pre><span></span><code>float prs;
prs = memcpy(&amp;prs, &amp;buf[37], 4);
</code></pre></div> <p>最后得到结果：</p> <div class=highlight><pre><span></span><code>id              : 0
acc(G)          :    0.597    0.317    0.738
gyr(deg/s)      :   -0.200    2.300    6.800
mag(uT)         :  -12.800  -16.000  -20.600
eul(R/P/Y)      :   36.920  -34.840   44.300
</code></pre></div> <h4 id=0x91>数据帧配置为 <code>0x91</code> 数据包</h4> <p>使用串口助手采样一帧数据,共82字节, 前6字节为帧头, 长度和CRC校验值。剩余76字节为数据域。假设数据接收到C语言数组<code>buf</code>中。如下所示:</p> <p>5A A5 4C 00 6C 51 <strong>91</strong> 00 A0 3B 01 A8 02 97 BD BB 04 00 9C A0 65 3E A2 26 45 3F 5C E7 30 3F E2 D4 5A C2 E5 9D A0 C1 EB 23 EE C2 78 77 99 41 AB AA D1 C1 AB 2A 0A C2 8D E1 42 42 8F 1D A8 C1 1E 0C 36 C2 E6 E5 5A 3F C1 94 9E 3E B8 C0 9E BE BE DF 8D BE</p> <ul> <li>第一步：判断帧头，得到数据域长度和帧CRC：</li> </ul> <p>帧头:<code>5A</code> <code>A5</code></p> <p>帧数据域长度:<code>4C</code> <code>00</code>: (0x00&lt;&lt;8) + 0x4C = 76</p> <p>帧CRC校验值:<code>6C</code> <code>51</code>:(0x51&lt;&lt;8) + 0x6C = 0x516C</p> <ul> <li>第二步： 校验CRC</li> </ul> <div class=highlight><pre><span></span><code>    uint16_t payload_len;
    uint16_t crc;

    crc = 0;
    payload_len = buf[2] + (buf[3] &lt;&lt; 8);

    /* calulate 5A A5 and LEN filed crc */
    crc16_update(&amp;crc, buf, 4);

    /* calulate payload crc */
    crc16_update(&amp;crc, buf + 6, payload_len);
</code></pre></div> <p>得到CRC值为0x516C. 帧CRC校验通过。</p> <ul> <li>第三步：接收数据</li> </ul> <p>从<code>0x91</code>开始为数据包的数据域。在C语言中可以定义结构体来方便的读取数据：</p> <p>定义0x91数据包结构体如下：</p> <div class=highlight><pre><span></span><code>__packed typedef struct
{
    uint8_t     tag;                /* data packet tag */
    uint8_t     id;
    uint8_t     rev[6];             /* reserved */
    uint32_t    ts;                 /* timestamp */
    float       acc[3];
    float       gyr[3];
    float       mag[3];
    float       eul[3];             /* eular angles: Roll,Pitch,Yaw */
    float       quat[4];            /* quaternion */
}id0x91_t;
</code></pre></div> <p><code>__packed</code> 为编译器关键字(Keil下)，表示结构体按字节紧对齐，结构体每一个元素一一对应0x91数据包的结构定义。接收数据时将接收到的数组直接memcpy到结构体即可：(注意定义结构体时必须4字节对齐), 其中<code>buf</code>指向帧头, <code>buf[6]</code>指向帧中数据域 。</p> <div class=highlight><pre><span></span><code>    /* 接收数据并使用0x91数据包结构定义来解释数据 */
    __align(4) id0x91_t dat;    /* struct must be 4 byte aligned */
    memcpy(&amp;dat, &amp;buf[6], sizeof(id0x91_t));
</code></pre></div> <p>最后得到dat数据结果：</p> <div class=highlight><pre><span></span><code>id              : 0
timestamp       : 310205
acc             :    0.224    0.770    0.691
gyr             :  -54.708  -20.077 -119.070
mag             :   19.183  -26.208  -34.542
eul(R/P/Y)      :   48.720  -21.014  -45.512
quat            :    0.855    0.310   -0.310   -0.277
</code></pre></div> <h2 id=at>AT指令</h2> <p>当使用串口与模块通讯时, 模块支持AT 指令集配置/查看模块参数。AT 指令总以ASCII 码<code>AT</code> 开头，后面跟控制字符，最 后以回车换行<code>\r\n</code>结束。可使用串口调试助手进行测试：</p> <p><img alt src=../common_figures/at_cmd.png></p> <p>通用模块 AT指令如下</p> <table> <thead> <tr> <th>指令</th> <th>功能</th> <th>掉电保存(Y)</th> <th>立即生效(Y),复位生效(R)</th> </tr> </thead> <tbody> <tr> <td>AT+ID</td> <td>设置模块用户ID</td> <td>Y</td> <td>R</td> </tr> <tr> <td>AT+URFR</td> <td>旋转模块传感器坐标系</td> <td>Y</td> <td>R</td> </tr> <tr> <td>AT+INFO</td> <td>打印模块信息</td> <td>N</td> <td>Y</td> </tr> <tr> <td>AT+ODR</td> <td>设置模块串口输出帧频率</td> <td>Y</td> <td>R</td> </tr> <tr> <td>AT+BAUD</td> <td>设置串口波特率</td> <td>Y</td> <td>R</td> </tr> <tr> <td>AT+EOUT</td> <td>数据输出开关</td> <td>N</td> <td>Y</td> </tr> <tr> <td>AT+RST</td> <td>复位模块</td> <td>N</td> <td>Y</td> </tr> <tr> <td>AT+TRG</td> <td>单次输出触发</td> <td>N</td> <td>Y</td> </tr> <tr> <td>AT+SETPEL</td> <td>设置输出数据包</td> <td>Y</td> <td>Y</td> </tr> <tr> <td>AT+MODE</td> <td>设置模块工作模式</td> <td>Y</td> <td>R</td> </tr> <tr> <td>AT+GWID</td> <td>设置无线网关ID</td> <td>Y</td> <td>R</td> </tr> <tr> <td>AT+GWCFG</td> <td>设置接收机无线网络属性</td> <td>Y</td> <td>R</td> </tr> </tbody> </table> <h4 id=_21>产品支持数据包列表</h4> <p>下表列出所有产品支持的数据包, ***** 表示支持 **-**表示不支持</p> <table> <thead> <tr> <th>产品</th> <th align=left>ID</th> <th align=left>URFR</th> <th align=left>INFO</th> <th>ODR</th> <th>BAUD</th> <th>EOUT</th> <th>RST</th> <th>TRG</th> <th>SETPTL</th> <th>MODE</th> <th>GWID</th> <th>GWCFG</th> </tr> </thead> <tbody> <tr> <td>HI226</td> <td align=left>*</td> <td align=left>*</td> <td align=left>*</td> <td>*</td> <td>*</td> <td>*</td> <td>*</td> <td>*</td> <td>*</td> <td>-</td> <td>-</td> <td>-</td> </tr> <tr> <td>HI229</td> <td align=left>*</td> <td align=left>*</td> <td align=left>*</td> <td>*</td> <td>*</td> <td>*</td> <td>*</td> <td>*</td> <td>*</td> <td>*</td> <td>-</td> <td>-</td> </tr> <tr> <td>CH110</td> <td align=left>*</td> <td align=left>*</td> <td align=left>*</td> <td>*</td> <td>*</td> <td>*</td> <td>*</td> <td>-</td> <td>*</td> <td>-</td> <td>-</td> <td>-</td> </tr> <tr> <td>HI221</td> <td align=left>*</td> <td align=left>*</td> <td align=left>*</td> <td>*</td> <td>*</td> <td>*</td> <td>*</td> <td>-</td> <td>-</td> <td>-</td> <td>*</td> <td>-</td> </tr> <tr> <td>HI221GW</td> <td align=left>*</td> <td align=left>*</td> <td align=left>*</td> <td>*</td> <td>*</td> <td>*</td> <td>*</td> <td>-</td> <td>-</td> <td>-</td> <td>*</td> <td>*</td> </tr> </tbody> </table> <h5 id=atid>AT+ID</h5> <p>设置模块用户ID</p> <p><strong>例</strong> <code>AT+ID=1</code></p> <h5 id=aturfr>AT+URFR</h5> <p>某些情况下传感器需要倾斜垂直安装，这时候需要旋转传感器坐标系，这条指令提供了旋转传感器坐标系的接口：</p> <p><code>AT+URFR=C00,C01,C02,C10,C11,C12,C20,C21,C22</code> </p> <p>其中 <span><span class=MathJax_Preview>C_{nn}</span><script type=math/tex>C_{nn}</script></span> 支持浮点数 </p> <div> <div class=MathJax_Preview> \left\{\begin{array}{l}{X} \\ {Y} \\ {Z}\end{array}\right\}_{U}=\left[\begin{array}{lll}{C 00} &amp; {C 01} &amp; {C 02} \\ {C 10} &amp; {C 11} &amp; {C 12} \\ {C 20} &amp; {C 21} &amp; {C 22}\end{array}\right] \cdot\left\{\begin{array}{l}{X} \\ {Y} \\ {Z}\end{array}\right\}_{B} </div> <script type="math/tex; mode=display">
\left\{\begin{array}{l}{X} \\ {Y} \\ {Z}\end{array}\right\}_{U}=\left[\begin{array}{lll}{C 00} & {C 01} & {C 02} \\ {C 10} & {C 11} & {C 12} \\ {C 20} & {C 21} & {C 22}\end{array}\right] \cdot\left\{\begin{array}{l}{X} \\ {Y} \\ {Z}\end{array}\right\}_{B}
</script> </div> <p>其中<span><span class=MathJax_Preview>\left\{\begin{array}{l}{X} \\ {Y} \\ {Z}\end{array}\right\}_{U}</span><script type=math/tex>\left\{\begin{array}{l}{X} \\ {Y} \\ {Z}\end{array}\right\}_{U}</script></span>为旋转后的 传感器坐标系下 传感器数据，<span><span class=MathJax_Preview>\left\{\begin{array}{l}{X} \\ {Y} \\ {Z}\end{array}\right\}_{B}</span><script type=math/tex>\left\{\begin{array}{l}{X} \\ {Y} \\ {Z}\end{array}\right\}_{B}</script></span>为旋转前 传感器坐标系下 传感器数据</p> <p>下面是几种常用旋转举例：</p> <ul> <li> <p>新传感器坐标系为 绕原坐标系X轴 旋转 90°， 输入命令：<code>AT+URFR=1,0,0,0,0,1,0,-1,0</code></p> </li> <li> <p>新传感器坐标系为 绕原坐标系X轴 旋转-90°， 输入命令：<code>AT+URFR=1,0,0,0,0,-1,0,1,0</code></p> </li> <li> <p>新传感器坐标系为 绕原坐标系X轴 旋转180°， 输入命令：<code>AT+URFR=1,0,0,0,-1,0,0,0,-1</code></p> </li> <li> <p>新传感器坐标系为 绕原坐标系Y轴 旋转 90°， 输入命令：<code>AT+URFR= 0,0,-1,0,1,0,1,0,0</code></p> </li> <li> <p>新传感器坐标系为 绕原坐标系Y轴 旋转-90°， 输入命令：<code>AT+URFR= 0,0,1,0,1,0,-1,0,0</code></p> </li> <li> <p>新传感器坐标系为 绕原坐标系Y轴 旋转180°， 输入命令：<code>AT+URFR= -1,0,0,0,1,0,0,0,-1</code></p> </li> <li> <p>恢复默认值：<code>AT+URFR=1,0,0,0,1,0,0,0,1</code></p> </li> </ul> <h5 id=atinfo>AT+INFO</h5> <p>打印模块信息，包括产品型号，版本，固件发布日期等。AT+INFO可以拓展二级指令实现更多信息的查询</p> <table> <thead> <tr> <th>INFO二级拓展指令</th> <th>功能</th> <th>示例</th> </tr> </thead> <tbody> <tr> <td>CAL</td> <td>显示模块内部校准参数</td> <td>AT+INFO=CAL</td> </tr> <tr> <td>RF</td> <td>显示无线设备参数</td> <td>AT+INFO=RF</td> </tr> <tr> <td>VER</td> <td>显示详细版本信息</td> <td>AT+INFO=VER</td> </tr> </tbody> </table> <h5 id=atodr>AT+ODR</h5> <p>设置模块串口输出速率。 掉电保存，复位模块生效</p> <p><strong>例</strong> 设置串口输出速率为100Hz: <code>AT+ODR=100</code> </p> <h5 id=atbaud>AT+BAUD</h5> <p>设置串口波特率，可选值：4800/9600/115200/256000/460800`</p> <p><strong>例</strong> <code>AT+BAUD=115200</code></p> <p>!!! note "注意"</p> <ul> <li>使用此指令需要特别注意，输入错误波特率后可能会导致无法和模块通讯</li> <li>波特率参数设置好后掉电保存，复位模块生效。上位机的波特率也要做相应修改。</li> <li>升级固件时，需要切换回115200 波特率。</li> </ul> <h5 id=ateout>AT+EOUT</h5> <p>串口输出开关</p> <p><strong>例</strong> 打开串口输出 <code>AT+EOUT=1</code> 关闭串口输出 <code>AT+EOUT=0</code></p> <h5 id=atrst>AT+RST</h5> <p>复位模块</p> <p><strong>例</strong> <code>AT+RST</code></p> <h5 id=attrg>AT+TRG</h5> <p>触发模块输出一帧数据，可以配合AT+ODR=0来实现单次触发输出。</p> <p><strong>例</strong> <code>AT+TRG</code></p> <h5 id=atsetpel>AT+SETPEL</h5> <p>设置输出协议:</p> <p>模块数据帧中的数据包组成可使用AT指令配置，格式为<code>AT+SETPTL=&lt;ITEM_ID&gt;,&lt;ITEM_ID&gt;...</code> 一帧输出可包含最多8个数据包。</p> <p><strong>例</strong> 配置模块输出加速度，角速度, 整形格式欧拉角和四元数的指令为：<code>AT+SETPTL=A0,B1,D0,D1</code></p> <p><img alt src=../common_figures/at_setptl.png></p> <h5 id=atmode>AT+MODE</h5> <p>设置模块工作模式</p> <p><strong>例</strong> </p> <ul> <li>设置模块工作在6轴模式(无磁校准) <code>AT+MODE=0</code></li> <li>设置模块工作在9轴模式(地磁场传感器参与航向角校正) <code>AT+MODE=1</code></li> </ul> <h5 id=atgwid>AT+GWID</h5> <p>可通过AT+GWID指令配置，GWID属性决定了接收器和节点的RF频率，只有节点的GWID 和接收器的 GWID相同时，模块和接收器直接才能通讯。GWID相当于无线网段，当在同一地点使用多个接收机组成多个星形网络时，必须保证每个接收器的GWID(网段)不同。</p> <p><strong>例</strong> 将一个接收器设置为GWID=3， 并将3个模块的自身ID设置为 0,1,2 并连接到这个接收器上：</p> <p>接收机配置：</p> <p><code>AT+GWID=3</code></p> <p>节点0配置： </p> <p><code>AT+GWID=3</code> </p> <p><code>AT+ID=0</code></p> <p>节点1配置：</p> <p><code>AT+GWID=3</code> </p> <p><code>AT+ID=1</code></p> <p>节点2配置：</p> <p><code>AT+GWID=3</code> </p> <p><code>AT+ID=2</code></p> <p>最后所有接收机节点复位/重新上电生效。</p> <h5 id=atgwcfg>AT+GWCFG</h5> <p>配置接收机支持的节点数和无线通讯频率。接收机默认支持8个节点，每个节点100Hz通讯频率。(通讯频率乘以节点)的乘积受到RF带宽的限制，错误的配置将会导致无法输出数据。推荐的配置如下：</p> <table> <thead> <tr> <th>配置选项</th> <th>通讯频率(Hz,每个节点)</th> <th>支持的节点数</th> </tr> </thead> <tbody> <tr> <td>1(出厂默认)</td> <td>100</td> <td>8</td> </tr> <tr> <td>2</td> <td>200</td> <td>4</td> </tr> <tr> <td>3</td> <td>30</td> <td>16</td> </tr> </tbody> </table> <p><strong>例</strong> 配置接收机支持的最大节点数为16，每个节点接收频率为30Hz，依次输入:</p> <p><code>AT+GWCFG=FRQ,30</code></p> <p><code>AT+GWCFG=CNT,16</code></p> <h2 id=c->附录C - 固件升级与恢复出厂设置</h2> <p>本产品支持升级固件。 固件升级步骤:</p> <ul> <li>连接模块，打开上位机，将模块和上位机波特率都设置为115200. 打开固件升级窗口</li> <li>点击连接按钮，如出现模块连接信息。则说明升级系统准备就绪，点击文件选择器(…)选择拓 展名为.hex 的固件，然后点击开始编程。下载完成后会提示编程完成，此时关闭串口， 重新给模块上电，模块升级完成。</li> </ul> <p><img alt src=../common_figures/firmware_update.png></p> </article> </div> </div> </main> <footer class=md-footer> <div class="md-footer-meta md-typeset"> <div class="md-footer-meta__inner md-grid"> <div class=md-footer-copyright> <div class=md-footer-copyright__highlight> Copyright &copy; 2016 - 2020 HiPNUC </div> powered by <a href=https://www.mkdocs.org target=_blank rel=noopener>MkDocs</a> and <a href=https://squidfunk.github.io/mkdocs-material/ target=_blank rel=noopener> Material for MkDocs</a> </div> </div> </div> </footer> </div> <script src=../../assets/javascripts/application.c33a9706.js></script> <script>app.initialize({version:"1.0.4",url:{base:"../.."}})</script> <script src=../../extra.js></script> <script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.0/MathJax.js?config=TeX-MML-AM_CHTML"></script> </body> </html>