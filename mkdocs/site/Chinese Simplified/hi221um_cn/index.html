<!doctype html><html lang=en class=no-js> <head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta http-equiv=x-ua-compatible content="ie=edge"><meta name=lang:clipboard.copy content="Copy to clipboard"><meta name=lang:clipboard.copied content="Copied to clipboard"><meta name=lang:search.language content=en><meta name=lang:search.pipeline.stopwords content=True><meta name=lang:search.pipeline.trimmer content=True><meta name=lang:search.result.none content="No matching documents"><meta name=lang:search.result.one content="1 matching document"><meta name=lang:search.result.other content="# matching documents"><meta name=lang:search.tokenizer content=[\s\-]+><link rel="shortcut icon" href=../../assets/images/favicon.png><meta name=generator content="mkdocs-1.0.4, mkdocs-material-4.6.0"><title>HI221/HI221GW 用户手册 - HiPNUC</title><link rel=stylesheet href=../../assets/stylesheets/application.1b62728e.css><link rel=stylesheet href=assets/javascripts/bootstrap.min.css><link rel=stylesheet href=../../assets/stylesheets/application-palette.a8b3c06d.css><meta name=theme-color content><script src=../../assets/javascripts/modernizr.268332fc.js></script><link href=https://fonts.gstatic.com rel=preconnect crossorigin><link rel=stylesheet href="https://fonts.googleapis.com/css?family=Roboto:300,400,400i,700%7CRoboto+Mono&display=fallback"><style>body,input{font-family:"Roboto","Helvetica Neue",Helvetica,Arial,sans-serif}code,kbd,pre{font-family:"Roboto Mono","Courier New",Courier,monospace}</style><link rel=stylesheet href=../../assets/fonts/material-icons.css></head> <body dir=ltr data-md-color-primary=white data-md-color-accent=white> <svg class=md-svg> <defs> </defs> </svg> <input class=md-toggle data-md-toggle=drawer type=checkbox id=__drawer autocomplete=off> <input class=md-toggle data-md-toggle=search type=checkbox id=__search autocomplete=off> <label class=md-overlay data-md-component=overlay for=__drawer></label> <a href=#hi221hi221gw tabindex=1 class=md-skip> Skip to content </a> <header class=md-header data-md-component=header> <nav class="md-header-nav md-grid"> <div class=md-flex> <div class="md-flex__cell md-flex__cell--shrink"> <a href=../../index.html title=HiPNUC class="md-header-nav__button md-logo"> <i class=md-icon>undo</i> </a> </div> <div class="md-flex__cell md-flex__cell--shrink"> <label class="md-icon md-icon--menu md-header-nav__button" for=__drawer></label> </div> <div class="md-flex__cell md-flex__cell--stretch"> <div class="md-flex__ellipsis md-header-nav__title" data-md-component=title> <span class=md-header-nav__topic> HiPNUC </span> <span class=md-header-nav__topic> HI221/HI221GW 用户手册 </span> </div> </div> <div class="md-flex__cell md-flex__cell--shrink"> <label class="md-icon md-icon--search md-header-nav__button" for=__search></label> <div class=md-search data-md-component=search role=dialog> <label class=md-search__overlay for=__search></label> <div class=md-search__inner role=search> <form class=md-search__form name=search> <input type=text class=md-search__input name=query placeholder=Search autocapitalize=off autocorrect=off autocomplete=off spellcheck=false data-md-component=query data-md-state=active> <label class="md-icon md-search__icon" for=__search></label> <button type=reset class="md-icon md-search__icon" data-md-component=reset tabindex=-1> &#xE5CD; </button> </form> <div class=md-search__output> <div class=md-search__scrollwrap data-md-scrollfix> <div class=md-search-result data-md-component=result> <div class=md-search-result__meta> Type to start searching </div> <ol class=md-search-result__list></ol> </div> </div> </div> </div> </div> </div> </div> </nav> </header> <div class=md-container> <nav class="md-tabs md-tabs--active" data-md-component=tabs> <div class="md-tabs__inner md-grid"> <ul class=md-tabs__list> <li class=md-tabs__item> <a href=../.. class=md-tabs__link> User Guides/用戶指南/用户指南 </a> </li> <li class=md-tabs__item> <a href=./ class="md-tabs__link md-tabs__link--active"> Chinese Simplified </a> </li> <li class=md-tabs__item> <a href="../../Chinese Traditional/hi221um_tc/" class=md-tabs__link> Chinese Traditional </a> </li> <li class=md-tabs__item> <a href=../../English/hi221um_en/ class=md-tabs__link> English </a> </li> </ul> </div> </nav> <main class=md-main role=main> <div class="md-main__inner md-grid" data-md-component=container> <div class="md-sidebar md-sidebar--primary" data-md-component=navigation> <div class=md-sidebar__scrollwrap> <div class=md-sidebar__inner> <nav class="md-nav md-nav--primary" data-md-level=0> <label class="md-nav__title md-nav__title--site" for=__drawer> <a href=../.. title=HiPNUC class="md-nav__button md-logo"> <i class=md-icon>undo</i> </a> HiPNUC </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../.. title="User Guides/用戶指南/用户指南" class=md-nav__link> User Guides/用戶指南/用户指南 </a> </li> <li class="md-nav__item md-nav__item--active md-nav__item--nested"> <input class="md-toggle md-nav__toggle" data-md-toggle=nav-2 type=checkbox id=nav-2 checked> <label class=md-nav__link for=nav-2> Chinese Simplified </label> <nav class=md-nav data-md-component=collapsible data-md-level=1> <label class=md-nav__title for=nav-2> Chinese Simplified </label> <ul class=md-nav__list data-md-scrollfix> <li class="md-nav__item md-nav__item--active"> <input class="md-toggle md-nav__toggle" data-md-toggle=toc type=checkbox id=__toc> <label class="md-nav__link md-nav__link--active" for=__toc> HI221/HI221GW 用户手册 </label> <a href=./ title="HI221/HI221GW 用户手册" class="md-nav__link md-nav__link--active"> HI221/HI221GW 用户手册 </a> <nav class="md-nav md-nav--secondary"> <label class=md-nav__title for=__toc>Table of contents</label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=#_1 class=md-nav__link> 简介 </a> </li> <li class=md-nav__item> <a href=#_2 class=md-nav__link> 特性 </a> <nav class=md-nav> <ul class=md-nav__list> <li class=md-nav__item> <a href=#_3 class=md-nav__link> 板载传感器 </a> </li> <li class=md-nav__item> <a href=#_4 class=md-nav__link> 数据处理 </a> </li> <li class=md-nav__item> <a href=#_5 class=md-nav__link> 通讯接口及供电 </a> </li> <li class=md-nav__item> <a href=#_6 class=md-nav__link> 其他 </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#_7 class=md-nav__link> 硬件及尺寸(节点) </a> <nav class=md-nav> <ul class=md-nav__list> <li class=md-nav__item> <a href=#_8 class=md-nav__link> 硬件参数 </a> </li> <li class=md-nav__item> <a href=#_9 class=md-nav__link> 安装建议 </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#_10 class=md-nav__link> 性能指标 </a> <nav class=md-nav> <ul class=md-nav__list> <li class=md-nav__item> <a href=#_11 class=md-nav__link> 姿态角输出精度 </a> </li> <li class=md-nav__item> <a href=#_12 class=md-nav__link> 陀螺仪 </a> </li> <li class=md-nav__item> <a href=#_13 class=md-nav__link> 加速度计 </a> </li> <li class=md-nav__item> <a href=#_14 class=md-nav__link> 磁传感器参数 </a> </li> <li class=md-nav__item> <a href=#uart class=md-nav__link> 模块数据接口参数(UART) </a> </li> <li class=md-nav__item> <a href=#24g-rf class=md-nav__link> 模块数据接口参数(2.4G RF) </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#_15 class=md-nav__link> 参考系定义 </a> </li> <li class=md-nav__item> <a href=#_16 class=md-nav__link> 串口通讯协议 </a> <nav class=md-nav> <ul class=md-nav__list> <li class=md-nav__item> <a href=#_17 class=md-nav__link> 数据包格式 </a> </li> <li class=md-nav__item> <a href=#_18 class=md-nav__link> 出厂默认寄存器 </a> </li> <li class=md-nav__item> <a href=#_19 class=md-nav__link> 数据帧结构示例 </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#at class=md-nav__link> 通用AT指令 </a> <nav class=md-nav> <ul class=md-nav__list> <li class=md-nav__item> <a href=#atid class=md-nav__link> AT+ID </a> </li> <li class=md-nav__item> <a href=#atgwid class=md-nav__link> AT+GWID </a> </li> <li class=md-nav__item> <a href=#aturfr class=md-nav__link> AT+URFR </a> </li> <li class=md-nav__item> <a href=#atinfo class=md-nav__link> AT+INFO </a> </li> <li class=md-nav__item> <a href=#atodr class=md-nav__link> AT+ODR </a> </li> <li class=md-nav__item> <a href=#atbaud class=md-nav__link> AT+BAUD </a> </li> <li class=md-nav__item> <a href=#ateout class=md-nav__link> AT+EOUT </a> </li> <li class=md-nav__item> <a href=#atrst class=md-nav__link> AT+RST </a> </li> <li class=md-nav__item> <a href=#attrg class=md-nav__link> AT+TRG </a> </li> <li class=md-nav__item> <a href=#atsetpel class=md-nav__link> AT+SETPEL </a> </li> <li class=md-nav__item> <a href=#atmode class=md-nav__link> AT+MODE </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#b- class=md-nav__link> 附录B - 四元数-欧拉角转换 </a> <nav class=md-nav> <ul class=md-nav__list> <li class=md-nav__item> <a href=#_20 class=md-nav__link> 四元数基础 </a> </li> <li class=md-nav__item> <a href=#_21 class=md-nav__link> 四元数与旋转矩阵，欧拉角转换 </a> <nav class=md-nav> <ul class=md-nav__list> <li class=md-nav__item> <a href=#- class=md-nav__link> 四元数-&gt;旋转矩阵 </a> </li> <li class=md-nav__item> <a href=#-_1 class=md-nav__link> 四元数-&gt;欧拉角 </a> </li> <li class=md-nav__item> <a href=#-_2 class=md-nav__link> 欧拉角-&gt;四元数 </a> </li> <li class=md-nav__item> <a href=#-n-b class=md-nav__link> 欧拉角-&gt;旋转矩阵(n-&gt;b) </a> </li> <li class=md-nav__item> <a href=#n-b class=md-nav__link> 旋转矩阵(n-&gt;b) 到欧拉角 </a> </li> </ul> </nav> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#c- class=md-nav__link> 附录C - 固件升级与恢复出厂设置 </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=../hi229um_cn/ title="HI226/HI229 用户手册" class=md-nav__link> HI226/HI229 用户手册 </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-toggle md-nav__toggle" data-md-toggle=nav-3 type=checkbox id=nav-3> <label class=md-nav__link for=nav-3> Chinese Traditional </label> <nav class=md-nav data-md-component=collapsible data-md-level=1> <label class=md-nav__title for=nav-3> Chinese Traditional </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href="../../Chinese Traditional/hi221um_tc/" title="HI221/HI221GW 用戶手冊" class=md-nav__link> HI221/HI221GW 用戶手冊 </a> </li> <li class=md-nav__item> <a href="../../Chinese Traditional/hi229um_tc/" title="HI226/HI229 用戶手冊" class=md-nav__link> HI226/HI229 用戶手冊 </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-toggle md-nav__toggle" data-md-toggle=nav-4 type=checkbox id=nav-4> <label class=md-nav__link for=nav-4> English </label> <nav class=md-nav data-md-component=collapsible data-md-level=1> <label class=md-nav__title for=nav-4> English </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../English/hi221um_en/ title="HI221/HI221GW User Guide" class=md-nav__link> HI221/HI221GW User Guide </a> </li> <li class=md-nav__item> <a href=../../English/hi229um_en/ title="HI226/HI229 User Guide" class=md-nav__link> HI226/HI229 User Guide </a> </li> </ul> </nav> </li> </ul> </nav> </div> </div> </div> <div class="md-sidebar md-sidebar--secondary" data-md-component=toc> <div class=md-sidebar__scrollwrap> <div class=md-sidebar__inner> <nav class="md-nav md-nav--secondary"> <label class=md-nav__title for=__toc>Table of contents</label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=#_1 class=md-nav__link> 简介 </a> </li> <li class=md-nav__item> <a href=#_2 class=md-nav__link> 特性 </a> <nav class=md-nav> <ul class=md-nav__list> <li class=md-nav__item> <a href=#_3 class=md-nav__link> 板载传感器 </a> </li> <li class=md-nav__item> <a href=#_4 class=md-nav__link> 数据处理 </a> </li> <li class=md-nav__item> <a href=#_5 class=md-nav__link> 通讯接口及供电 </a> </li> <li class=md-nav__item> <a href=#_6 class=md-nav__link> 其他 </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#_7 class=md-nav__link> 硬件及尺寸(节点) </a> <nav class=md-nav> <ul class=md-nav__list> <li class=md-nav__item> <a href=#_8 class=md-nav__link> 硬件参数 </a> </li> <li class=md-nav__item> <a href=#_9 class=md-nav__link> 安装建议 </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#_10 class=md-nav__link> 性能指标 </a> <nav class=md-nav> <ul class=md-nav__list> <li class=md-nav__item> <a href=#_11 class=md-nav__link> 姿态角输出精度 </a> </li> <li class=md-nav__item> <a href=#_12 class=md-nav__link> 陀螺仪 </a> </li> <li class=md-nav__item> <a href=#_13 class=md-nav__link> 加速度计 </a> </li> <li class=md-nav__item> <a href=#_14 class=md-nav__link> 磁传感器参数 </a> </li> <li class=md-nav__item> <a href=#uart class=md-nav__link> 模块数据接口参数(UART) </a> </li> <li class=md-nav__item> <a href=#24g-rf class=md-nav__link> 模块数据接口参数(2.4G RF) </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#_15 class=md-nav__link> 参考系定义 </a> </li> <li class=md-nav__item> <a href=#_16 class=md-nav__link> 串口通讯协议 </a> <nav class=md-nav> <ul class=md-nav__list> <li class=md-nav__item> <a href=#_17 class=md-nav__link> 数据包格式 </a> </li> <li class=md-nav__item> <a href=#_18 class=md-nav__link> 出厂默认寄存器 </a> </li> <li class=md-nav__item> <a href=#_19 class=md-nav__link> 数据帧结构示例 </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#at class=md-nav__link> 通用AT指令 </a> <nav class=md-nav> <ul class=md-nav__list> <li class=md-nav__item> <a href=#atid class=md-nav__link> AT+ID </a> </li> <li class=md-nav__item> <a href=#atgwid class=md-nav__link> AT+GWID </a> </li> <li class=md-nav__item> <a href=#aturfr class=md-nav__link> AT+URFR </a> </li> <li class=md-nav__item> <a href=#atinfo class=md-nav__link> AT+INFO </a> </li> <li class=md-nav__item> <a href=#atodr class=md-nav__link> AT+ODR </a> </li> <li class=md-nav__item> <a href=#atbaud class=md-nav__link> AT+BAUD </a> </li> <li class=md-nav__item> <a href=#ateout class=md-nav__link> AT+EOUT </a> </li> <li class=md-nav__item> <a href=#atrst class=md-nav__link> AT+RST </a> </li> <li class=md-nav__item> <a href=#attrg class=md-nav__link> AT+TRG </a> </li> <li class=md-nav__item> <a href=#atsetpel class=md-nav__link> AT+SETPEL </a> </li> <li class=md-nav__item> <a href=#atmode class=md-nav__link> AT+MODE </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#b- class=md-nav__link> 附录B - 四元数-欧拉角转换 </a> <nav class=md-nav> <ul class=md-nav__list> <li class=md-nav__item> <a href=#_20 class=md-nav__link> 四元数基础 </a> </li> <li class=md-nav__item> <a href=#_21 class=md-nav__link> 四元数与旋转矩阵，欧拉角转换 </a> <nav class=md-nav> <ul class=md-nav__list> <li class=md-nav__item> <a href=#- class=md-nav__link> 四元数-&gt;旋转矩阵 </a> </li> <li class=md-nav__item> <a href=#-_1 class=md-nav__link> 四元数-&gt;欧拉角 </a> </li> <li class=md-nav__item> <a href=#-_2 class=md-nav__link> 欧拉角-&gt;四元数 </a> </li> <li class=md-nav__item> <a href=#-n-b class=md-nav__link> 欧拉角-&gt;旋转矩阵(n-&gt;b) </a> </li> <li class=md-nav__item> <a href=#n-b class=md-nav__link> 旋转矩阵(n-&gt;b) 到欧拉角 </a> </li> </ul> </nav> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#c- class=md-nav__link> 附录C - 固件升级与恢复出厂设置 </a> </li> </ul> </nav> </div> </div> </div> <div class=md-content> <article class="md-content__inner md-typeset"> <h1 id=hi221hi221gw>HI221/HI221GW 用户手册</h1> <p><p style="text-align: right;">HI221 无线传输模块及接收器, Rev 0.2</p> <p><img alt src=../figures/front_image.png></p> <div style="page-break-after: always;"></div> <div class=toc> <ul> <li><a href=#hi221hi221gw>HI221/HI221GW 用户手册</a><ul> <li><a href=#_1>简介</a></li> <li><a href=#_2>特性</a><ul> <li><a href=#_3>板载传感器</a></li> <li><a href=#_4>数据处理</a></li> <li><a href=#_5>通讯接口及供电</a></li> <li><a href=#_6>其他</a></li> </ul> </li> <li><a href=#_7>硬件及尺寸(节点)</a><ul> <li><a href=#_8>硬件参数</a></li> <li><a href=#_9>安装建议</a></li> </ul> </li> <li><a href=#_10>性能指标</a><ul> <li><a href=#_11>姿态角输出精度</a></li> <li><a href=#_12>陀螺仪</a></li> <li><a href=#_13>加速度计</a></li> <li><a href=#_14>磁传感器参数</a></li> <li><a href=#uart>模块数据接口参数(UART)</a></li> <li><a href=#24g-rf>模块数据接口参数(2.4G RF)</a></li> </ul> </li> <li><a href=#_15>参考系定义</a></li> <li><a href=#_16>串口通讯协议</a><ul> <li><a href=#_17>数据包格式</a></li> <li><a href=#_18>出厂默认寄存器</a></li> <li><a href=#_19>数据帧结构示例</a></li> </ul> </li> <li><a href=#at>通用AT指令</a><ul> <li><a href=#atid>AT+ID</a></li> <li><a href=#atgwid>AT+GWID</a></li> <li><a href=#aturfr>AT+URFR</a></li> <li><a href=#atinfo>AT+INFO</a></li> <li><a href=#atodr>AT+ODR</a></li> <li><a href=#atbaud>AT+BAUD</a></li> <li><a href=#ateout>AT+EOUT</a></li> <li><a href=#atrst>AT+RST</a></li> <li><a href=#attrg>AT+TRG</a></li> <li><a href=#atsetpel>AT+SETPEL</a></li> <li><a href=#atmode>AT+MODE</a></li> </ul> </li> <li><a href=#b->附录B - 四元数-欧拉角转换</a><ul> <li><a href=#_20>四元数基础</a></li> <li><a href=#_21>四元数与旋转矩阵，欧拉角转换</a><ul> <li><a href=#->四元数-&gt;旋转矩阵</a></li> <li><a href=#-_1>四元数-&gt;欧拉角</a></li> <li><a href=#-_2>欧拉角-&gt;四元数</a></li> <li><a href=#-n-b>欧拉角-&gt;旋转矩阵(n-&gt;b)</a></li> <li><a href=#n-b>旋转矩阵(n-&gt;b) 到欧拉角</a></li> </ul> </li> </ul> </li> <li><a href=#c->附录C - 固件升级与恢复出厂设置</a></li> </ul> </li> </ul> </div> <div style="page-break-after: always;"></div> <h2 id=_1>简介</h2> <p>H221/HI221GW是超核电子推出的一款低成本、高性能、小体积、低延时的惯性测量单元（IMU），本产品集成了三轴加速度计、三轴陀螺仪以及一款低功耗微处理器。可输出经过传感器融合算法计算得到的基于当地地理坐标的三维方位数据，包含横滚角、俯仰角以及以相对的航向角。同时也可以输出原始的传感器数据。HI221 由**HI221GW(接收机)** 和 **HI221(姿态模块)**组成。一个HI221GW和最多8个HI221模块组成星形网络结构。每个HI221可输出最高达100Hz的实时姿态数据。</p> <p><img alt src=../figures/star_network.png></p> <p><img alt src=../figures/star_network_1.jpg></p> <h2 id=_2>特性</h2> <h3 id=_3>板载传感器</h3> <ul> <li>三轴陀螺仪, 最大量程: ±2000°/s 输出速率 2000Hz</li> <li>三轴加速度计, 最大量程:±8g 输出速率 125Hz</li> <li>三轴地磁场传感器，最大量程: 800mG 内部采样率 100Hz</li> </ul> <h3 id=_4>数据处理</h3> <ul> <li>加速度出厂前经过校准</li> <li>数据融合算法计算并输出地理坐标系下的旋转四元数及欧拉角</li> </ul> <h3 id=_5>通讯接口及供电</h3> <ul> <li>串口(兼容TTL 可直接与5V 或3.3V 串口设备连接)</li> <li>供电电压：3.3 (&plusmn; 100 mV)</li> <li>最大峰值功耗：120mA(RF Tx发射)</li> </ul> <h3 id=_6>其他</h3> <ul> <li>PC端上位机程序，提供实时数据显示，波形，校准及excel 数据记录功能</li> <li>多项模块参数用户可配置</li> </ul> <h2 id=_7>硬件及尺寸(节点)</h2> <h3 id=_8>硬件参数</h3> <table> <thead> <tr> <th>参数</th> <th>描述</th> </tr> </thead> <tbody> <tr> <td>输出数据接口</td> <td>UART(TTL 1.8V - 3.3V) 或者 2.4RF Radio</td> </tr> <tr> <td>工作电压</td> <td>3.3V (± 100mV)</td> </tr> <tr> <td>功耗</td> <td>396mW @3.3V</td> </tr> <tr> <td>温度范围</td> <td>-20℃ - 85 ℃</td> </tr> <tr> <td>最大线性加速度</td> <td>0 - 115 <span><span class=MathJax_Preview>m/s^2</span><script type=math/tex>m/s^2</script></span></td> </tr> <tr> <td>尺寸</td> <td>20 x 38 x 8.5mm (W x L x H)</td> </tr> <tr> <td>板载传感器</td> <td>三轴加速度计 三轴陀螺仪 三轴地磁场传感器</td> </tr> </tbody> </table> <h3 id=_9>安装建议</h3> <p>由于传感器制造工艺的原因，XY 和 Z 轴性能有略微差异，安装时建议将模块 Z 轴与重力方向保持平行(既水平安装)。尽量让距离模块10cm 内不能有铁质外壳，小功率电机等磁性器件。</p> <h2 id=_10>性能指标</h2> <h3 id=_11>姿态角输出精度</h3> <table> <thead> <tr> <th>姿态角</th> <th>典型值</th> <th>最大值</th> </tr> </thead> <tbody> <tr> <td>横滚角\俯仰角 - 静态</td> <td>0.2°</td> <td>0.4°</td> </tr> <tr> <td>横滚角\俯仰角 - 动态</td> <td>0.5°</td> <td>2.0°</td> </tr> <tr> <td>航向角</td> <td>-</td> <td>-</td> </tr> </tbody> </table> <h3 id=_12>陀螺仪</h3> <table> <thead> <tr> <th>参数</th> <th>值</th> </tr> </thead> <tbody> <tr> <td>测量范围</td> <td>±2000°/s</td> </tr> <tr> <td>非线性度</td> <td>±0.1% (25°最佳)</td> </tr> <tr> <td>噪声密度</td> <td>0.08°/s/<span><span class=MathJax_Preview>\sqrt{Hz}</span><script type=math/tex>\sqrt{Hz}</script></span></td> </tr> <tr> <td>采样率</td> <td>2000Hz</td> </tr> </tbody> </table> <h3 id=_13>加速度计</h3> <table> <thead> <tr> <th>参数</th> <th>值</th> </tr> </thead> <tbody> <tr> <td>测量范围</td> <td>±8G</td> </tr> <tr> <td>非线性度</td> <td>±0.5% (25°最佳)</td> </tr> <tr> <td>最大零点偏移</td> <td>10mG(校准后)</td> </tr> <tr> <td>噪声密度</td> <td>250 <span><span class=MathJax_Preview>uG\sqrt{Hz}</span><script type=math/tex>uG\sqrt{Hz}</script></span></td> </tr> <tr> <td>采样率</td> <td>125Hz</td> </tr> </tbody> </table> <h3 id=_14>磁传感器参数</h3> <table> <thead> <tr> <th>参数</th> <th>值</th> </tr> </thead> <tbody> <tr> <td>测量范围</td> <td>±8Gauss</td> </tr> <tr> <td>非线性度</td> <td>±0.1%</td> </tr> <tr> <td>采样率</td> <td>100Hz</td> </tr> </tbody> </table> <h3 id=uart>模块数据接口参数(UART)</h3> <table> <thead> <tr> <th>参数</th> <th>值</th> </tr> </thead> <tbody> <tr> <td>串口输出波特率</td> <td>4800/9600/115200/460800可选</td> </tr> <tr> <td>帧输出速率</td> <td>1 - 400Hz</td> </tr> </tbody> </table> <h3 id=24g-rf>模块数据接口参数(2.4G RF)</h3> <table> <thead> <tr> <th>参数</th> <th>值</th> </tr> </thead> <tbody> <tr> <td>空中波特率</td> <td>1Mbps</td> </tr> <tr> <td>帧输出速率</td> <td>100Hz</td> </tr> <tr> <td>接收器最大连接模块数</td> <td>8</td> </tr> </tbody> </table> <h2 id=_15>参考系定义</h2> <p>本产品采用右手(RH, Right-Hand)坐标系。输出的四元数及欧拉角为 传感器坐标系 到 惯性坐标系(世界坐标系) 的旋转。其中欧拉角旋转顺序为 ZYX(先转Z轴，再转Y轴，最后转X轴)旋转顺序，欧拉角具体定义如下：</p> <ul> <li>绕 Z 轴方向旋转: 航向角\Yaw\phi(<span><span class=MathJax_Preview>\psi</span><script type=math/tex>\psi</script></span>) 范围: -180° - 180°</li> <li>绕 Y 轴方向旋转: 俯仰角\Pitch\theta(<span><span class=MathJax_Preview>\theta</span><script type=math/tex>\theta</script></span>) 范围: -90°-90°</li> <li>绕 X 轴方向旋转:横滚角\Roll\psi( <span><span class=MathJax_Preview>\phi</span><script type=math/tex>\phi</script></span>)范围: -180°-180°</li> </ul> <p>本产品使用北西天(North-West-Up NWU) 坐标系统，即视为模块的地理坐标系(世界坐标系)定义如下：</p> <ul> <li>X 轴正方向指向北</li> <li>Y 轴正方向指向西</li> <li>Z 轴正方向指向天</li> </ul> <p>当采用 NWU 系时，如果将模块视为飞行器的话。X 轴应视为机头方向。当传感器系与惯性系重合时，欧拉角的理想输出为:Pitch = 0°, Roll = 0°, Yaw = 0°</p> <h2 id=_16>串口通讯协议</h2> <h3 id=_17>数据包格式</h3> <p>模块资料包中提供了C 和C#的数据解析函数以供参考。模块上电后，模块默认按100Hz (出厂默认输出速率) 输出数据包，数据包格式如下：</p> <table> <thead> <tr> <th>域</th> <th>同步帧头</th> <th>帧类型</th> <th>帧长度</th> <th>CRC16</th> <th>帧携带数据</th> </tr> </thead> <tbody> <tr> <td>名称</td> <td>PRE</td> <td>TYPE</td> <td>LEN</td> <td>CRC</td> <td>REG_ADDR(N) + DATA(N)</td> </tr> <tr> <td>大小(byte)</td> <td>0</td> <td>1</td> <td>2</td> <td>2</td> <td>可变(1-64)</td> </tr> <tr> <td>偏移(byte)</td> <td>0</td> <td>1</td> <td>2</td> <td>4</td> <td>6</td> </tr> <tr> <td>值(hex)</td> <td>0x5A</td> <td>0xA5</td> <td>帧长度</td> <td>CRC校验码</td> <td>具体意义参看下节</td> </tr> <tr> <td>类型</td> <td>uint8_t</td> <td>uint8_t</td> <td>uint16_t</td> <td>uint16_t</td> <td>-</td> </tr> </tbody> </table> <ul> <li> <p>PRE 固定为0x5A</p> </li> <li> <p>TYPE 固定为0xA5 代表数据帧</p> </li> <li> <p>LEN 帧中数据域的长度。一帧最大为256 字节LSB(低字节在前)，长度只是值真正数据的长度，不包含<code>PRE</code>,<code>TYPE</code>,<code>LEN</code>,<code>CRC</code> 字段。</p> </li> <li> <p>CRC **除CRC 本身外**其余所有帧数据的16 位CRC 校验和LSB[^LSB]。CRC实现函数：</p> </li> </ul> <div class=highlight><pre><span></span>/*
    currectCrc: previous crc value, set 0 if it&#39;s first section
    src: source stream data
    lengthInBytes: length
*/
static void crc16_update(uint16_t *currectCrc, const uint8_t *src, uint32_t lengthInBytes)
{
    uint32_t crc = *currectCrc;
    uint32_t j;
    for (j=0; j &lt; lengthInBytes; ++j)
    {
        uint32_t i;
        uint32_t byte = src[j];
        crc ^= byte &lt;&lt; 8;
        for (i = 0; i &lt; 8; ++i)
        {
            uint32_t temp = crc &lt;&lt; 1;
            if (crc &amp; 0x8000)
            {
                temp ^= 0x1021;
            }
            crc = temp;
        }
    } 
    *currectCrc = crc;
}
</pre></div> <ul> <li>REG_ADDR和DATA 一帧数据可由多个数据包组成，每个数据包包含寄存器地址(REG_ADDR)和寄存器数据(DATA) 两部分。寄存器地址决定了数据的类型及长 度，DATA 为寄存器数据内容。模块支持的寄存器列表如下:</li> </ul> <table> <thead> <tr> <th>寄存器地址</th> <th>寄存器长度(字节)</th> <th>名称</th> <th>单位</th> </tr> </thead> <tbody> <tr> <td>0x90</td> <td>1</td> <td>用户ID</td> <td>无</td> </tr> <tr> <td>0xA0</td> <td>6</td> <td>加速度</td> <td>0.001G[^G]</td> </tr> <tr> <td>0xA5</td> <td>6</td> <td>线性加速度</td> <td>0.001G</td> </tr> <tr> <td>0xB0</td> <td>6</td> <td>角速度</td> <td>0.1°/s</td> </tr> <tr> <td>0xC0</td> <td>6</td> <td>磁场强度</td> <td>0.001Gauss</td> </tr> <tr> <td>0xD0</td> <td>6</td> <td>欧拉角 (整形输出)</td> <td>度</td> </tr> <tr> <td>0xD9</td> <td>12</td> <td>欧拉角(浮点输出)</td> <td>度</td> </tr> <tr> <td>0xD1</td> <td>16</td> <td>四元数</td> <td>N/A</td> </tr> <tr> <td>0xF0</td> <td>4</td> <td>气压</td> <td>Pa</td> </tr> <tr> <td>0x71</td> <td>128-256字节可变</td> <td>无线节点四元数集合</td> <td>无</td> </tr> <tr> <td>0x72</td> <td>48-96字节可变</td> <td>无线节点欧拉角集合</td> <td>同0xD0</td> </tr> <tr> <td>0x75</td> <td>48-96字节可变</td> <td>无线节点加速度集合</td> <td>同0xA0</td> </tr> <tr> <td>0x78</td> <td>48-96字节可变</td> <td>无线节点角速度集合</td> <td>同0xB0</td> </tr> <tr> <td>0x61</td> <td>3</td> <td>无线数据帧拓展标识</td> <td>N/A</td> </tr> </tbody> </table> <p>[^G]: 1G = 1x当地重力加速度</p> <ul> <li> <p>0x90 用户ID</p> </li> <li> <p>0xA0 加速度，格式为int16，共三个轴，每个轴占2 个字节，X、Y、Z 三轴共6 个字节，LSB。传感器输出的原始加速度</p> </li> <li> <p>0xA5 性加速度，格式为int16，共三个轴，每个轴占2 个字节，X、Y、Z 三轴共6 个字节，LSB。地理坐标系下去除重力分量的加速度值</p> </li> <li> <p>0xB0 角速度，格式为int16，共三个轴，每个轴占2 个字节，X、Y、Z 三轴共6 个字节，LSB。传感器输出的角速度</p> </li> <li> <p>0xC0 磁场强度，格式为int16，共三个轴，每个轴占2 个字节，X、Y、Z 三轴共6 个字节，LSB。传感器输出的磁场强度</p> </li> <li> <p>0xD0 欧拉角整形格式，格式为int16，共三个轴，每个轴占2 个字节，顺序为Pitch/Roll/Yaw。LSB。接收到Roll, Pitch 为物理值乘以100 后得到的数值，Yaw 为乘以10 得到的数值举例：当接收到的Yaw = 100 时，表示航向角为10°</p> </li> <li> <p>0xD9 浮点格式输出的欧拉角。格式为float，共3 个值(Pitch/Roll/Yaw)，每个值占4 字节(float 型单精度 浮点数)，LSB。</p> </li> <li> <p>0XD1 四元数，格式为float，共4个值，顺序为:W X Y Z.。每个值占4 字节(float)，整个四元数为4个float，共16字节，LSB。</p> </li> <li> <p>0XF0 气压。(只针对有气压传感器的产品)</p> </li> <li> <p>0x71 (仅支持HI221GW)节点四元数集合. 所有节点的四元数， 每个节点16字节，从0到最后一个节点顺序排列。每个节点 4个浮点数，分别为W X Y Z, 每个数用float 型表示，每个float 4字节。float为LSB</p> </li> <li> <p>0x72 (仅支持HI221GW)节点欧拉集合. 所有节点的欧拉角， 每个节点6字节，从0到最后一个节点顺序排列。每个节点欧拉为角整形格式，格式为int16，共三个轴，每个轴占2 个字节，顺序为Pitch/Roll/Yaw。LSB。接收到Roll, Pitch 为物理值乘以100 后得到的数值，Yaw 为乘以10 得到的数值举例：当接收到的Yaw = 100 时，表示航向角为10°</p> </li> <li> <p>0x75 (仅支持HI221GW)节点加速度集合. 每个节点6字节，从0到最后一个节点顺序排列。每个节点3个int16_t 型数据。分别为X Y Z的加速度。每个int16_t 占2字节， LSB</p> </li> <li> <p>0x78 (仅支持HI221GW)节点角速度集合. 每个节点6字节，从0到最后一个节点顺序排列。每个节点3个int16_t 型数据。分别为X Y Z的角速度。每个int16_t 占2字节， LSB</p> </li> <li> <p>0x61</p> </li> </ul> <p>(仅支持HI221GW)数据帧拓展信息标识，共3个字节:</p> <table> <thead> <tr> <th>数据帧拓展信息字节偏移</th> <th>值</th> <th>说明</th> </tr> </thead> <tbody> <tr> <td>0</td> <td>-</td> <td>保留</td> </tr> <tr> <td>1</td> <td>GWID</td> <td>接收机GWID</td> </tr> <tr> <td>2</td> <td>CNT</td> <td>此帧包含无线节点数: 1-16</td> </tr> </tbody> </table> <h3 id=_18>出厂默认寄存器</h3> <p>出厂默认一帧中携带寄存器数据定义如下：</p> <p>HI226/HI229:</p> <table> <thead> <tr> <th>顺序</th> <th>数据包</th> <th>说明</th> </tr> </thead> <tbody> <tr> <td>1</td> <td>0x90</td> <td>用户ID</td> </tr> <tr> <td>2</td> <td>0xA0</td> <td>加速度</td> </tr> <tr> <td>3</td> <td>0xB0</td> <td>角速度</td> </tr> <tr> <td>4</td> <td>0xC0</td> <td>磁场强度</td> </tr> <tr> <td>5</td> <td>0xD0</td> <td>欧拉角(整形输出)</td> </tr> <tr> <td>6</td> <td>0xF0</td> <td>气压</td> </tr> </tbody> </table> <p>HI221GW(无线节点接收机):</p> <table> <thead> <tr> <th>顺序</th> <th>寄存器</th> <th>说明</th> </tr> </thead> <tbody> <tr> <td>1</td> <td>0x71</td> <td>四元数</td> </tr> <tr> <td>2</td> <td>0x75</td> <td>加速度</td> </tr> </tbody> </table> <h3 id=_19>数据帧结构示例</h3> <p>假设输出的数据帧带有 <code>A0,B0,D0</code> 寄存器，使用串口助手采样一帧数据如下所示:</p> <p><code>5A</code> <code>A5</code> <code>15</code> <code>00</code> <code>A9</code> <code>8B</code> <code>A0</code> <code>EA</code> <code>FF</code> <code>D0</code> <code>03</code> <code>45</code> <code>FF</code> <code>B0</code> <code>00</code> <code>00</code> <code>00</code> <code>00</code> <code>00</code> <code>00</code> <code>D0</code> <code>87</code> <code>00</code> <code>6F</code> <code>27</code> <code>F5</code> <code>FF</code> </p> <p>其中：</p> <p><code>5A</code> <code>A5</code>帧头</p> <p><code>15</code> <code>00</code>帧数据域长度：<code>(0x00&lt;&lt;8) + 0x15 = 21</code></p> <p><code>A9</code> <code>8B</code>帧CRC校验值: <code>(0x8B&lt;&lt;8) + 0xA9 = 0x8BA9</code></p> <p><code>A0</code> <code>EA</code> <code>FF</code> <code>D0</code> <code>03</code> <code>45</code> <code>FF</code> 加速度数据包, <code>A0</code>为加速度寄存器地址， 三轴加速度为： </p> <p>​ AccX = (int16_t)((0xFF&lt;&lt;8)+ 0xEA) = -22 ​ <br> ​ AccY = (int16_t)((0x03&lt;&lt;8)+ 0xD0) = 976 ​ <br> ​ AccZ = (int16_t)((0xFF&lt;&lt;8)+ 0x45) = -187</p> <p><code>B0</code> <code>00</code> <code>00</code> <code>00</code> <code>00</code> <code>00</code> <code>00</code> 角速度数据包, <code>B0</code>为角速度寄存器地址， 三轴角速度全为0</p> <p><code>D0</code> <code>87</code> <code>00</code> <code>6F</code> <code>27</code> <code>F5</code> <code>FF</code> 欧拉角数据包, <code>D0</code>为欧拉角寄存器地址</p> <p>​ Pitch= (int16_t)((0x00&lt;&lt;8)+ 0x87) / 100 = 1.35° </p> <p>​ Roll= (int16_t)((0x27&lt;&lt;8)+ 0x6F) / 100 = 100.95°</p> <p>​ Yaw = (int16_t)((0xFF&lt;&lt;8)+ 0xF5) / 10 = -1.1°</p> <p>计算CRC校验值：</p> <p>记上面接收到的一帧数据存为C语言uint8_t 数组 buf:</p> <div class=highlight><pre><span></span>    uint16_t payload_len;
    uint16_t crc;

    crc = 0;
    payload_len = buf[2] + (buf[3] &lt;&lt; 8);

    /* calulate 5A A5 and LEN filed crc */
    crc16_update(&amp;crc, buf, 4);

    /* calulate payload crc */
    crc16_update(&amp;crc, buf + 6, payload_len);
</pre></div> <p>​ 最后计算得 CRC值为 0x8BA9, 与帧携带CRC值相同，帧校验正确。</p> <h2 id=at>通用AT指令</h2> <p>模块采用AT 指令集配置/查看模块参数。AT 指令总以ASCII 码<code>AT</code> 开头，后面跟控制字符，最 后以回车换行<code>\r\n</code>结束。可使用串口调试助手进行测试：</p> <p><img alt src=../common_figures/at_cmd.png></p> <p>通用模块 AT指令如下</p> <table> <thead> <tr> <th>指令</th> <th>功能</th> <th>掉电不保存且立即生效(N) / 掉电保存且重启生效(Y)</th> </tr> </thead> <tbody> <tr> <td>AT+ID</td> <td>设置模块用户ID</td> <td>Y</td> </tr> <tr> <td>AT+GWID</td> <td>设置无线网关ID(针对于无线产品)</td> <td>Y</td> </tr> <tr> <td>AT+URFR</td> <td>旋转模块传感器坐标系</td> <td>Y</td> </tr> <tr> <td>AT+INFO</td> <td>打印模块信息</td> <td>N</td> </tr> <tr> <td>AT+ODR</td> <td>设置模块串口输出帧频率</td> <td>Y</td> </tr> <tr> <td>AT+BAUD</td> <td>设置串口波特率</td> <td>Y</td> </tr> <tr> <td>AT+EOUT</td> <td>数据输出开关</td> <td>N</td> </tr> <tr> <td>AT+RST</td> <td>复位模块</td> <td>N</td> </tr> <tr> <td>AT+TRG</td> <td>单次输出触发</td> <td>N</td> </tr> <tr> <td>AT+SETPEL</td> <td>设置输出数据包</td> <td>Y</td> </tr> <tr> <td>AT+MODE</td> <td>设置模块工作模式</td> <td>Y</td> </tr> </tbody> </table> <h5 id=atid>AT+ID</h5> <p>设置模块用户ID</p> <p><strong>例</strong> <code>AT+ID=1</code></p> <h5 id=atgwid>AT+GWID</h5> <p>(仅支持HI221) HI221GW(接收机) 和 HI221(节点) 拥有GWID属性，可通过AT+GWID指令配置，GWID属性决定了接收器和节点的RF频率，只有HI221模块的GWID 和 接收器的 GWID属性相同时，模块和接收器直接才能通讯。GWID相当于无线网段，当在同一地点使用多个接收机组成多个星形网络时，必须保证每个接收器的GWID(网段)不同。</p> <p><strong>例</strong> 将一个接收器设置为GWID=3， 并将3个模块的自身ID设置为 0,1,2 并连接到这个接收器上：</p> <p>接收机配置：<code>AT+GWID=3</code></p> <p>节点0配置： <code>AT+GWID=3</code> <code>AT+ID=0</code></p> <p>节点1配置： <code>AT+GWID=3</code> <code>AT+ID=1</code></p> <p>节点2配置： <code>AT+GWID=3</code> <code>AT+ID=2</code></p> <h5 id=aturfr>AT+URFR</h5> <p>某些情况下传感器需要倾斜垂直安装，这时候需要旋转传感器坐标系，这条指令提供了旋转传感器坐标系的接口：</p> <p><code>AT+URFR=C00,C01,C02,C10,C11,C12,C20,C21,C22</code> </p> <p>其中 <span><span class=MathJax_Preview>C_{nn}</span><script type=math/tex>C_{nn}</script></span> 支持浮点数 </p> <div> <div class=MathJax_Preview> \left\{\begin{array}{l}{X} \\ {Y} \\ {Z}\end{array}\right\}_{U}=\left[\begin{array}{lll}{C 00} &amp; {C 01} &amp; {C 02} \\ {C 10} &amp; {C 11} &amp; {C 12} \\ {C 20} &amp; {C 21} &amp; {C 22}\end{array}\right] \cdot\left\{\begin{array}{l}{X} \\ {Y} \\ {Z}\end{array}\right\}_{B} </div> <script type="math/tex; mode=display">
\left\{\begin{array}{l}{X} \\ {Y} \\ {Z}\end{array}\right\}_{U}=\left[\begin{array}{lll}{C 00} & {C 01} & {C 02} \\ {C 10} & {C 11} & {C 12} \\ {C 20} & {C 21} & {C 22}\end{array}\right] \cdot\left\{\begin{array}{l}{X} \\ {Y} \\ {Z}\end{array}\right\}_{B}
</script> </div> <p>其中<span><span class=MathJax_Preview>\left\{\begin{array}{l}{X} \\ {Y} \\ {Z}\end{array}\right\}_{U}</span><script type=math/tex>\left\{\begin{array}{l}{X} \\ {Y} \\ {Z}\end{array}\right\}_{U}</script></span>为旋转后的 传感器坐标系下 传感器数据，<span><span class=MathJax_Preview>\left\{\begin{array}{l}{X} \\ {Y} \\ {Z}\end{array}\right\}_{B}</span><script type=math/tex>\left\{\begin{array}{l}{X} \\ {Y} \\ {Z}\end{array}\right\}_{B}</script></span>为旋转前 传感器坐标系下 传感器数据</p> <p>下面是几种常用旋转举例：</p> <ul> <li> <p>新传感器坐标系为 绕原坐标系X轴 旋转 90°， 输入命令：<code>AT+URFR=1,0,0,0,0,1,0,-1,0</code></p> </li> <li> <p>新传感器坐标系为 绕原坐标系X轴 旋转-90°， 输入命令：<code>AT+URFR=1,0,0,0,0,-1,0,1,0</code></p> </li> <li> <p>新传感器坐标系为 绕原坐标系X轴 旋转180°， 输入命令：<code>AT+URFR=1,0,0,0,-1,0,0,0,-1</code></p> </li> <li> <p>新传感器坐标系为 绕原坐标系Y轴 旋转 90°， 输入命令：<code>AT+URFR= 0,0,-1,0,1,0,1,0,0</code></p> </li> <li> <p>新传感器坐标系为 绕原坐标系Y轴 旋转-90°， 输入命令：<code>AT+URFR= 0,0,1,0,1,0,-1,0,0</code></p> </li> <li> <p>新传感器坐标系为 绕原坐标系Y轴 旋转180°， 输入命令：<code>AT+URFR= -1,0,0,0,1,0,0,0,-1</code></p> </li> <li> <p>恢复默认值：<code>AT+URFR=1,0,0,0,1,0,0,0,1</code></p> </li> </ul> <h5 id=atinfo>AT+INFO</h5> <p>打印模块信息，包括产品型号，版本，固件发布日期等。AT+INFO可以拓展二级指令实现更多信息的查询</p> <table> <thead> <tr> <th>INFO二级拓展指令</th> <th>功能</th> <th>示例</th> </tr> </thead> <tbody> <tr> <td>CAL</td> <td>显示模块内部校准参数</td> <td>AT+INFO=CAL</td> </tr> <tr> <td>RF</td> <td>显示无线设备参数</td> <td>AT+INFO=RF</td> </tr> <tr> <td>VER</td> <td>显示详细版本信息</td> <td>AT+INFO=VER</td> </tr> </tbody> </table> <h5 id=atodr>AT+ODR</h5> <p>设置模块串口输出速率。 掉电保存，复位模块生效</p> <p><strong>例</strong> 设置串口输出速率为100Hz: <code>AT+ODR=100</code> </p> <h5 id=atbaud>AT+BAUD</h5> <p>设置串口波特率，可选值：4800/9600/115200/256000/460800`</p> <p><strong>例</strong> <code>AT+BAUD=115200</code></p> <p>!!! note "注意"</p> <ul> <li>使用此指令需要特别注意，输入错误波特率后可能会导致无法和模块通讯</li> <li>波特率参数设置好后掉电保存，复位模块生效。上位机的波特率也要做相应修改。</li> <li>升级固件时，需要切换回115200 波特率。</li> </ul> <h5 id=ateout>AT+EOUT</h5> <p>串口输出开关</p> <p><strong>例</strong> 打开串口输出 <code>AT+EOUT=1</code> 关闭串口输出 <code>AT+EOUT=0</code></p> <h5 id=atrst>AT+RST</h5> <p>复位模块</p> <p><strong>例</strong> <code>AT+RST</code></p> <h5 id=attrg>AT+TRG</h5> <p>触发模块输出一帧数据，可以配合AT+ODR=0来实现单次触发输出。</p> <p><strong>例</strong> <code>AT+TRG</code></p> <h5 id=atsetpel>AT+SETPEL</h5> <p>设置输出协议:</p> <p>模块数据帧中的数据包组成可使用AT指令配置，格式为<code>AT+SETPTL=&lt;ITEM_ID&gt;,&lt;ITEM_ID&gt;...</code> 一帧输出可包含最多8个数据包。</p> <p><strong>例</strong> 配置模块输出加速度，角速度, 整形格式欧拉角和四元数的指令为：<code>AT+SETPTL=A0,B1,D0,D1</code></p> <p><img alt src=../common_figures/at_setptl.png></p> <h5 id=atmode>AT+MODE</h5> <p>设置模块工作模式</p> <p><strong>例</strong> </p> <ul> <li>设置模块工作在6轴模式(无磁校准) <code>AT+MODE=0</code></li> <li>设置模块工作在9轴模式(地磁场传感器参与航向角校正) <code>AT+MODE=1</code></li> </ul> <h2 id=b->附录B - 四元数-欧拉角转换</h2> <h3 id=_20>四元数基础</h3> <p>四元数是一个四维空间上的一点，使用一个实数和三个虚数来代表：<span><span class=MathJax_Preview>q \in \mathbb{R}^{4}=\mathbb{H}</span><script type=math/tex>q \in \mathbb{R}^{4}=\mathbb{H}</script></span></p> <p>四元数有如下几种常用的表示方法：</p> <table> <thead> <tr> <th>复数表示</th> <th>向量表示</th> <th>四元数表示法1</th> <th>四元数表示法2</th> </tr> </thead> <tbody> <tr> <td><span><span class=MathJax_Preview>q=q_{0}+\mathrm{i} q_{1}+\mathrm{j} q_{2}+\mathrm{k} q_{3}</span><script type=math/tex>q=q_{0}+\mathrm{i} q_{1}+\mathrm{j} q_{2}+\mathrm{k} q_{3}</script></span></td> <td><span><span class=MathJax_Preview>q=\left[q_{0}, \mathbf{q}\right]=\left[q_{0},\left(\begin{array}{l}{q_{1}} \\ {q_{2}} \\ {q_{3}}\end{array}\right)\right]</span><script type=math/tex>q=\left[q_{0}, \mathbf{q}\right]=\left[q_{0},\left(\begin{array}{l}{q_{1}} \\ {q_{2}} \\ {q_{3}}\end{array}\right)\right]</script></span></td> <td><span><span class=MathJax_Preview>q=\left[q_{0}, q_{1}, q_{2}, q_{3}\right]</span><script type=math/tex>q=\left[q_{0}, q_{1}, q_{2}, q_{3}\right]</script></span></td> <td><span><span class=MathJax_Preview>q=\left[q_{w}, q_{x}, q_{y}, q_{z}\right]</span><script type=math/tex>q=\left[q_{w}, q_{x}, q_{y}, q_{z}\right]</script></span></td> </tr> </tbody> </table> <p>其中：</p> <div> <div class=MathJax_Preview> \mathrm{i}^{2}=\mathrm{j}^{2}=\mathrm{k}^{2}=\mathrm{ijk}=-1 </div> <script type="math/tex; mode=display">
\mathrm{i}^{2}=\mathrm{j}^{2}=\mathrm{k}^{2}=\mathrm{ijk}=-1
</script> </div> <div> <div class=MathJax_Preview> \mathrm{ij}=\mathrm{k}=-\mathrm{ji}, \quad \mathrm{jk}=\mathrm{i}=-\mathrm{kj}, \quad \mathrm{ki}=\mathrm{j}=-\mathrm{ik} </div> <script type="math/tex; mode=display">
\mathrm{ij}=\mathrm{k}=-\mathrm{ji}, \quad \mathrm{jk}=\mathrm{i}=-\mathrm{kj}, \quad \mathrm{ki}=\mathrm{j}=-\mathrm{ik}
</script> </div> <p>四元数乘法：</p> <div> <div class=MathJax_Preview> \mathbf{p} \otimes \mathbf{q}=\left[\begin{array}{l}{p_{w} q_{w}-p_{x} q_{x}-p_{y} q_{y}-p_{z} q_{z}} \\ {p_{w} q_{x}+p_{x} q_{w}+p_{y} q_{z}-p_{z} q_{y}} \\ {p_{w} q_{y}-p_{x} q_{z}+p_{y} q_{w}+p_{z} q_{x}} \\ {p_{w} q_{z}+p_{x} q_{y}-p_{y} q_{x}+p_{z} q_{w}}\end{array}\right] </div> <script type="math/tex; mode=display">
\mathbf{p} \otimes \mathbf{q}=\left[\begin{array}{l}{p_{w} q_{w}-p_{x} q_{x}-p_{y} q_{y}-p_{z} q_{z}} \\ {p_{w} q_{x}+p_{x} q_{w}+p_{y} q_{z}-p_{z} q_{y}} \\ {p_{w} q_{y}-p_{x} q_{z}+p_{y} q_{w}+p_{z} q_{x}} \\ {p_{w} q_{z}+p_{x} q_{y}-p_{y} q_{x}+p_{z} q_{w}}\end{array}\right]
</script> </div> <p>一个单位四元数总是可以表示为这种这种形式：<span><span class=MathJax_Preview>q_{R}(\alpha, \mathbf{u})=\left[\cos \frac{\alpha}{2}, \sin \frac{\alpha}{2} \cdot \mathbf{u}\right]</span><script type=math/tex>q_{R}(\alpha, \mathbf{u})=\left[\cos \frac{\alpha}{2}, \sin \frac{\alpha}{2} \cdot \mathbf{u}\right]</script></span></p> <p>其中<span><span class=MathJax_Preview>\alpha</span><script type=math/tex>\alpha</script></span> 是旋转角度，<span><span class=MathJax_Preview>\mathbf{u} \in \mathbb{R}^{3}</span><script type=math/tex>\mathbf{u} \in \mathbb{R}^{3}</script></span> 为旋转轴，且<span><span class=MathJax_Preview>\|\mathbf{u}\|=1</span><script type=math/tex>\|\mathbf{u}\|=1</script></span>.</p> <h3 id=_21>四元数与旋转矩阵，欧拉角转换</h3> <h4 id=->四元数-&gt;旋转矩阵</h4> <p>(其中四元数是 b-&gt;n, R为 n-&gt;b)</p> <div> <div class=MathJax_Preview> R^{b}_{n} =\left[\begin{array}{ccc}{q_{0}^{2}+q_{1}^{2}-q_{2}^{2}-q_{3}^{2}} &amp; {2\left(q_{1} q_{2}+q_{0} q_{3}\right)} &amp; {2\left(q_{1} q_{3}-q_{0} q_{2}\right)} \\ {2\left(q_{1} q_{2}-q_{0} q_{3}\right)} &amp; {q_{0}^{2}-q_{1}^{2}+q_{2}^{2}-q_{3}^{2}} &amp; {2\left(q_{2} q_{3}+q_{0} q_{1}\right)} \\ {2\left(q_{1} q_{3}+q_{0} q_{2}\right)} &amp; {2\left(q_{2} q_{3}-q_{0} q_{1}\right)} &amp; {q_{0}^{2}-q_{1}^{2}-q_{2}^{2}+q_{3}^{2}}\end{array}\right] </div> <script type="math/tex; mode=display">
R^{b}_{n} =\left[\begin{array}{ccc}{q_{0}^{2}+q_{1}^{2}-q_{2}^{2}-q_{3}^{2}} & {2\left(q_{1} q_{2}+q_{0} q_{3}\right)} & {2\left(q_{1} q_{3}-q_{0} q_{2}\right)} \\ {2\left(q_{1} q_{2}-q_{0} q_{3}\right)} & {q_{0}^{2}-q_{1}^{2}+q_{2}^{2}-q_{3}^{2}} & {2\left(q_{2} q_{3}+q_{0} q_{1}\right)} \\ {2\left(q_{1} q_{3}+q_{0} q_{2}\right)} & {2\left(q_{2} q_{3}-q_{0} q_{1}\right)} & {q_{0}^{2}-q_{1}^{2}-q_{2}^{2}+q_{3}^{2}}\end{array}\right]
</script> </div> <h4 id=-_1>四元数-&gt;欧拉角</h4> <p>旋转矩阵，四元数和欧拉角是表示旋转的三种常用方式，其中另外两种表示形式转换为欧拉角时，必须先指定欧拉角旋转顺序。本产品使用"ZYX"旋转顺序,即先旋转航向角，然后俯仰角，最后横滚角：</p> <p>转换公式为：</p> <div> <div class=MathJax_Preview> \left[\begin{array}{c}{\phi}(横滚) \\ {\theta}(俯仰) \\ {\psi}(航向)\end{array}\right] = \left[\begin{array}{c}{\operatorname{atan} 2\left(2 q_{2} q_{3}+2 q_{0} q_{1}, {q_{3}^{2}-q_{2}^{2}-q_{1}^{2}+q_{0}^{2} )}\right.} \\ {-\operatorname{asin}\left(2 q_{1} q_{3}-2 q_{0} q_{2}\right)} \\ {\operatorname{atan} 2\left(2 q_{1} q_{2}+2 q_{0} q_{3}\right)} , {q_{1}^{2}+q_{0}^{2}-q_{3}^{2}-q_{2}^{2} )}\end{array}\right] </div> <script type="math/tex; mode=display">
\left[\begin{array}{c}{\phi}(横滚) \\ {\theta}(俯仰) \\ {\psi}(航向)\end{array}\right] = \left[\begin{array}{c}{\operatorname{atan} 2\left(2 q_{2} q_{3}+2 q_{0} q_{1},  {q_{3}^{2}-q_{2}^{2}-q_{1}^{2}+q_{0}^{2} )}\right.} \\ {-\operatorname{asin}\left(2 q_{1} q_{3}-2 q_{0} q_{2}\right)} \\ {\operatorname{atan} 2\left(2 q_{1} q_{2}+2 q_{0} q_{3}\right)} , {q_{1}^{2}+q_{0}^{2}-q_{3}^{2}-q_{2}^{2} )}\end{array}\right]
</script> </div> <h4 id=-_2>欧拉角-&gt;四元数</h4> <p>记<span><span class=MathJax_Preview>s_{\phi}= \sin \frac{\phi}{2}, c_{\phi}= \cos \frac{\phi}{2}</span><script type=math/tex>s_{\phi}= \sin \frac{\phi}{2}, c_{\phi}= \cos \frac{\phi}{2}</script></span>,以此类推：</p> <div> <div class=MathJax_Preview> \mathbf{q}=\left[\begin{array}{c}{c_{\phi / 2} c_{\theta / 2} c_{\psi / 2}+s_{\phi / 2} s_{\theta / 2} s_{\psi / 2}} \\ {-c_{\phi / 2} s_{\theta / 2} s_{\psi / 2}+c_{\theta / 2} c_{\psi / 2} s_{\phi / 2}} \\ {c_{\phi / 2} c_{\psi / 2} s_{\theta / 2}+s_{\phi / 2} c_{\theta / 2} s_{\psi / 2}} \\ {c_{\phi / 2} c_{\theta / 2} s_{\psi / 2}-s_{\phi / 2} c_{\psi / 2} s_{\theta / 2}}\end{array}\right] </div> <script type="math/tex; mode=display">
\mathbf{q}=\left[\begin{array}{c}{c_{\phi / 2} c_{\theta / 2} c_{\psi / 2}+s_{\phi / 2} s_{\theta / 2} s_{\psi / 2}} \\ {-c_{\phi / 2} s_{\theta / 2} s_{\psi / 2}+c_{\theta / 2} c_{\psi / 2} s_{\phi / 2}} \\ {c_{\phi / 2} c_{\psi / 2} s_{\theta / 2}+s_{\phi / 2} c_{\theta / 2} s_{\psi / 2}} \\ {c_{\phi / 2} c_{\theta / 2} s_{\psi / 2}-s_{\phi / 2} c_{\psi / 2} s_{\theta / 2}}\end{array}\right]
</script> </div> <h4 id=-n-b>欧拉角-&gt;旋转矩阵(n-&gt;b)</h4> <div> <div class=MathJax_Preview> R^{b}_{n} = \left[\begin{array}{ccc}{c_{\theta} c_{\psi}} &amp; {c_{\theta} s_{\psi}} &amp; {-s_{\theta}} \\ {s_{\phi} s_{\theta} c_{\psi}-c_{\phi} s_{\psi}} &amp; {s_{\phi} s_{\theta} s_{\psi}+c_{\phi} c_{\psi}} &amp; {c_{\theta} s_{\phi}} \\ {c_{\phi} s_{\theta} c_{\psi}+s_{\phi} s_{\psi}} &amp; {c_{\phi} s_{\theta} s_{\psi}-s_{\phi} c_{\psi}} &amp; {c_{\theta} c_{\phi}}\end{array}\right] </div> <script type="math/tex; mode=display">
R^{b}_{n} = \left[\begin{array}{ccc}{c_{\theta} c_{\psi}} & {c_{\theta} s_{\psi}} & {-s_{\theta}} \\ {s_{\phi} s_{\theta} c_{\psi}-c_{\phi} s_{\psi}} & {s_{\phi} s_{\theta} s_{\psi}+c_{\phi} c_{\psi}} & {c_{\theta} s_{\phi}} \\ {c_{\phi} s_{\theta} c_{\psi}+s_{\phi} s_{\psi}} & {c_{\phi} s_{\theta} s_{\psi}-s_{\phi} c_{\psi}} & {c_{\theta} c_{\phi}}\end{array}\right]
</script> </div> <h4 id=n-b>旋转矩阵(n-&gt;b) 到欧拉角</h4> <div> <div class=MathJax_Preview> \left[\begin{array}{c}{\phi} \\ {\theta} \\ {\psi}\end{array}\right]=\left[\begin{array}{c}{\operatorname{atan} 2\left(r_{23}, r_{33}\right)} \\ {-\operatorname{asin}\left(r_{13}\right)} \\ {\operatorname{atan} 2\left(r_{12}, r_{11}\right)}\end{array}\right] </div> <script type="math/tex; mode=display">
\left[\begin{array}{c}{\phi} \\ {\theta} \\ {\psi}\end{array}\right]=\left[\begin{array}{c}{\operatorname{atan} 2\left(r_{23}, r_{33}\right)} \\ {-\operatorname{asin}\left(r_{13}\right)} \\ {\operatorname{atan} 2\left(r_{12}, r_{11}\right)}\end{array}\right]
</script> </div> <h2 id=c->附录C - 固件升级与恢复出厂设置</h2> <p>本产品支持在线升级固件，请关注超核电子官网www.hipnuc.com 来获取最新固件版本 固件升级步骤:</p> <ul> <li>获取最新的固件程序。拓展名为.hex</li> <li>连接模块，打开上位机，将模块和上位机波特率都设置为115200.切换到固件升级窗口</li> <li>点击连接按钮，如出现模块连接信息。则说明升级系统准备就绪，点击文件选择器(…)选择拓 展名为xxx.hex 的固件，然后点击开始编程。下载完成后会提示编程完成，此时关闭串口， 重新上电，模块升级完成。</li> </ul> <p><img alt src=../common_figures/firmware_update.png></p> </article> </div> </div> </main> </div> <script src=../../assets/javascripts/application.808e90bb.js></script> <script>app.initialize({version:"1.0.4",url:{base:"../.."}})</script> <script src=../../extra.js></script> <script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.0/MathJax.js?config=TeX-MML-AM_CHTML"></script> <script src=assets/javascripts/bootstrap.min.js></script> </body> </html>