<!doctype html><html lang=en class=no-js> <head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta http-equiv=x-ua-compatible content="ie=edge"><link href=http://www.hipnuc.com/hi229/hi229/ rel=canonical><meta name=lang:clipboard.copy content="Copy to clipboard"><meta name=lang:clipboard.copied content="Copied to clipboard"><meta name=lang:search.language content=en><meta name=lang:search.pipeline.stopwords content=True><meta name=lang:search.pipeline.trimmer content=True><meta name=lang:search.result.none content="No matching documents"><meta name=lang:search.result.one content="1 matching document"><meta name=lang:search.result.other content="# matching documents"><meta name=lang:search.tokenizer content=[\s\-]+><link rel="shortcut icon" href=../../assets/images/favicon.png><meta name=generator content="mkdocs-1.1.2, mkdocs-material-4.6.3"><title>HI229 用戶手冊 - HiPNUC 文件與軟體中心</title><link rel=stylesheet href=../../assets/stylesheets/application.adb8469c.css><link rel=stylesheet href=../../assets/stylesheets/application-palette.a8b3c06d.css><meta name=theme-color content><script src=../../assets/javascripts/modernizr.86422ebf.js></script><link href=https://fonts.gstatic.com rel=preconnect crossorigin><link rel=stylesheet href="https://fonts.googleapis.com/css?family=Roboto:300,400,400i,700%7CRoboto+Mono&display=fallback"><style>body,input{font-family:"Roboto","Helvetica Neue",Helvetica,Arial,sans-serif}code,kbd,pre{font-family:"Roboto Mono","Courier New",Courier,monospace}</style><link rel=stylesheet href=../../assets/fonts/material-icons.css></head> <body dir=ltr data-md-color-primary=white data-md-color-accent=indigo> <svg class=md-svg> <defs> </defs> </svg> <input class=md-toggle data-md-toggle=drawer type=checkbox id=__drawer autocomplete=off> <input class=md-toggle data-md-toggle=search type=checkbox id=__search autocomplete=off> <label class=md-overlay data-md-component=overlay for=__drawer></label> <a href=#hi229 tabindex=0 class=md-skip> Skip to content </a> <header class=md-header data-md-component=header> <nav class="md-header-nav md-grid"> <div class=md-flex> <div class="md-flex__cell md-flex__cell--shrink"> <a href=http://www.hipnuc.com title="HiPNUC 文件與軟體中心" aria-label="HiPNUC 文件與軟體中心" class="md-header-nav__button md-logo"> <i class=md-icon>home</i> </a> </div> <div class="md-flex__cell md-flex__cell--shrink"> <label class="md-icon md-icon--menu md-header-nav__button" for=__drawer></label> </div> <div class="md-flex__cell md-flex__cell--stretch"> <div class="md-flex__ellipsis md-header-nav__title" data-md-component=title> <span class=md-header-nav__topic> HiPNUC 文件與軟體中心 </span> <span class=md-header-nav__topic> HI229 用戶手冊 </span> </div> </div> <div class="md-flex__cell md-flex__cell--shrink"> <label class="md-icon md-icon--search md-header-nav__button" for=__search></label> <div class=md-search data-md-component=search role=dialog> <label class=md-search__overlay for=__search></label> <div class=md-search__inner role=search> <form class=md-search__form name=search> <input type=text class=md-search__input aria-label=search name=query placeholder=Search autocapitalize=off autocorrect=off autocomplete=off spellcheck=false data-md-component=query data-md-state=active> <label class="md-icon md-search__icon" for=__search></label> <button type=reset class="md-icon md-search__icon" data-md-component=reset tabindex=-1> &#xE5CD; </button> </form> <div class=md-search__output> <div class=md-search__scrollwrap data-md-scrollfix> <div class=md-search-result data-md-component=result> <div class=md-search-result__meta> Type to start searching </div> <ol class=md-search-result__list></ol> </div> </div> </div> </div> </div> </div> </div> </nav> </header> <div class=md-container> <main class=md-main role=main> <div class="md-main__inner md-grid" data-md-component=container> <div class="md-sidebar md-sidebar--primary" data-md-component=navigation> <div class=md-sidebar__scrollwrap> <div class=md-sidebar__inner> <nav class="md-nav md-nav--primary" data-md-level=0> <label class="md-nav__title md-nav__title--site" for=__drawer> <a href=http://www.hipnuc.com title="HiPNUC 文件與軟體中心" class="md-nav__button md-logo"> <i class=md-icon>home</i> </a> HiPNUC 文件與軟體中心 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../.. title=簡介 class=md-nav__link> 簡介 </a> </li> <li class=md-nav__item> <a href=../../hi221/hi221/ title="HI221/HI221 Dongle 用戶手冊" class=md-nav__link> HI221/HI221 Dongle 用戶手冊 </a> </li> <li class=md-nav__item> <a href=../../hi226/hi226/ title="HI226 用戶手冊" class=md-nav__link> HI226 用戶手冊 </a> </li> <li class="md-nav__item md-nav__item--active"> <input class="md-toggle md-nav__toggle" data-md-toggle=toc type=checkbox id=__toc> <label class="md-nav__link md-nav__link--active" for=__toc> HI229 用戶手冊 </label> <a href=./ title="HI229 用戶手冊" class="md-nav__link md-nav__link--active"> HI229 用戶手冊 </a> <nav class="md-nav md-nav--secondary"> <label class=md-nav__title for=__toc>Table of contents</label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=#_1 class=md-nav__link> 簡介 </a> </li> <li class=md-nav__item> <a href=#_2 class=md-nav__link> 主要特性 </a> <nav class=md-nav> <ul class=md-nav__list> <li class=md-nav__item> <a href=#_3 class=md-nav__link> 板載感測器 </a> </li> <li class=md-nav__item> <a href=#_4 class=md-nav__link> 通訊接口及供電 </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#_5 class=md-nav__link> 硬體參數 </a> </li> <li class=md-nav__item> <a href=#_6 class=md-nav__link> 坐標系定義 </a> </li> <li class=md-nav__item> <a href=#_7 class=md-nav__link> 性能指標 </a> <nav class=md-nav> <ul class=md-nav__list> <li class=md-nav__item> <a href=#_8 class=md-nav__link> 姿態角輸出精度 </a> </li> <li class=md-nav__item> <a href=#_9 class=md-nav__link> 陀螺儀 </a> </li> <li class=md-nav__item> <a href=#_10 class=md-nav__link> 加速度計 </a> </li> <li class=md-nav__item> <a href=#_11 class=md-nav__link> 磁感測器參數 </a> </li> <li class=md-nav__item> <a href=#_12 class=md-nav__link> 模組數據接口參數 </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#_13 class=md-nav__link> 感測器校準 </a> <nav class=md-nav> <ul class=md-nav__list> <li class=md-nav__item> <a href=#_14 class=md-nav__link> 地磁校準 </a> <nav class=md-nav> <ul class=md-nav__list> <li class=md-nav__item> <a href=#_15 class=md-nav__link> 磁干擾分類 </a> </li> <li class=md-nav__item> <a href=#69 class=md-nav__link> 6軸和9軸模式區別 </a> </li> <li class=md-nav__item> <a href=#_16 class=md-nav__link> 校準方法 </a> </li> </ul> </nav> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#_17 class=md-nav__link> 安裝及焊接 </a> </li> <li class=md-nav__item> <a href=#_18 class=md-nav__link> 應用指南 </a> <nav class=md-nav> <ul class=md-nav__list> <li class=md-nav__item> <a href=#pc class=md-nav__link> 模組與PC機連接 </a> </li> <li class=md-nav__item> <a href=#mcu class=md-nav__link> 模組與MCU進行連接 </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#_19 class=md-nav__link> 序列埠通訊協議 </a> </li> <li class=md-nav__item> <a href=#_20 class=md-nav__link> 數據包 </a> <nav class=md-nav> <ul class=md-nav__list> <li class=md-nav__item> <a href=#_21 class=md-nav__link> 數據包總覽 </a> </li> <li class=md-nav__item> <a href=#_22 class=md-nav__link> 產品支援數據包列表 </a> </li> <li class=md-nav__item> <a href=#0x90id class=md-nav__link> 0x90(用戶ID) </a> </li> <li class=md-nav__item> <a href=#0xa0 class=md-nav__link> 0xA0(加速度) </a> </li> <li class=md-nav__item> <a href=#0xb0 class=md-nav__link> 0xB0(角速度) </a> </li> <li class=md-nav__item> <a href=#0xc0 class=md-nav__link> 0xC0(磁場強度) </a> </li> <li class=md-nav__item> <a href=#0xd0 class=md-nav__link> 0xD0(歐拉角) </a> </li> <li class=md-nav__item> <a href=#0xd1 class=md-nav__link> 0XD1(四元數) </a> </li> <li class=md-nav__item> <a href=#0xf0 class=md-nav__link> 0XF0(氣壓) </a> </li> <li class=md-nav__item> <a href=#0x91-imusol class=md-nav__link> 0X91( IMUSOL) </a> </li> <li class=md-nav__item> <a href=#_23 class=md-nav__link> 出廠默認數據包 </a> </li> <li class=md-nav__item> <a href=#_24 class=md-nav__link> 數據幀結構示例 </a> <nav class=md-nav> <ul class=md-nav__list> <li class=md-nav__item> <a href=#0x900xa00xb00xc00xd00xf0 class=md-nav__link> 數據幀配置為 0x90,0xA0,0xB0,0xC0,0xD0,0xF0 數據包 </a> </li> <li class=md-nav__item> <a href=#0x91 class=md-nav__link> 數據幀配置為 0x91 數據包 </a> </li> </ul> </nav> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#at class=md-nav__link> AT指令 </a> <nav class=md-nav> <ul class=md-nav__list> <li class=md-nav__item> <a href=#atid class=md-nav__link> AT+ID </a> </li> <li class=md-nav__item> <a href=#atinfo class=md-nav__link> AT+INFO </a> </li> <li class=md-nav__item> <a href=#atodr class=md-nav__link> AT+ODR </a> </li> <li class=md-nav__item> <a href=#atbaud class=md-nav__link> AT+BAUD </a> </li> <li class=md-nav__item> <a href=#ateout class=md-nav__link> AT+EOUT </a> </li> <li class=md-nav__item> <a href=#atrst class=md-nav__link> AT+RST </a> </li> <li class=md-nav__item> <a href=#atmode class=md-nav__link> AT+MODE </a> </li> <li class=md-nav__item> <a href=#atsetptl class=md-nav__link> AT+SETPTL </a> </li> <li class=md-nav__item> <a href=#attrg class=md-nav__link> AT+TRG </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#a- class=md-nav__link> 附錄A - 評估板 </a> <nav class=md-nav> <ul class=md-nav__list> <li class=md-nav__item> <a href=#_25 class=md-nav__link> 評估板簡介 </a> </li> <li class=md-nav__item> <a href=#_26 class=md-nav__link> 尺寸 </a> </li> <li class=md-nav__item> <a href=#_27 class=md-nav__link> 從評估板上取下產品 </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#b- class=md-nav__link> 附錄B - 韌體升級與恢復出廠設置 </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=../../ch100/ch100/ title="CH100 用戶手冊" class=md-nav__link> CH100 用戶手冊 </a> </li> <li class=md-nav__item> <a href=../../ch110/ch110/ title="CH110 用戶手冊" class=md-nav__link> CH110 用戶手冊 </a> </li> <li class=md-nav__item> <a href=../../FAQ/FAQ/ title=常見問題 class=md-nav__link> 常見問題 </a> </li> </ul> </nav> </div> </div> </div> <div class="md-sidebar md-sidebar--secondary" data-md-component=toc> <div class=md-sidebar__scrollwrap> <div class=md-sidebar__inner> <nav class="md-nav md-nav--secondary"> <label class=md-nav__title for=__toc>Table of contents</label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=#_1 class=md-nav__link> 簡介 </a> </li> <li class=md-nav__item> <a href=#_2 class=md-nav__link> 主要特性 </a> <nav class=md-nav> <ul class=md-nav__list> <li class=md-nav__item> <a href=#_3 class=md-nav__link> 板載感測器 </a> </li> <li class=md-nav__item> <a href=#_4 class=md-nav__link> 通訊接口及供電 </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#_5 class=md-nav__link> 硬體參數 </a> </li> <li class=md-nav__item> <a href=#_6 class=md-nav__link> 坐標系定義 </a> </li> <li class=md-nav__item> <a href=#_7 class=md-nav__link> 性能指標 </a> <nav class=md-nav> <ul class=md-nav__list> <li class=md-nav__item> <a href=#_8 class=md-nav__link> 姿態角輸出精度 </a> </li> <li class=md-nav__item> <a href=#_9 class=md-nav__link> 陀螺儀 </a> </li> <li class=md-nav__item> <a href=#_10 class=md-nav__link> 加速度計 </a> </li> <li class=md-nav__item> <a href=#_11 class=md-nav__link> 磁感測器參數 </a> </li> <li class=md-nav__item> <a href=#_12 class=md-nav__link> 模組數據接口參數 </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#_13 class=md-nav__link> 感測器校準 </a> <nav class=md-nav> <ul class=md-nav__list> <li class=md-nav__item> <a href=#_14 class=md-nav__link> 地磁校準 </a> <nav class=md-nav> <ul class=md-nav__list> <li class=md-nav__item> <a href=#_15 class=md-nav__link> 磁干擾分類 </a> </li> <li class=md-nav__item> <a href=#69 class=md-nav__link> 6軸和9軸模式區別 </a> </li> <li class=md-nav__item> <a href=#_16 class=md-nav__link> 校準方法 </a> </li> </ul> </nav> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#_17 class=md-nav__link> 安裝及焊接 </a> </li> <li class=md-nav__item> <a href=#_18 class=md-nav__link> 應用指南 </a> <nav class=md-nav> <ul class=md-nav__list> <li class=md-nav__item> <a href=#pc class=md-nav__link> 模組與PC機連接 </a> </li> <li class=md-nav__item> <a href=#mcu class=md-nav__link> 模組與MCU進行連接 </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#_19 class=md-nav__link> 序列埠通訊協議 </a> </li> <li class=md-nav__item> <a href=#_20 class=md-nav__link> 數據包 </a> <nav class=md-nav> <ul class=md-nav__list> <li class=md-nav__item> <a href=#_21 class=md-nav__link> 數據包總覽 </a> </li> <li class=md-nav__item> <a href=#_22 class=md-nav__link> 產品支援數據包列表 </a> </li> <li class=md-nav__item> <a href=#0x90id class=md-nav__link> 0x90(用戶ID) </a> </li> <li class=md-nav__item> <a href=#0xa0 class=md-nav__link> 0xA0(加速度) </a> </li> <li class=md-nav__item> <a href=#0xb0 class=md-nav__link> 0xB0(角速度) </a> </li> <li class=md-nav__item> <a href=#0xc0 class=md-nav__link> 0xC0(磁場強度) </a> </li> <li class=md-nav__item> <a href=#0xd0 class=md-nav__link> 0xD0(歐拉角) </a> </li> <li class=md-nav__item> <a href=#0xd1 class=md-nav__link> 0XD1(四元數) </a> </li> <li class=md-nav__item> <a href=#0xf0 class=md-nav__link> 0XF0(氣壓) </a> </li> <li class=md-nav__item> <a href=#0x91-imusol class=md-nav__link> 0X91( IMUSOL) </a> </li> <li class=md-nav__item> <a href=#_23 class=md-nav__link> 出廠默認數據包 </a> </li> <li class=md-nav__item> <a href=#_24 class=md-nav__link> 數據幀結構示例 </a> <nav class=md-nav> <ul class=md-nav__list> <li class=md-nav__item> <a href=#0x900xa00xb00xc00xd00xf0 class=md-nav__link> 數據幀配置為 0x90,0xA0,0xB0,0xC0,0xD0,0xF0 數據包 </a> </li> <li class=md-nav__item> <a href=#0x91 class=md-nav__link> 數據幀配置為 0x91 數據包 </a> </li> </ul> </nav> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#at class=md-nav__link> AT指令 </a> <nav class=md-nav> <ul class=md-nav__list> <li class=md-nav__item> <a href=#atid class=md-nav__link> AT+ID </a> </li> <li class=md-nav__item> <a href=#atinfo class=md-nav__link> AT+INFO </a> </li> <li class=md-nav__item> <a href=#atodr class=md-nav__link> AT+ODR </a> </li> <li class=md-nav__item> <a href=#atbaud class=md-nav__link> AT+BAUD </a> </li> <li class=md-nav__item> <a href=#ateout class=md-nav__link> AT+EOUT </a> </li> <li class=md-nav__item> <a href=#atrst class=md-nav__link> AT+RST </a> </li> <li class=md-nav__item> <a href=#atmode class=md-nav__link> AT+MODE </a> </li> <li class=md-nav__item> <a href=#atsetptl class=md-nav__link> AT+SETPTL </a> </li> <li class=md-nav__item> <a href=#attrg class=md-nav__link> AT+TRG </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#a- class=md-nav__link> 附錄A - 評估板 </a> <nav class=md-nav> <ul class=md-nav__list> <li class=md-nav__item> <a href=#_25 class=md-nav__link> 評估板簡介 </a> </li> <li class=md-nav__item> <a href=#_26 class=md-nav__link> 尺寸 </a> </li> <li class=md-nav__item> <a href=#_27 class=md-nav__link> 從評估板上取下產品 </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#b- class=md-nav__link> 附錄B - 韌體升級與恢復出廠設置 </a> </li> </ul> </nav> </div> </div> </div> <div class=md-content> <article class="md-content__inner md-typeset"> <h1 id=hi229>HI229 用戶手冊</h1> <p><p style="text-align: right;">IMU/VRU/AHRS姿態測量模組, Rev 1.0</p> <p><img alt src=../figures/front_image.png></p> <div style="page-break-after: always;"></div> <div class=toc> <ul> <li><a href=#hi229>HI229 用戶手冊</a><ul> <li><a href=#_1>簡介</a></li> <li><a href=#_2>主要特性</a><ul> <li><a href=#_3>板載感測器</a></li> <li><a href=#_4>通訊接口及供電</a></li> </ul> </li> <li><a href=#_5>硬體參數</a></li> <li><a href=#_6>坐標系定義</a></li> <li><a href=#_7>性能指標</a><ul> <li><a href=#_8>姿態角輸出精度</a></li> <li><a href=#_9>陀螺儀</a></li> <li><a href=#_10>加速度計</a></li> <li><a href=#_11>磁感測器參數</a></li> <li><a href=#_12>模組數據接口參數</a></li> </ul> </li> <li><a href=#_13>感測器校準</a><ul> <li><a href=#_14>地磁校準</a><ul> <li><a href=#_15>磁干擾分類</a></li> <li><a href=#69>6軸和9軸模式區別</a></li> <li><a href=#_16>校準方法</a></li> </ul> </li> </ul> </li> <li><a href=#_17>安裝及焊接</a></li> <li><a href=#_18>應用指南</a><ul> <li><a href=#pc>模組與PC機連接</a></li> <li><a href=#mcu>模組與MCU進行連接</a></li> </ul> </li> <li><a href=#_19>序列埠通訊協議</a></li> <li><a href=#_20>數據包</a><ul> <li><a href=#_21>數據包總覽</a></li> <li><a href=#_22>產品支援數據包列表</a></li> <li><a href=#0x90id>0x90(用戶ID)</a></li> <li><a href=#0xa0>0xA0(加速度)</a></li> <li><a href=#0xb0>0xB0(角速度)</a></li> <li><a href=#0xc0>0xC0(磁場強度)</a></li> <li><a href=#0xd0>0xD0(歐拉角)</a></li> <li><a href=#0xd1>0XD1(四元數)</a></li> <li><a href=#0xf0>0XF0(氣壓)</a></li> <li><a href=#0x91-imusol>0X91( IMUSOL)</a></li> <li><a href=#_23>出廠默認數據包</a></li> <li><a href=#_24>數據幀結構示例</a><ul> <li><a href=#0x900xa00xb00xc00xd00xf0>數據幀配置為 0x90,0xA0,0xB0,0xC0,0xD0,0xF0 數據包</a></li> <li><a href=#0x91>數據幀配置為 0x91 數據包</a></li> </ul> </li> </ul> </li> <li><a href=#at>AT指令</a><ul> <li><a href=#atid>AT+ID</a></li> <li><a href=#atinfo>AT+INFO</a></li> <li><a href=#atodr>AT+ODR</a></li> <li><a href=#atbaud>AT+BAUD</a></li> <li><a href=#ateout>AT+EOUT</a></li> <li><a href=#atrst>AT+RST</a></li> <li><a href=#atmode>AT+MODE</a></li> <li><a href=#atsetptl>AT+SETPTL</a></li> <li><a href=#attrg>AT+TRG</a></li> </ul> </li> <li><a href=#a->附錄A - 評估板</a><ul> <li><a href=#_25>評估板簡介</a></li> <li><a href=#_26>尺寸</a></li> <li><a href=#_27>從評估板上取下產品</a></li> </ul> </li> <li><a href=#b->附錄B - 韌體升級與恢復出廠設置</a></li> </ul> </li> </ul> </div> <div style="page-break-after: always;"></div> <h2 id=_1>簡介</h2> <p>HI229是超核電子推出的一款低成本、高性能、小體積、低延時的航姿參考單元（AHRS），本產品整合了三軸加速度計、三軸陀螺儀、三軸磁場感測器和一款微控制器。可輸出經過感測器融合算法計算得到的基於當地地理坐標的三維方位數據，包含航向角，俯仰角和橫滾角。同時也可以輸出校準過的原始的感測器數據。本產品具有一定的室內地磁抗干擾性能，在一定強度的地磁場干擾環境下仍可正常工作。</p> <p>典型應用:</p> <ul> <li>VR\動作捕捉</li> <li>高動態環境下姿態測量\運動性能評估</li> <li>無人機控制</li> </ul> <h2 id=_2>主要特性</h2> <h3 id=_3>板載感測器</h3> <ul> <li>三軸陀螺儀, 最大量程: ±2000°/s </li> <li>三軸加速度計, 最大量程:±8G </li> <li>三軸磁場感測器，最大量程: 800mG (毫高斯)</li> </ul> <h3 id=_4>通訊接口及供電</h3> <ul> <li>序列埠(兼容TTL 可直接與5V 或3.3V 序列埠設備連接)</li> <li>供電電壓：3.3 (&plusmn; 100 mV)</li> <li>最大峰值功耗：32mA</li> </ul> <h2 id=_5>硬體參數</h2> <table> <thead> <tr> <th>參數</th> <th>描述</th> </tr> </thead> <tbody> <tr> <td>輸出數據接口</td> <td>UART(TTL 1.8V - 3.3V)</td> </tr> <tr> <td>工作電壓</td> <td>3.3V (± 100mV)</td> </tr> <tr> <td>功耗</td> <td>86mW @3.3V</td> </tr> <tr> <td>溫度範圍</td> <td>-20℃ - 85 ℃</td> </tr> <tr> <td>最大線性加速度</td> <td>0 - 115 <span><span class=MathJax_Preview>m/s^2</span><script type=math/tex>m/s^2</script></span></td> </tr> <tr> <td>尺寸</td> <td>12 x 12 x 2.6mm (W x L x H)</td> </tr> <tr> <td>板載感測器</td> <td>三軸加速度計 三軸陀螺儀 三軸磁場感測器(可選)</td> </tr> </tbody> </table> <p><img alt src=../figures/assb.png></p> <table> <thead> <tr> <th>符號</th> <th>最小值</th> <th>典型值</th> <th>最大值</th> <th>單位</th> </tr> </thead> <tbody> <tr> <td>A1</td> <td>-</td> <td>11</td> <td>-</td> <td>mm</td> </tr> <tr> <td>B</td> <td>-</td> <td>11</td> <td>-</td> <td>mm</td> </tr> <tr> <td>D</td> <td>-</td> <td>12</td> <td>-</td> <td>mm</td> </tr> <tr> <td>E</td> <td>-</td> <td>12</td> <td>-</td> <td>mm</td> </tr> <tr> <td>H</td> <td>2.5</td> <td>2.6</td> <td>2.7</td> <td>mm</td> </tr> <tr> <td>a</td> <td>-</td> <td>1.5</td> <td>-</td> <td>mm</td> </tr> <tr> <td>b</td> <td>-</td> <td>0.9</td> <td>-</td> <td>mm</td> </tr> <tr> <td>c</td> <td>-</td> <td>1</td> <td>-</td> <td>mm</td> </tr> <tr> <td>e</td> <td>-</td> <td>1.27</td> <td>-</td> <td>mm</td> </tr> <tr> <td>f</td> <td>-</td> <td>1</td> <td>-</td> <td>mm</td> </tr> </tbody> </table> <p><img alt src=../figures/pin_assign.png></p> <table> <thead> <tr> <th>引腳號</th> <th>名稱</th> <th>說明</th> </tr> </thead> <tbody> <tr> <td>5</td> <td>N/C</td> <td>保留</td> </tr> <tr> <td>6</td> <td>VCC</td> <td>電源 3.3V</td> </tr> <tr> <td>7</td> <td>SYNC_OUT</td> <td>數據輸出同步: 數據輸出時， 此引腳為高電平，空閒時為低電平。</td> </tr> <tr> <td>8</td> <td>RXD</td> <td>模組序列埠接收 UART RXD(接 MCU 的 TXD)</td> </tr> <tr> <td>9</td> <td>TXD</td> <td>模組序列埠發送 UART TXD (接 MCU 的 RXD)</td> </tr> <tr> <td>10</td> <td>SYNC_IN</td> <td>數據輸入同步: 內部下拉，當模組檢測到上升沿時, 輸出一幀數據。</td> </tr> <tr> <td>11</td> <td>N/C</td> <td>保留</td> </tr> <tr> <td>19</td> <td>GND</td> <td>GND</td> </tr> <tr> <td>20</td> <td>RST</td> <td>復位, 內部上拉。&gt;10uS 低電平復位模組。無需要外接阻容，建議接到MCU的GPIO引腳以實現軟體復位</td> </tr> <tr> <td>21</td> <td>N/C</td> <td>保留</td> </tr> <tr> <td>22</td> <td>N/C</td> <td>保留</td> </tr> <tr> <td>23</td> <td>N/C</td> <td>保留</td> </tr> <tr> <td>24</td> <td>GND</td> <td>GND</td> </tr> <tr> <td>25</td> <td>N/C</td> <td>保留</td> </tr> </tbody> </table> <h2 id=_6>坐標系定義</h2> <p>載體系使用 前-左-上(FLU)右手坐標系， 地理坐標系使用 北-西-天(NWU)坐標系。其中歐拉角旋轉順序為 ZYX(先轉Z軸，再轉Y軸，最後轉X軸)旋轉順序。具體定義如下：</p> <ul> <li>繞 Z 軸方向旋轉: 航向角\Yaw\phi(<span><span class=MathJax_Preview>\psi</span><script type=math/tex>\psi</script></span>) 範圍: -180° - 180°</li> <li>繞 Y 軸方向旋轉: 俯仰角\Pitch\theta(<span><span class=MathJax_Preview>\theta</span><script type=math/tex>\theta</script></span>) 範圍: -90°-90°</li> <li>繞 X 軸方向旋轉:橫滾角\Roll\psi( <span><span class=MathJax_Preview>\phi</span><script type=math/tex>\phi</script></span>)範圍: -180°-180°</li> </ul> <p>如果將模組視為飛行器的話。X 軸應視為機頭方向。當感測器系與慣性系重合時，歐拉角的理想輸出為:Pitch = 0°, Roll = 0°, Yaw = 0°</p> <p><img alt src=../figures/coordinate.png></p> <h2 id=_7>性能指標</h2> <h3 id=_8>姿態角輸出精度</h3> <table> <thead> <tr> <th>姿態角</th> <th>典型值</th> </tr> </thead> <tbody> <tr> <td>橫滾角\俯仰角 - 靜態誤差</td> <td>0.8°</td> </tr> <tr> <td>橫滾角\俯仰角 - 動態誤差</td> <td>2.5°</td> </tr> <tr> <td>運動中航向角精度(6軸模式,30min,水平平穩運動,類掃地機運動模式)</td> <td>&lt;10°</td> </tr> <tr> <td>運動中航向角精度(9軸模式下,無磁干擾,校準後)</td> <td>3°</td> </tr> </tbody> </table> <h3 id=_9>陀螺儀</h3> <table> <thead> <tr> <th>參數</th> <th>值</th> </tr> </thead> <tbody> <tr> <td>測量範圍</td> <td>±2000°/s</td> </tr> <tr> <td>零偏穩定性</td> <td>10°/h</td> </tr> <tr> <td>刻度非線性度</td> <td>±0.3%(滿量程時)</td> </tr> <tr> <td>加速度敏感性</td> <td>0.1°/s/g</td> </tr> </tbody> </table> <h3 id=_10>加速度計</h3> <table> <thead> <tr> <th>參數</th> <th>值</th> </tr> </thead> <tbody> <tr> <td>測量範圍</td> <td>±8G (1G = 1x 重力加速度 )</td> </tr> <tr> <td>非線性度</td> <td>±0.5% (滿量程時)</td> </tr> </tbody> </table> <h3 id=_11>磁感測器參數</h3> <table> <thead> <tr> <th>參數</th> <th>值</th> </tr> </thead> <tbody> <tr> <td>測量範圍</td> <td>±8G(Gauss)</td> </tr> <tr> <td>非線性度</td> <td>±0.1%</td> </tr> <tr> <td>分辨率</td> <td>0.25mG</td> </tr> </tbody> </table> <h3 id=_12>模組數據接口參數</h3> <table> <thead> <tr> <th>參數</th> <th>值</th> </tr> </thead> <tbody> <tr> <td>序列埠輸出鮑率</td> <td>9600/115200/460800/921600可選</td> </tr> <tr> <td>幀輸出速率</td> <td>1/25/50/100/200/400Hz 可選</td> </tr> </tbody> </table> <h2 id=_13>感測器校準</h2> <ol> <li> <p>加速度計和陀螺儀在出廠前經過比例因子誤差和非正交誤差校準，校準參數保存在模組內部。</p> </li> <li> <p>陀螺儀的輸出每次上電後會有一個隨機的不為0的bias，稱之為零偏重複性。這個隨機bias不能在出廠前被校準。系統在啟動後1S內認為處於靜止狀態並採集1S的陀螺儀角速度作為初始bias。這個過程稱之為陀螺儀上電自校準。自校準在上電後靜止模組3s 左右可獲得最好的校準效果。<strong>如上電1s內模組處於運動狀態(包括緩慢轉動，振動等)則航向角飄移現象會顯著增大</strong>。 建議使用時每次上電後靜止至少1s。</p> </li> <li> <p>磁感測器(部分型號支援)出廠前經過橢球校準，但磁感測器很容易受到外界環境磁場干擾，一般都需要客戶重新校準，出廠校準參數意義不大。詳見地磁校準章節。</p> </li> </ol> <h3 id=_14>地磁校準</h3> <h4 id=_15>磁干擾分類</h4> <table> <thead> <tr> <th>種類</th> <th>定義</th> <th>典型干擾源</th> <th>影響</th> <th>措施</th> </tr> </thead> <tbody> <tr> <td>空間磁場干擾</td> <td>干擾不隨感測器運動而運動，而處於世界坐標系下</td> <td>各種固定的磁干擾源，傢俱，家用電器，電纜，房屋內的鋼筋結構等。一切不隨磁感測器運動而運動的干擾源</td> <td>無論磁場感測器是否校準的好，這些空間磁場的干擾(或者說環境磁場不均勻)都會使得空間地磁場發生畸變。地磁補償會錯誤並且無法獲得正確的航向角。他們是造成室內地磁融合難以使用的主要元兇。這種干擾不能被校準, 會嚴重影響地磁性能。空間磁場干擾在室內尤其嚴重。</td> <td>模組內置的勻質磁場檢測及屏蔽非勻質磁場</td> </tr> <tr> <td>感測器坐標系下的干擾</td> <td>干擾源隨感測器運動而運動</td> <td>模組PCB，與模組固定在一起的板子，儀器設備，產品等。他們和磁感測器視為同一個剛體，隨磁感測器運動而運動</td> <td>對感測器造成硬磁/軟磁干擾。這些干擾可以通過地磁校準算法加以很好的消除。</td> <td>地磁校準</td> </tr> </tbody> </table> <p>下圖是一個典型的室內磁場分佈圖。可以看到：一般室內環境的空間磁場畸變是比較嚴重的。</p> <p><img alt src=../common_figures/indoor_magnetic_field.png></p> <p><strong>注意</strong></p> <p>在室內環境下，空間磁場干擾尤其嚴重，而且空間磁干擾並不能通過校準來消除。在室內環境下，儘管模組內置均質磁場檢測及屏蔽機制，但9軸模式航向角的準確度很大程度上取決於室內磁場畸變程度，如果室內磁場環境很差(如電腦機房旁，電磁實驗室，車間 ，地下車庫等等)，即使校準後， 9軸的航向角精度可能還不如6軸甚至會出現大角度誤差。</p> <h4 id=69>6軸和9軸模式區別</h4> <p>正因為地磁場非常容易受到空間干擾，所以使用9軸模式時應非常注意。下表列舉了不同的使用場合和工況下的使用建議</p> <table> <thead> <tr> <th>模式</th> <th>適用環境</th> <th>典型應用</th> <th>優點</th> <th>缺點</th> <th>注意事項</th> </tr> </thead> <tbody> <tr> <td>6軸模式</td> <td>各種環境</td> <td>雲台等低動態姿態檢測，室內機器人</td> <td>1. 姿態角輸出穩定性好 2. 完全不受磁場干擾</td> <td>航向角隨時間緩慢漂移</td> <td>航向角會隨時間緩慢飄移且無法補償</td> </tr> <tr> <td>9軸模式</td> <td>無磁干擾環境</td> <td>1.指南針，尋北系統 2. 空曠且磁干擾較少的室內，模組基本不會大範圍在室內移動(典型的如攝影棚內動作捕捉，且被測者不會做大範圍走動)</td> <td>1. 航向角不會隨時間漂移 2.一旦檢測到地磁場可快速修正航向角指北</td> <td>任何磁干擾都會出現航向角準確度下降。室內干擾嚴重情況下 航向角無法指向正確方向。另外，移動機器人的金屬結構和電機運行時會產生非常強的磁干擾，所以移動機器人平台不適用於9軸模式。</td> <td>首次使用前需要校準地磁感測器</td> </tr> </tbody> </table> <p>模組的自動地磁校準系統只能處理和模組安裝在一起的，固定的磁場干擾。安裝環境如果有磁場干擾，這種干擾必須是固定的，並且這個干擾磁場與模組 安裝之後不會再發生距離變化(例：模組安裝在一個鐵材料之上，因為鐵會有磁場干擾， 這時就需要把鐵與模組一起旋轉校準，並且這個鐵在使用當中是不會和羅盤再分開的(發生相對位移)，一 旦分開是需要再重新校準。如果這個鐵大小是不固定的，或與羅盤的距離變化也不是固定 的，這種干擾是無法校準，即使校準成功，也會精度非常差，只能避而遠之安裝。安全距離控制在 40CM 以上)。</p> <h4 id=_16>校準方法</h4> <p>本模組整合了主動無干預地磁校準算法,模組會自動收集地磁場資訊並進行硬磁軟磁校準參數估計，校準成功後校準資訊會保存在模組Flash上。<strong>用戶無須任何操作/指令即可實現地磁校準</strong>。首次使用時，模組會自動採集周圍地磁場，並嘗試計算地磁感測器校準參數。當首次使用模組並且需要使用9軸模式時，應進行如下校準操作：</p> <p>在盡量小範圍內，緩慢的讓模組運動和旋轉，或者進行8字運動 或者分別繞每個軸360度，讓模組經歷盡量多的姿態。一般情況下，如果地磁干擾在可接受的範圍內，即可完成校準。如果後面在同樣地磁環境下(同地點)，則無需再次校準。如果始終沒能成功校準模組，說明周圍地磁場干擾比較大。</p> <p>地磁校準狀態可以使用AT指令來查看：</p> <p>發送<code>AT+INFO=HSI</code> 指令，模組會打印當前地磁校準系統狀態：</p> <p><img alt src=../common_figures/magcal_hsi.png></p> <table> <thead> <tr> <th>參數顯示</th> <th>意義</th> <th>說明</th> </tr> </thead> <tbody> <tr> <td>valid</td> <td>有效標誌</td> <td>0: 不存在有效校準參數(沒有校準或者從來沒有校準成功過)。非0：地磁校準完成</td> </tr> <tr> <td>fiterr</td> <td>擬合殘差</td> <td>殘差越小，說明參數擬合效果越好，通常在0.03以下說明校準結果已經足夠好。如果擬合結果始終&gt;0.1，說明地磁干擾很大，最好再次校準以期得到更好的校準結果。擬合殘差會隨著時間緩慢增長。</td> </tr> <tr> <td>flux</td> <td>當地磁場</td> <td>最近一次擬合器估計出的地磁場強 ，單位為uT</td> </tr> <tr> <td>inclination</td> <td>當地磁傾角</td> <td>最近一次擬合器估計出的磁傾角，單位為°</td> </tr> </tbody> </table> <ul> <li>雖然地磁參數估計可以在線自動採集數據，自動的動態擬合地磁校準參數。但是如果周圍地磁環境改變(比如需要到另外房間或者室內室外切換)，最好還需重複手工校準操作。</li> </ul> <h2 id=_17>安裝及焊接</h2> <ol> <li>安裝位置請遠離PCB容易形變點，盡量遠離PCB邊緣(&gt;30mm)，遠離PCB定位螺絲孔(&gt;10mm)等。</li> </ol> <p><img alt src=../common_figures/soldering1.png></p> <ol> <li> <p>安裝位置請遠離強磁設備，如電機，喇叭等強磁器件。</p> </li> <li> <p>組裝好的PCB不得使用超聲波清潔儀進行清潔。</p> </li> <li> <p>本產品不可使用塑封或噴塗三防漆，噴漆或塑封會造成感測器應力改變進而影響性能。</p> </li> </ol> <p><img alt src=../common_figures/soldering2.png></p> <ol> <li>推薦回流焊的爐溫曲線圖如下：</li> </ol> <p><img alt src=../common_figures/soldering3.png></p> <p><strong>注意</strong></p> <p>回流焊最後階段需要自然冷卻，不能開啟爐子強制風冷卻，否則嚴重影響產品性能。</p> <h2 id=_18>應用指南</h2> <h3 id=pc>模組與PC機連接</h3> <p>建議使用評估板與PC機進行連接，評估板板載USB供電及USB轉序列埠功能，可以方便的配合PC機上的評估軟體進行性能測試。具體請參見附錄中的評估板一節。</p> <h3 id=mcu>模組與MCU進行連接</h3> <p>模組與MCU通過TTL電平的序列埠進行連接，建議模組的RST引腳建議接到MCU的GPIO上。方便MCU強制復位模組。</p> <p><img alt src=../common_figures/connection_with_mcu.png></p> <p><strong>注意</strong></p> <ol> <li>如不使用同步輸入(SYNC_IN) 和同步輸出功能(SYNC_OUT) 可不接SYNC_IN 和 SYNC_OUT。</li> <li>120歐電阻的作用是為了方便調試，並防止MCU和模組電平不匹配，可以去掉，建議保留。</li> <li>VCC的電壓範圍具體參加手冊說明</li> <li>模組內置上電復位電路，RST可以不接，但是建議接到主機一個GPIO上來實現軟體復位。</li> </ol> <h2 id=_19>序列埠通訊協議</h2> <p>模組上電後，默認按出廠幀率(通常為100)輸出幀數據，幀格式如下：</p> <p><img alt src=../common_figures/serial_protocol.png></p> <table> <thead> <tr> <th>域名稱</th> <th>值</th> <th>長度(字節)</th> <th>說明</th> </tr> </thead> <tbody> <tr> <td>PRE</td> <td>0x5A</td> <td>1</td> <td>固定為0x5A</td> </tr> <tr> <td>TYPE</td> <td>0xA5</td> <td>1</td> <td>固定為0xA5</td> </tr> <tr> <td>LEN</td> <td>1-512</td> <td>2</td> <td>幀中數據域的長度，低字節在前。長度表示數據域(PAYLOAD)的長度，不包含<code>PRE</code>,<code>TYPE</code>,<code>LEN</code>,<code>CRC</code> 字段。</td> </tr> <tr> <td>CRC</td> <td>-</td> <td>2</td> <td>除CRC 本身外其餘所有字段(<code>PRE,TYPE,LEN, PAYLOAD</code>)幀數據的16 位CRC 校驗和。LSB(低字節在前)</td> </tr> <tr> <td>PAYLOAD</td> <td>-</td> <td>1-512</td> <td>一幀攜帶的數據。PAYLOAD域 由若干個**子數據包**組成。每個數據包包含數據包標籤和數據兩部分。標籤決定了數據的類型及長度。</td> </tr> </tbody> </table> <p><img alt src=../common_figures/serial_protocol2.png></p> <p>CRC實現函數：</p> <div class=highlight><pre><span></span><code>/*
    currectCrc: previous crc value, set 0 if it&#39;s first section
    src: source stream data
    lengthInBytes: length
*/
static void crc16_update(uint16_t *currectCrc, const uint8_t *src, uint32_t lengthInBytes)
{
    uint32_t crc = *currectCrc;
    uint32_t j;
    for (j=0; j &lt; lengthInBytes; ++j)
    {
        uint32_t i;
        uint32_t byte = src[j];
        crc ^= byte &lt;&lt; 8;
        for (i = 0; i &lt; 8; ++i)
        {
            uint32_t temp = crc &lt;&lt; 1;
            if (crc &amp; 0x8000)
            {
                temp ^= 0x1021;
            }
            crc = temp;
        }
    } 
    *currectCrc = crc;
}
</code></pre></div> <h2 id=_20>數據包</h2> <h4 id=_21>數據包總覽</h4> <table> <thead> <tr> <th>數據包標籤(DATA_ID)</th> <th>數據包長度(包含標籤1字節)</th> <th>名稱</th> <th>備註</th> </tr> </thead> <tbody> <tr> <td>0x90</td> <td>2</td> <td>用戶ID</td> <td></td> </tr> <tr> <td>0xA0</td> <td>7</td> <td>加速度</td> <td></td> </tr> <tr> <td>0xB0</td> <td>7</td> <td>角速度</td> <td></td> </tr> <tr> <td>0xC0</td> <td>7</td> <td>磁場強度</td> <td></td> </tr> <tr> <td>0xD0</td> <td>7</td> <td>歐拉角</td> <td></td> </tr> <tr> <td>0xD1</td> <td>17</td> <td>四元數</td> <td></td> </tr> <tr> <td>0xF0</td> <td>5</td> <td>氣壓</td> <td>輸出0</td> </tr> <tr> <td>0x91</td> <td>76</td> <td>IMUSOL(IMU數據集合)</td> <td>推薦使用</td> </tr> </tbody> </table> <h4 id=_22>產品支援數據包列表</h4> <h4 id=0x90id>0x90(用戶ID)</h4> <p>共2字節，用戶設置的ID。</p> <table> <thead> <tr> <th>字節偏移</th> <th>類型</th> <th>大小</th> <th>單位</th> <th>說明</th> </tr> </thead> <tbody> <tr> <td>0</td> <td>uint8_t</td> <td>1</td> <td>-</td> <td>數據包標籤:0x90</td> </tr> <tr> <td>1</td> <td>uint8_t</td> <td>1</td> <td>-</td> <td>用戶ID</td> </tr> </tbody> </table> <h4 id=0xa0>0xA0(加速度)</h4> <p>共7 個字節，LSB。輸出感測器的原始加速度</p> <table> <thead> <tr> <th>字節偏移</th> <th>類型</th> <th>大小</th> <th>單位</th> <th>說明</th> </tr> </thead> <tbody> <tr> <td>0</td> <td>uint8_t</td> <td>1</td> <td>-</td> <td>數據包標籤:0xA0</td> </tr> <tr> <td>1</td> <td>int16_t</td> <td>2</td> <td>0.001G(1G = 1重力加速度)</td> <td>X軸加速度</td> </tr> <tr> <td>3</td> <td>int16_t</td> <td>2</td> <td>0.001G</td> <td>Y軸加速度</td> </tr> <tr> <td>5</td> <td>int16_t</td> <td>2</td> <td>0.001G</td> <td>Z軸加速度</td> </tr> </tbody> </table> <h4 id=0xb0>0xB0(角速度)</h4> <p>共7字節，LSB。輸出感測器的原始角速度</p> <table> <thead> <tr> <th>字節偏移</th> <th>類型</th> <th>大小</th> <th>單位</th> <th>說明</th> </tr> </thead> <tbody> <tr> <td>0</td> <td>uint8_t</td> <td>1</td> <td>-</td> <td>數據包標籤：0xB0</td> </tr> <tr> <td>1</td> <td>int16_t</td> <td>2</td> <td>0.1°/s</td> <td>X軸角速度</td> </tr> <tr> <td>3</td> <td>int16_t</td> <td>2</td> <td>0.1°/s</td> <td>Y軸角速度</td> </tr> <tr> <td>5</td> <td>int16_t</td> <td>2</td> <td>0.1°/s</td> <td>Z軸角速度</td> </tr> </tbody> </table> <h4 id=0xc0>0xC0(磁場強度)</h4> <p>共7字節，LSB。輸出感測器的原始磁場強度</p> <table> <thead> <tr> <th>字節偏移</th> <th>類型</th> <th>大小</th> <th>單位</th> <th>說明</th> </tr> </thead> <tbody> <tr> <td>0</td> <td>uint8_t</td> <td>1</td> <td>-</td> <td>數據包標籤:0xC0</td> </tr> <tr> <td>1</td> <td>int16_t</td> <td>2</td> <td>0.001Gauss</td> <td>X軸磁場強度</td> </tr> <tr> <td>3</td> <td>int16_t</td> <td>2</td> <td>0.001Gauss</td> <td>Y軸磁場強度</td> </tr> <tr> <td>5</td> <td>int16_t</td> <td>2</td> <td>0.001Gauss</td> <td>Z軸磁場強度</td> </tr> </tbody> </table> <h4 id=0xd0>0xD0(歐拉角)</h4> <p>共7字節，LSB。格式為int16，共三個軸，每個軸占2 個字節，順序為Pitch/Roll/Yaw。接收到Roll, Pitch 為物理值乘以100 後得到的數值，Yaw 為乘以10 得到的數值。</p> <p>例：當接收到的Yaw = 100 時，表示航向角為10°</p> <table> <thead> <tr> <th>字節偏移</th> <th>類型</th> <th>大小</th> <th>單位</th> <th>說明</th> </tr> </thead> <tbody> <tr> <td>0</td> <td>uint8_t</td> <td>1</td> <td>-</td> <td>數據包標籤:0xD0</td> </tr> <tr> <td>1</td> <td>int16_t</td> <td>2</td> <td>0.01°</td> <td>Pitch(俯仰角)</td> </tr> <tr> <td>3</td> <td>int16_t</td> <td>2</td> <td>0.01°</td> <td>Roll(橫滾角)</td> </tr> <tr> <td>5</td> <td>int16_t</td> <td>2</td> <td>0.1°</td> <td>Yaw(航向角)</td> </tr> </tbody> </table> <h4 id=0xd1>0XD1(四元數)</h4> <p>共17字節，格式為float，共4個值，順序為:W X Y Z.。每個值占4 字節(float)，整個四元數為4個float，LSB。</p> <table> <thead> <tr> <th>字節偏移</th> <th>類型</th> <th>大小</th> <th>單位</th> <th>說明</th> </tr> </thead> <tbody> <tr> <td>0</td> <td>uint8_t</td> <td>1</td> <td>-</td> <td>數據包標籤:0xD1</td> </tr> <tr> <td>1</td> <td>float</td> <td>4</td> <td>-</td> <td>W</td> </tr> <tr> <td>5</td> <td>float</td> <td>4</td> <td>-</td> <td>X</td> </tr> <tr> <td>9</td> <td>float</td> <td>4</td> <td>-</td> <td>Y</td> </tr> <tr> <td>13</td> <td>float</td> <td>4</td> <td>-</td> <td>Z</td> </tr> </tbody> </table> <h4 id=0xf0>0XF0(氣壓)</h4> <p>共5字節，格式為float。(只針對有氣壓感測器的產品)</p> <table> <thead> <tr> <th>字節偏移</th> <th>類型</th> <th>大小</th> <th>單位</th> <th>說明</th> </tr> </thead> <tbody> <tr> <td>0</td> <td>uint8_t</td> <td>1</td> <td>-</td> <td>數據包標籤:0xF0</td> </tr> <tr> <td>1</td> <td>float</td> <td>4</td> <td>Pa</td> <td>大氣壓</td> </tr> </tbody> </table> <h4 id=0x91-imusol>0X91( IMUSOL)</h4> <p>共76字節，新加入的數據包，用於替代A0,B0,C0,D0,D1等數據包。整合了IMU的感測器原始輸出和姿態解算數據。</p> <table> <thead> <tr> <th>字節偏移</th> <th>類型</th> <th>大小</th> <th>單位</th> <th>說明</th> </tr> </thead> <tbody> <tr> <td>0</td> <td>uint8_t</td> <td>1</td> <td>-</td> <td>數據包標籤:0x91</td> </tr> <tr> <td>1</td> <td>uint8_t</td> <td>1</td> <td>-</td> <td>ID</td> </tr> <tr> <td>2</td> <td>-</td> <td>6</td> <td>-</td> <td>保留</td> </tr> <tr> <td>8</td> <td>uint32_t</td> <td>4</td> <td>ms</td> <td>時間戳資訊，從系統開機開始累加，每毫秒增加1</td> </tr> <tr> <td>12</td> <td>float</td> <td>12</td> <td>1G(1G = 1重力加速度)</td> <td>X,Y,Z軸的加速度，注意單位和0xA0不同</td> </tr> <tr> <td>24</td> <td>float</td> <td>12</td> <td>deg/s</td> <td>X,Y,Z軸的角速度，注意單位和0xB0不同</td> </tr> <tr> <td>36</td> <td>float</td> <td>12</td> <td>uT</td> <td>X,Y,Z軸的磁場強度(HI229支援,注意單位和0xC0不同)</td> </tr> <tr> <td>48</td> <td>float</td> <td>12</td> <td>deg</td> <td>節點歐拉角集合, 順序為：橫滾角(Roll)，俯仰角(Pitch)，航向角(Yaw)(注意順序和單位與0xD0數據包不同)</td> </tr> <tr> <td>60</td> <td>float</td> <td>16</td> <td>-</td> <td>節點四元數集合,順序為WXYZ</td> </tr> </tbody> </table> <h3 id=_23>出廠默認數據包</h3> <p>出廠默認一幀中攜帶數據包數據定義如下：</p> <table> <thead> <tr> <th>產品</th> <th>默認輸出數據包</th> </tr> </thead> <tbody> <tr> <td>HI229</td> <td>0x91</td> </tr> </tbody> </table> <h3 id=_24>數據幀結構示例</h3> <h4 id=0x900xa00xb00xc00xd00xf0>數據幀配置為 <code>0x90,0xA0,0xB0,0xC0,0xD0,0xF0</code> 數據包</h4> <p>使用序列埠助手採樣一幀數據,共41字節, 前6字節為幀頭, 長度和CRC校驗值。剩餘35字節為數據域。假設數據接收到C語言陣列<code>buf</code>中。如下所示:</p> <p>5A A5 23 00 FD 61 <strong>90</strong> 00 <strong>A0</strong> 55 02 3D 01 E2 02 <strong>B0</strong> FE FF 17 00 44 00 <strong>C0</strong> 80 FF 60 FF 32 FF <strong>D0</strong> 64 F2 6C 0E BB 01 <strong>F0</strong> 00 00 00 00</p> <ul> <li>第一步：判斷幀頭，得到數據域長度和幀CRC：</li> </ul> <p>幀頭:<code>5A</code> <code>A5</code></p> <p>幀數據域長度:<code>23</code> <code>00</code>: (0x00&lt;&lt;8) + 0x23 = 35</p> <p>幀CRC校驗值:<code>FD</code> <code>61</code>:(0x61&lt;&lt;8) + 0xFD = 0x61FD</p> <ul> <li>第二步： 校驗CRC</li> </ul> <div class=highlight><pre><span></span><code>    uint16_t payload_len;
    uint16_t crc;

    crc = 0;
    payload_len = buf[2] + (buf[3] &lt;&lt; 8);

    /* calulate 5A A5 and LEN filed crc */
    crc16_update(&amp;crc, buf, 4);

    /* calulate payload crc */
    crc16_update(&amp;crc, buf + 6, payload_len);
</code></pre></div> <p>得到CRC值為0x61FD, 與幀攜帶的CRC值相同, 幀CRC校驗通過。</p> <ul> <li>第三步：接收數據</li> </ul> <p><code>90 00</code>：ID 數據包, 0x90為數據包標籤, ID = 0x00.</p> <p><code>A0 55 02 3D 01 E2 02</code>:加速度數據包,0xA0為數據包標籤，三軸加速度為：</p> <p>X軸加速度= (int16_t)((0x02&lt;&lt;8)+ 0x55) = 597(單位為mG)</p> <p>Y軸加速度 = (int16_t)((0x01&lt;&lt;8)+ 0x3D) = 317</p> <p>Z軸加速度= (int16_t)((0x02&lt;&lt;8)+ 0xE2) = 738</p> <p><code>B0 FE FF 17 00 44 00</code> :角速度數據包,0xB0為數據包標籤，三軸角速度為：</p> <p>X軸角速度= (int16_t)((0xFF&lt;&lt;8)+ 0xFE) = -2(單位為0.1°/s)</p> <p>Y軸角速度 = (int16_t)((0x00&lt;&lt;8)+ 0x17) = 23</p> <p>Z軸角速度= (int16_t)((0x00&lt;&lt;8)+ 0x44) = 68</p> <p><code>C0 80 FF 60 FF 32 FF</code> :磁場數據包,0xC0為數據包標籤，三軸磁場為：</p> <p>X軸角速度= (int16_t)((0xFF&lt;&lt;8)+ 0x80) = -128 (單位為0.001Gauss)</p> <p>Y軸角速度 = (int16_t)((0xFF&lt;&lt;8)+ 0x60) = -160</p> <p>Z軸角速度= (int16_t)((0xFF&lt;&lt;8)+ 0x32) = -206</p> <p><code>D0 64 F2 6C 0E BB 01</code> 歐拉角數據包, 0xD0為數據包標籤</p> <p>Pitch= (int16_t)((0xF2&lt;&lt;8)+ 0x64) / 100 = -3484 / 100 = -34.84 ° </p> <p>Roll= (int16_t)((0x0E&lt;&lt;8)+ 0x6C) / 100 = 3692 / 100 = 36.92°</p> <p>Yaw = (int16_t)((0x01&lt;&lt;8)+ 0xBB) / 10 = 443 /10 = 44.3°</p> <p><code>F0 00 00 00 00</code>氣壓數據包，0xF0為數據包標籤</p> <div class=highlight><pre><span></span><code>float prs;
prs = memcpy(&amp;prs, &amp;buf[37], 4);
</code></pre></div> <p>最後得到結果：</p> <div class=highlight><pre><span></span><code>id              : 0
acc(G)          :    0.597    0.317    0.738
gyr(deg/s)      :   -0.200    2.300    6.800
mag(uT)         :  -12.800  -16.000  -20.600
eul(R/P/Y)      :   36.920  -34.840   44.300
</code></pre></div> <h4 id=0x91>數據幀配置為 <code>0x91</code> 數據包</h4> <p>使用序列埠助手採樣一幀數據,共82字節, 前6字節為幀頭, 長度和CRC校驗值。剩餘76字節為數據域。假設數據接收到C語言陣列<code>buf</code>中。如下所示:</p> <p>5A A5 4C 00 6C 51 <strong>91</strong> 00 A0 3B 01 A8 02 97 BD BB 04 00 9C A0 65 3E A2 26 45 3F 5C E7 30 3F E2 D4 5A C2 E5 9D A0 C1 EB 23 EE C2 78 77 99 41 AB AA D1 C1 AB 2A 0A C2 8D E1 42 42 8F 1D A8 C1 1E 0C 36 C2 E6 E5 5A 3F C1 94 9E 3E B8 C0 9E BE BE DF 8D BE</p> <ul> <li>第一步：判斷幀頭，得到數據域長度和幀CRC：</li> </ul> <p>幀頭:<code>5A</code> <code>A5</code></p> <p>幀數據域長度:<code>4C</code> <code>00</code>: (0x00&lt;&lt;8) + 0x4C = 76</p> <p>幀CRC校驗值:<code>6C</code> <code>51</code>:(0x51&lt;&lt;8) + 0x6C = 0x516C</p> <ul> <li>第二步： 校驗CRC</li> </ul> <div class=highlight><pre><span></span><code>    uint16_t payload_len;
    uint16_t crc;

    crc = 0;
    payload_len = buf[2] + (buf[3] &lt;&lt; 8);

    /* calulate 5A A5 and LEN filed crc */
    crc16_update(&amp;crc, buf, 4);

    /* calulate payload crc */
    crc16_update(&amp;crc, buf + 6, payload_len);
</code></pre></div> <p>得到CRC值為0x516C. 幀CRC校驗通過。</p> <ul> <li>第三步：接收數據</li> </ul> <p>從<code>0x91</code>開始為數據包的數據域。在C語言中可以定義結構體來方便的讀取數據：</p> <p>定義0x91數據包結構體如下：</p> <div class=highlight><pre><span></span><code>__packed typedef struct
{
    uint8_t     tag;                /* data packet tag */
    uint8_t     id;
    uint8_t     rev[6];             /* reserved */
    uint32_t    ts;                 /* timestamp */
    float       acc[3];
    float       gyr[3];
    float       mag[3];
    float       eul[3];             /* eular angles: Roll,Pitch,Yaw */
    float       quat[4];            /* quaternion */
}id0x91_t;
</code></pre></div> <p><code>__packed</code> 為編譯器關鍵字(Keil下)，表示結構體按字節緊對齊，結構體每一個元素一一對應0x91數據包的結構定義。接收數據時將接收到的陣列直接memcpy到結構體即可：(注意定義結構體時必須4字節對齊), 其中<code>buf</code>指向幀頭, <code>buf[6]</code>指向幀中數據域 。</p> <div class=highlight><pre><span></span><code>    /* 接收數據並使用0x91數據包結構定義來解釋數據 */
    __align(4) id0x91_t dat;    /* struct must be 4 byte aligned */
    memcpy(&amp;dat, &amp;buf[6], sizeof(id0x91_t));
</code></pre></div> <p>最後得到dat數據結果：</p> <div class=highlight><pre><span></span><code>id              : 0
timestamp       : 310205
acc             :    0.224    0.770    0.691
gyr             :  -54.708  -20.077 -119.070
mag             :   19.183  -26.208  -34.542
eul(R/P/Y)      :   48.720  -21.014  -45.512
quat            :    0.855    0.310   -0.310   -0.277
</code></pre></div> <h2 id=at>AT指令</h2> <p>當使用序列埠與模組通訊時, 模組支援AT 指令集配置/查看模組參數。AT 指令總以ASCII 碼<code>AT</code> 開頭，後面跟控制字符，最 後以回車換行<code>\r\n</code>結束。可使用序列埠調試助手進行測試：</p> <p><img alt src=../common_figures/at_cmd.png></p> <p>通用模組 AT指令如下</p> <table> <thead> <tr> <th>指令</th> <th>功能</th> <th>掉電保存(Y)</th> <th>立即生效(Y),復位生效(R)</th> <th>備註</th> </tr> </thead> <tbody> <tr> <td>AT+ID</td> <td>設置模組用戶ID</td> <td>Y</td> <td>R</td> <td></td> </tr> <tr> <td>AT+INFO</td> <td>打印模組資訊</td> <td>N</td> <td>Y</td> <td></td> </tr> <tr> <td>AT+ODR</td> <td>設置模組序列埠輸出幀頻率</td> <td>Y</td> <td>R</td> <td></td> </tr> <tr> <td>AT+BAUD</td> <td>設置序列埠鮑率</td> <td>Y</td> <td>R</td> <td></td> </tr> <tr> <td>AT+EOUT</td> <td>數據輸出開關</td> <td>N</td> <td>Y</td> <td></td> </tr> <tr> <td>AT+RST</td> <td>復位模組</td> <td>N</td> <td>Y</td> <td>重啟模組</td> </tr> <tr> <td>AT+TRG</td> <td>單次輸出觸發</td> <td>N</td> <td>Y</td> <td></td> </tr> <tr> <td>AT+SETPTL</td> <td>設置輸出數據包</td> <td>Y</td> <td>Y</td> <td></td> </tr> <tr> <td>AT+MODE</td> <td>設置模組工作模式</td> <td>Y</td> <td>R</td> <td></td> </tr> <tr> <td>AT+GWID</td> <td>設置無線接收機ID</td> <td>Y</td> <td>R</td> <td>不支援</td> </tr> </tbody> </table> <h5 id=atid>AT+ID</h5> <p>設置模組用戶ID</p> <p><strong>例</strong> <code>AT+ID=1</code></p> <h5 id=atinfo>AT+INFO</h5> <p>打印模組資訊，包括產品型號，版本，韌體發佈日期等。</p> <h5 id=atodr>AT+ODR</h5> <p>設置模組序列埠輸出幀率。掉電保存，復位模組生效</p> <p><strong>例</strong> 設置序列埠輸出速率為100Hz: <code>AT+ODR=100</code> </p> <p>注意：當輸出幀率設置比較高時(如200),默認的115200鮑率可能不滿足輸出頻寬要求，此時需要將模組鮑率設高(如921600)後，模組才能穩定輸出高幀率。</p> <h5 id=atbaud>AT+BAUD</h5> <p>設置序列埠鮑率，可選值：<code>9600/115200/460800/921600</code></p> <p><strong>例</strong> <code>AT+BAUD=115200</code></p> <p><strong>注意</strong></p> <ul> <li>使用此指令需要特別注意，輸入錯誤鮑率後會導致無法和模組通訊</li> <li>鮑率參數設置好後掉電保存，復位模組生效。 CH-Center 軟體的鮑率也要做相應修改。</li> <li>升級韌體時，需要切換回115200 鮑率。</li> </ul> <h5 id=ateout>AT+EOUT</h5> <p>序列埠輸出開關</p> <p><strong>例</strong> 打開序列埠輸出 <code>AT+EOUT=1</code> 關閉序列埠輸出 <code>AT+EOUT=0</code></p> <h5 id=atrst>AT+RST</h5> <p>復位模組</p> <p><strong>例</strong> <code>AT+RST</code></p> <h5 id=atmode>AT+MODE</h5> <p>設置模組工作模式</p> <p><strong>例</strong> </p> <ul> <li>設置模組工作在6軸模式(無磁校準) <code>AT+MODE=0</code></li> <li>設置模組工作在9軸模式(地磁場感測器參與航向角校正) <code>AT+MODE=1</code></li> </ul> <h5 id=atsetptl>AT+SETPTL</h5> <p>設置輸出協議:</p> <p>模組數據幀中的數據包組成可使用AT指令配置，格式為<code>AT+SETPTL=&lt;ITEM_ID&gt;,&lt;ITEM_ID&gt;...</code></p> <p><strong>例</strong> 配置模組輸出加速度，角速度, 整形格式歐拉角和四元數的指令為：<code>AT+SETPTL=A0,B0,D0,D1</code></p> <p><img alt src=../common_figures/at_setptl.png></p> <h5 id=attrg>AT+TRG</h5> <p>觸發模組輸出一幀數據，可以配合AT+ODR=0來實現單次觸發輸出。</p> <p><strong>例</strong> <code>AT+TRG</code></p> <h2 id=a->附錄A - 評估板</h2> <p><img alt src=../common_figures/HI2XXDK.png></p> <h3 id=_25>評估板簡介</h3> <p>評估板提供了快速評估本產品的方法。板載USB-UART芯片(CP2104)以及供電LDO，並將模組接口引出方便調試評估。</p> <p>安裝資料包中的CP2104 USB-UART 驅動程序, 將USB線連接電腦和模組，打開 CH-Center 軟體，連接序列埠，默認狀態下，模組會以115200-N-8-N-1 輸出出廠默認的數據包。</p> <h3 id=_26>尺寸</h3> <p><img alt src=../common_figures/HI2XXDK2.png></p> <h3 id=_27>從評估板上取下產品</h3> <p>模組默認被嵌入評估板的PLCC28 插槽中，如需取出模組，請按如下步驟操作： - 斷電，準備好細螺絲刀或鑷子 - 從PLCC 插座或者背面圓形空洞內將模組撬出或頂出。</p> <p><strong>注意</strong></p> <ul> <li>評估板的主要作用僅僅是快速評估模組性能, USB 接口本身不適合於工業級場景或者高運動場合的電氣連接，如果您的應用為高運動環境(動作捕捉等)，則不建議在您的產品中直接使用評估板。</li> </ul> <h2 id=b->附錄B - 韌體升級與恢復出廠設置</h2> <p>本產品支援升級韌體。 韌體升級步驟:</p> <ul> <li>連接模組，打開 CH-Center 軟體，將模組和 CH-Center 軟體鮑率都設置為115200. 打開韌體升級窗口</li> <li>點擊"連接"，如出現模組連接資訊。則說明升級系統準備就緒，點擊文件選擇器(…)選擇副檔名為.hex 的韌體</li> <li>點擊"開始編程"。下載完成後會提示編程完成，此時關閉序列埠，重新給模組上電，模組升級完成。</li> </ul> <p><img alt src=../common_figures/firmware_update.png></p> </article> </div> </div> </main> <footer class=md-footer> <div class=md-footer-nav> <nav class="md-footer-nav__inner md-grid"> <a href=../../hi226/hi226/ title="HI226 用戶手冊" class="md-flex md-footer-nav__link md-footer-nav__link--prev" rel=prev> <div class="md-flex__cell md-flex__cell--shrink"> <i class="md-icon md-icon--arrow-back md-footer-nav__button"></i> </div> <div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title"> <span class=md-flex__ellipsis> <span class=md-footer-nav__direction> Previous </span> HI226 用戶手冊 </span> </div> </a> <a href=../../ch100/ch100/ title="CH100 用戶手冊" class="md-flex md-footer-nav__link md-footer-nav__link--next" rel=next> <div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title"> <span class=md-flex__ellipsis> <span class=md-footer-nav__direction> Next </span> CH100 用戶手冊 </span> </div> <div class="md-flex__cell md-flex__cell--shrink"> <i class="md-icon md-icon--arrow-forward md-footer-nav__button"></i> </div> </a> </nav> </div> <div class="md-footer-meta md-typeset"> <div class="md-footer-meta__inner md-grid"> <div class=md-footer-copyright> <div class=md-footer-copyright__highlight> Copyright &copy; 2016 - 2020 HiPNUC </div> powered by <a href=https://www.mkdocs.org target=_blank rel=noopener>MkDocs</a> and <a href=https://squidfunk.github.io/mkdocs-material/ target=_blank rel=noopener> Material for MkDocs</a> </div> </div> </div> </footer> </div> <script src=../../assets/javascripts/application.c33a9706.js></script> <script>app.initialize({version:"1.1.2",url:{base:"../.."}})</script> <script src=../../extra.js></script> <script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.0/MathJax.js?config=TeX-MML-AM_CHTML"></script> </body> </html>